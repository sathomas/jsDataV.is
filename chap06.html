<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="Cache-Control" content="no-transform">
        <!--[if lte IE 8]>
            <script>window.location.href='http://browsehappy.com';</script>
        <![endif]-->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Stephen Thomas <stephen@sathomas.me>">
        <meta name="mobile-web-app-capable" content="yes">
        <link rel="apple-touch-icon" sizes="152x152" href="apple-touch-icon.png">
        <link rel="shortcut icon" href="favicon.ico">
        <link rel="stylesheet" href="css/styles.min.css">
        <title>Data Visualization with JavaScript</title>
        <script>
            var chartStyles = {
                color: {
                    text:               "#444444",
                    primary:            "#CA0000",
                    primaryLightest:    "#FE4C4C",
                    primaryLight:       "#F71515",
                    primaryDark:        "#A50000",
                    primaryDarkest:     "#7B0000",
                    secondary:          "#007979",
                    secondaryLightest:  "#2D9999",
                    secondaryLight:     "#0D9494",
                    secondaryDark:      "#006363",
                    secondaryDarkest:   "#004A4A",
                    alternate:          "#7EBD00",
                    alternateLightest:  "#B6ED47",
                    alternateLight:     "#A0E714",
                    alternateDark:      "#679A00",
                    alternateDarkest:   "#4D7300",
                    tertiary:           "#CA5C00",
                    tertiaryLightest:   "#FE9D4C",
                    tertiaryLight:      "#F77B15",
                    tertiaryDark:       "#A54B00",
                    tertiaryDarkest:    "#7B3800",
                    quaternary:         "#A2005C",
                    quaternaryLightest: "#CC3D8E",
                    quaternaryLight:    "#C61177",
                    quaternaryDark:     "#85004B",
                    quaternaryDarkest:  "#630038",
                    blockBackground:    "#F5F5F5"
                },
                font: {
                    family:             "Varela, sans-serif"
                }
            };
        </script>

<!--
    Adjustments to styles and JavaScript just for screen
    captures to be used in printed book.
 -->

<script>

    // Adjustments only active if page is loaded from
    // the local file system.

    if (window.location.protocol === "file:") {

        // Update the properties used by JavaScript code
        // to create the live visualizations.

        chartStyles.color.text = "#000000";
        chartStyles.font.family = "Avenir";

        var css = document.createElement('style');
        css.type = 'text/css';
        var styles = "figure, .no-font-feature-settings figure, .no-font-feature-settings figure .lgcp {color: black; font-family: Avenir;}";

        if (css.styleSheet) { css.styleSheet.cssText = styles; }
        else                { css.appendChild(document.createTextNode(styles)); }

        document.getElementsByTagName("head")[0].appendChild(css);

        document.getElementsByTagName('html')[0].classList.add("localfile");

    }

</script>

    </head>
    <body class="fade fadeOut">
        <div id="nav-target"></div>
        <nav>
            <ul>
                <li>
                    <a href="index.html" alt="jsDataV.is" title="jsDataV.is">
                        <svg width="32px" height="32px" viewBox="0 0 32 32">
                            <title>jsDataV.is</title>
                            <g class="jsdatavis-logo">
                                <path d="M22.5,2.5 L16.5,15.5" ></path>
                                <path d="M28.5,24.5 L16.5,15.5"></path>
                                <path d="M9.5,28.5 L16.5,15.5" ></path>
                                <path d="M2.5,18.5 L16.5,15.5" ></path>
                                <circle cx="9"  cy="29" r="3"></circle>
                                <circle cx="3"  cy="18" r="3"></circle>
                                <circle cx="29" cy="25" r="3"></circle>
                                <circle cx="22" cy="3"  r="3"></circle>
                                <circle cx="17" cy="15" r="6"></circle>
                            </g>
                        </svg>
                    </a>
                </li>
                <li id="contents">Contents ▾
                    <ol>
                        <li><a href="intro.html" >Introduction</a></li>
                        <li><a href="chap01.html"><span class="lgcp">1</span>: Graphing Data</a></li>
                        <li><a href="chap02.html"><span class="lgcp">2</span>: Making Charts Interactive</a></li>
                        <li><a href="chap03.html"><span class="lgcp">3</span>: Integrating Charts on a Page</a></li>
                        <li><a href="chap04.html"><span class="lgcp">4</span>: Creating Specialized Graphs</a></li>
                        <li><a href="chap05.html"><span class="lgcp">5</span>: Showing Timelines</a></li>
                        <li><a href="chap06.html"><span class="lgcp">6</span>: Visualizing Geographic Data</a></li>
                        <li><a href="chap07.html"><span class="lgcp">7</span>: Custom Visualizations with D3.js</a></li>
                        <li><a href="apndA.html" ><span class="lgcp">A</span>: Managing Data in the Browser</a></li>
                        <li><a href="apndB.html" ><span class="lgcp">B</span>: Building Data-Driven Applications</a></li>
                    </ol>
                </li>
            </ul>
            <!-- <form id="search">
                <input type="search" id="st-search-input" placeholder="Search the site..." class="st-search-input" />
            </form> -->
        </nav>
        <main>

<style>
@font-face {
	font-family: 'Continental-Symbol-ST';
	src:url('../fonts/Continental-Symbol-ST.eot');
	src:url('../fonts/Continental-Symbol-ST.eot?#iefix') format('embedded-opentype'),
		url('../fonts/Continental-Symbol-ST.woff') format('woff'),
		url('../fonts/Continental-Symbol-ST.ttf') format('truetype'),
		url('../fonts/Continental-Symbol-ST.svg#Continental-Symbol-ST') format('svg');
	font-weight: normal;
	font-style: normal;
}

.map-ad,.map-al,.map-at,.map-ba,.map-be,.map-bg,.map-by,.map-ch,.map-cy,.map-cz,
.map-de,.map-dk,.map-ee,.map-es,.map-fi,.map-fo,.map-fr,.map-ge,.map-gg,.map-gr,
.map-hr,.map-hu,.map-ie,.map-im,.map-is,.map-it,.map-je,.map-li,.map-lt,.map-lu,
.map-lv,.map-mc,.map-md,.map-me,.map-mk,.map-mt,.map-nl,.map-no,.map-pl,.map-pt,
.map-ro,.map-rs,.map-ru,.map-se,.map-si,.map-sk,.map-sm,.map-tr,.map-ua,.map-uk,
.map-va, .map-eur {
	font-family: 'Continental-Symbol-ST';
		speak: none;
		font-style: normal;
		font-weight: normal;
		font-variant: normal;
		text-transform: none;
		line-height: 1;
		-webkit-font-smoothing: antialiased;
}
.map-ad:before { content: "\e034"; }
.map-al:before { content: "\e033"; }
.map-at:before { content: "\e032"; }
.map-ba:before { content: "\e031"; }
.map-be:before { content: "\e030"; }
.map-bg:before { content: "\e02f"; }
.map-by:before { content: "\e02e"; }
.map-ch:before { content: "\e02d"; }
.map-cy:before { content: "\e02c"; }
.map-cz:before { content: "\e02b"; }
.map-de:before { content: "\e02a"; }
.map-dk:before { content: "\e029"; }
.map-ee:before { content: "\e028"; }
.map-es:before { content: "\e027"; }
.map-fi:before { content: "\e026"; }
.map-fo:before { content: "\e025"; }
.map-fr:before { content: "\e024"; }
.map-ge:before { content: "\e023"; }
.map-gg:before { content: "\e022"; }
.map-gr:before { content: "\e021"; }
.map-hr:before { content: "\e020"; }
.map-hu:before { content: "\e01f"; }
.map-ie:before { content: "\e01e"; }
.map-im:before { content: "\e01d"; }
.map-is:before { content: "\e01c"; }
.map-it:before { content: "\e01b"; }
.map-je:before { content: "\e01a"; }
.map-li:before { content: "\e019"; }
.map-lt:before { content: "\e018"; }
.map-lu:before { content: "\e017"; }
.map-lv:before { content: "\e016"; }
.map-mc:before { content: "\e015"; }
.map-md:before { content: "\e014"; }
.map-me:before { content: "\e013"; }
.map-mk:before { content: "\e012"; }
.map-mt:before { content: "\e011"; }
.map-nl:before { content: "\e010"; }
.map-no:before { content: "\e00f"; }
.map-pl:before { content: "\e00e"; }
.map-pt:before { content: "\e00d"; }
.map-ro:before { content: "\e00c"; }
.map-rs:before { content: "\e00b"; }
.map-ru:before { content: "\e00a"; }
.map-se:before { content: "\e009"; }
.map-si:before { content: "\e008"; }
.map-sk:before { content: "\e007"; }
.map-sm:before { content: "\e006"; }
.map-tr:before { content: "\e005"; }
.map-ua:before { content: "\e004"; }
.map-uk:before { content: "\e003"; }
.map-va:before { content: "\e002"; }
.map-eur:before { content: "\e001"; }
@font-face {
    font-family: 'Continental-Symbol-ST';
    src:url('fonts/Continental-Symbol-ST.woff') format('woff');
    font-weight: normal;
    font-style: normal;
}
/* required styles */

.leaflet-map-pane,
.leaflet-tile,
.leaflet-marker-icon,
.leaflet-marker-shadow,
.leaflet-tile-pane,
.leaflet-tile-container,
.leaflet-overlay-pane,
.leaflet-shadow-pane,
.leaflet-marker-pane,
.leaflet-popup-pane,
.leaflet-overlay-pane svg,
.leaflet-zoom-box,
.leaflet-image-layer,
.leaflet-layer {
	position: absolute;
	left: 0;
	top: 0;
	}
.leaflet-container {
	overflow: hidden;
	-ms-touch-action: none;
	}
.leaflet-tile,
.leaflet-marker-icon,
.leaflet-marker-shadow {
	-webkit-user-select: none;
	   -moz-user-select: none;
	        user-select: none;
	-webkit-user-drag: none;
	}
.leaflet-marker-icon,
.leaflet-marker-shadow {
	display: block;
	}
/* map is broken in FF if you have max-width: 100% on tiles */
.leaflet-container img {
	max-width: none !important;
	}
/* stupid Android 2 doesn't understand "max-width: none" properly */
.leaflet-container img.leaflet-image-layer {
	max-width: 15000px !important;
	}
.leaflet-tile {
	filter: inherit;
	visibility: hidden;
	}
.leaflet-tile-loaded {
	visibility: inherit;
	}
.leaflet-zoom-box {
	width: 0;
	height: 0;
	}
/* workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=888319 */
.leaflet-overlay-pane svg {
	-moz-user-select: none;
	}

.leaflet-tile-pane    { z-index: 2; }
.leaflet-objects-pane { z-index: 3; }
.leaflet-overlay-pane { z-index: 4; }
.leaflet-shadow-pane  { z-index: 5; }
.leaflet-marker-pane  { z-index: 6; }
.leaflet-popup-pane   { z-index: 7; }

.leaflet-vml-shape {
	width: 1px;
	height: 1px;
	}
.lvml {
	behavior: url(#default#VML);
	display: inline-block;
	position: absolute;
	}


/* control positioning */

.leaflet-control {
	position: relative;
	z-index: 7;
	pointer-events: auto;
	}
.leaflet-top,
.leaflet-bottom {
	position: absolute;
	z-index: 1000;
	pointer-events: none;
	}
.leaflet-top {
	top: 0;
	}
.leaflet-right {
	right: 0;
	}
.leaflet-bottom {
	bottom: 0;
	}
.leaflet-left {
	left: 0;
	}
.leaflet-control {
	float: left;
	clear: both;
	}
.leaflet-right .leaflet-control {
	float: right;
	}
.leaflet-top .leaflet-control {
	margin-top: 10px;
	}
.leaflet-bottom .leaflet-control {
	margin-bottom: 10px;
	}
.leaflet-left .leaflet-control {
	margin-left: 10px;
	}
.leaflet-right .leaflet-control {
	margin-right: 10px;
	}


/* zoom and fade animations */

.leaflet-fade-anim .leaflet-tile,
.leaflet-fade-anim .leaflet-popup {
	opacity: 0;
	-webkit-transition: opacity 0.2s linear;
	   -moz-transition: opacity 0.2s linear;
	     -o-transition: opacity 0.2s linear;
	        transition: opacity 0.2s linear;
	}
.leaflet-fade-anim .leaflet-tile-loaded,
.leaflet-fade-anim .leaflet-map-pane .leaflet-popup {
	opacity: 1;
	}

.leaflet-zoom-anim .leaflet-zoom-animated {
	-webkit-transition: -webkit-transform 0.25s cubic-bezier(0,0,0.25,1);
	   -moz-transition:    -moz-transform 0.25s cubic-bezier(0,0,0.25,1);
	     -o-transition:      -o-transform 0.25s cubic-bezier(0,0,0.25,1);
	        transition:         transform 0.25s cubic-bezier(0,0,0.25,1);
	}
.leaflet-zoom-anim .leaflet-tile,
.leaflet-pan-anim .leaflet-tile,
.leaflet-touching .leaflet-zoom-animated {
	-webkit-transition: none;
	   -moz-transition: none;
	     -o-transition: none;
	        transition: none;
	}

.leaflet-zoom-anim .leaflet-zoom-hide {
	visibility: hidden;
	}


/* cursors */

.leaflet-clickable {
	cursor: pointer;
	}
.leaflet-container {
	cursor: -webkit-grab;
	cursor:    -moz-grab;
	}
.leaflet-popup-pane,
.leaflet-control {
	cursor: auto;
	}
.leaflet-dragging .leaflet-container,
.leaflet-dragging .leaflet-clickable {
	cursor: move;
	cursor: -webkit-grabbing;
	cursor:    -moz-grabbing;
	}


/* visual tweaks */

.leaflet-container {
	background: #ddd;
	outline: 0;
	}
.leaflet-container a {
	color: #0078A8;
	}
.leaflet-container a.leaflet-active {
	outline: 2px solid orange;
	}
.leaflet-zoom-box {
	border: 2px dotted #38f;
	background: rgba(255,255,255,0.5);
	}


/* general typography */
.leaflet-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
	}


/* general toolbar styles */

.leaflet-bar {
	box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.leaflet-bar a,
.leaflet-bar a:hover {
	background-color: #fff;
	border-bottom: 1px solid #ccc;
	width: 26px;
	height: 26px;
	line-height: 26px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: black;
	}
.leaflet-bar a,
.leaflet-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.leaflet-bar a:hover {
	background-color: #f4f4f4;
	}
.leaflet-bar a:first-child {
	border-top-left-radius: 4px;
	border-top-right-radius: 4px;
	}
.leaflet-bar a:last-child {
	border-bottom-left-radius: 4px;
	border-bottom-right-radius: 4px;
	border-bottom: none;
	}
.leaflet-bar a.leaflet-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}

.leaflet-touch .leaflet-bar a {
	width: 30px;
	height: 30px;
	line-height: 30px;
	}


/* zoom control */

.leaflet-control-zoom-in,
.leaflet-control-zoom-out {
	font: bold 18px 'Lucida Console', Monaco, monospace;
	text-indent: 1px;
	}
.leaflet-control-zoom-out {
	font-size: 20px;
	}

.leaflet-touch .leaflet-control-zoom-in {
	font-size: 22px;
	}
.leaflet-touch .leaflet-control-zoom-out {
	font-size: 24px;
	}


/* layers control */

.leaflet-control-layers {
	box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.leaflet-control-layers-toggle {
	background-image: url(images/layers.png);
	width: 36px;
	height: 36px;
	}
.leaflet-retina .leaflet-control-layers-toggle {
	background-image: url(images/layers-2x.png);
	background-size: 26px 26px;
	}
.leaflet-touch .leaflet-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.leaflet-control-layers .leaflet-control-layers-list,
.leaflet-control-layers-expanded .leaflet-control-layers-toggle {
	display: none;
	}
.leaflet-control-layers-expanded .leaflet-control-layers-list {
	display: block;
	position: relative;
	}
.leaflet-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #333;
	background: #fff;
	}
.leaflet-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.leaflet-control-layers label {
	display: block;
	}
.leaflet-control-layers-separator {
	height: 0;
	border-top: 1px solid #ddd;
	margin: 5px -10px 5px -6px;
	}


/* attribution and scale controls */

.leaflet-container .leaflet-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.leaflet-control-attribution,
.leaflet-control-scale-line {
	padding: 0 5px;
	color: #333;
	}
.leaflet-control-attribution a {
	text-decoration: none;
	}
.leaflet-control-attribution a:hover {
	text-decoration: underline;
	}
.leaflet-container .leaflet-control-attribution,
.leaflet-container .leaflet-control-scale {
	font-size: 11px;
	}
.leaflet-left .leaflet-control-scale {
	margin-left: 5px;
	}
.leaflet-bottom .leaflet-control-scale {
	margin-bottom: 5px;
	}
.leaflet-control-scale-line {
	border: 2px solid #777;
	border-top: none;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-moz-box-sizing: content-box;
	     box-sizing: content-box;

	background: #fff;
	background: rgba(255, 255, 255, 0.5);
	}
.leaflet-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.leaflet-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.leaflet-touch .leaflet-control-attribution,
.leaflet-touch .leaflet-control-layers,
.leaflet-touch .leaflet-bar {
	box-shadow: none;
	}
.leaflet-touch .leaflet-control-layers,
.leaflet-touch .leaflet-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
	}


/* popup */

.leaflet-popup {
	position: absolute;
	text-align: center;
	}
.leaflet-popup-content-wrapper {
	padding: 1px;
	text-align: left;
	border-radius: 12px;
	}
.leaflet-popup-content {
	margin: 13px 19px;
	line-height: 1.4;
	}
.leaflet-popup-content p {
	margin: 18px 0;
	}
.leaflet-popup-tip-container {
	margin: 0 auto;
	width: 40px;
	height: 20px;
	position: relative;
	overflow: hidden;
	}
.leaflet-popup-tip {
	width: 17px;
	height: 17px;
	padding: 1px;

	margin: -10px auto 0;

	-webkit-transform: rotate(45deg);
	   -moz-transform: rotate(45deg);
	    -ms-transform: rotate(45deg);
	     -o-transform: rotate(45deg);
	        transform: rotate(45deg);
	}
.leaflet-popup-content-wrapper,
.leaflet-popup-tip {
	background: white;

	box-shadow: 0 3px 14px rgba(0,0,0,0.4);
	}
.leaflet-container a.leaflet-popup-close-button {
	position: absolute;
	top: 0;
	right: 0;
	padding: 4px 4px 0 0;
	text-align: center;
	width: 18px;
	height: 14px;
	font: 16px/14px Tahoma, Verdana, sans-serif;
	color: #c3c3c3;
	text-decoration: none;
	font-weight: bold;
	background: transparent;
	}
.leaflet-container a.leaflet-popup-close-button:hover {
	color: #999;
	}
.leaflet-popup-scrolled {
	overflow: auto;
	border-bottom: 1px solid #ddd;
	border-top: 1px solid #ddd;
	}

.leaflet-oldie .leaflet-popup-content-wrapper {
	zoom: 1;
	}
.leaflet-oldie .leaflet-popup-tip {
	width: 24px;
	margin: 0 auto;

	-ms-filter: "progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678)";
	filter: progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678);
	}
.leaflet-oldie .leaflet-popup-tip-container {
	margin-top: -1px;
	}

.leaflet-oldie .leaflet-control-zoom,
.leaflet-oldie .leaflet-control-layers,
.leaflet-oldie .leaflet-popup-content-wrapper,
.leaflet-oldie .leaflet-popup-tip {
	border: 1px solid #999;
	}


/* div icon */

.leaflet-div-icon {
	background: #fff;
	border: 1px solid #666;
	}
body { counter-reset: chapter 6; }
</style>

<h1 id="chapter-6-visualizing-geographic-data">Chapter 6: Visualizing Geographic Data</h1>
<p>Humans crave context when evaluating data, so it’s important to provide that context when it’s available. In the previous chapter, we saw how timelines can provide one frame of reference; now we’ll examine another equally important context: place. If a data set includes geographic coordinates or has values that correspond to different geographic regions, you can provide geographic context using a map-based visualization. The examples in this chapter consider two types of map-based visualizations.</p>
<p>In the first two examples, we want to show how data varies by region. The resulting visualizations, known as <em>choropleth</em> maps, use color to highlight different characteristics of the different regions. For the next two examples the visualization data doesn’t itself vary by region directly, but the data does have a geographic component. By showing the data on a map, we can help our users understand it.</p>
<p>More specifically, we’ll see</p>
<ul>
<li>How to use special map fonts to create maps with minimal JavaScript.</li>
<li>How to manipulate Scalable Vector Graphic (<span class="smcp">SVG</span>) image maps with JavaScript.</li>
<li>How to use a simple mapping library to add maps to web pages.</li>
<li>How to integrate a full-featured map library into a visualization.</li>
</ul>
<h2 id="using-map-fonts">Using Map Fonts</h2>
<p>One technique for adding maps to web pages is surprisingly simple but often overlooked—map fonts. Two examples of these fonts are <a href="http://intridea.github.io/stately/">Stately</a> for the United States and <a href="http://contfont.net">Continental</a> for Europe. Map fonts are special-purpose web fonts whose character sets contain map symbols instead of letters and numbers. In just a few easy steps we’ll create a visualization of Europe using the symbols from Continental.</p>
<h3 id="step-1-include-the-fonts-in-the-page">Step 1: Include the Fonts in the Page</h3>
<p>The main web sites for both Stately and Continental include more detailed instructions for installing the fonts, but all that’s really necessary is including a single <span class="smcp">CSS</span> stylesheet. In the case of Continental, that stylesheet is called, naturally, <code>continental.css</code>. No JavaScript libraries are required.</p>
<table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;head&gt;</span>
    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;title&gt;&lt;/title&gt;</span>
    <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> type=</span><span class="st">&quot;text/css&quot;</span><span class="ot"> href=</span><span class="st">&quot;css/continental.css&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;/head&gt;</span>
  <span class="kw">&lt;body&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;map&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
  <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre></td></tr></table>
<blockquote>
<p>For a production web site, you might want to combine <code>continental.css</code> with your site’s other stylesheets to minimize the number of network requests the browser has to make.</p>
</blockquote>
<h3 id="step-2-display-one-country">Step 2: Display One Country</h3>
<p>To show a single country, all we have to do is include an <span class="smcp">HTML</span> <code>&lt;span&gt;</code> element with the appropriate attributes. We can do this right in the markup, adding a class attribute set to <code>map-</code> followed by a two-letter country abbreviation. ( “fr” is the international two-letter abbreviation for France.)</p>
<table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;map&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">&quot;map-fr&quot;</span><span class="kw">&gt;&lt;/span&gt;</span>
<span class="kw">&lt;/div&gt;</span></code></pre></td></tr></table>
<p>For this example, we’ll use JavaScript to generate the markup. Here we’re creating a new <code>&lt;span&gt;</code> element, giving it a class name of <code>&quot;map-fr&quot;</code>, and appending it to the map <code>&lt;div&gt;</code>.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> fr = <span class="ot">document</span>.<span class="fu">createElement</span>(<span class="st">&quot;span&quot;</span>);
<span class="ot">fr</span>.<span class="fu">className</span> = <span class="st">&quot;map-fr&quot;</span>;
<span class="ot">document</span>.<span class="fu">getElementById</span>(<span class="st">&quot;map&quot;</span>).<span class="fu">appendChild</span>(fr);</code></pre></td></tr></table>
<p>One last bit of housekeeping is setting the size of the font. By default, any map font character will be the same size as a regular text character. For maps we want something much larger, so we can use standard <span class="smcp">CSS</span> rules to increase the size.</p>
<table class="sourceCode css numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode css"><span class="fl">#map</span> <span class="kw">{</span>
    <span class="kw">font-size:</span> <span class="dt">200px</span><span class="kw">;</span>
<span class="kw">}</span></code></pre></td></tr></table>
<p>That’s all it takes to add France to a web page, as you can see in figure <span class="nextfigure"/>.</p>
<figure>
<div id="map-font-1" style="font-size:500px; width: 100%; position:relative; left: -50px; top: -310px; margin-bottom: -500px; line-height:640px;">

</div>
<figcaption>
Map fonts make it very easy to add a map to a web page.
</figcaption>
</figure>
<h3 id="step-3-combine-multiple-countries-into-a-single-map">Step 3: Combine Multiple Countries into a Single Map</h3>
<p>For this example we want to show more than a single country. We’d like to visualize the median age for all of Europe’s countries, based on <a href="http://www.un.org/en/development/desa/population/">United Nations population data</a> from 2010. To do that, we’ll create a map that includes all European countries, and we’ll style each country according to the data.</p>
<p>The first step in this visualization is putting all of the countries into a single map. Since each country is a separate character in the Continental font, we want to overlay those characters on top of one another rather than spread them across the page. That requires setting a couple of <span class="smcp">CSS</span> rules. First we set the position of the outer container to <code>relative</code>. This rule doesn’t change the styling of the outer container at all, but it does establish a <em>positioning context</em> for anything within the container. Those elements will be our individual country symbols, and we’ll set their position to be <code>absolute</code>. We’ll then place each one at the top and left of the map so they’ll overlay one another. Because we’ve positioned the container <code>relative</code>, the country symbols will be positioned relative to that container rather than to the page as a whole.</p>
<table class="sourceCode css numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode css"><span class="fl">#map</span> <span class="kw">{</span>
    <span class="kw">position:</span> <span class="dt">relative</span><span class="kw">;</span>
<span class="kw">}</span>
<span class="fl">#map</span> &gt; <span class="ch">[class*=</span><span class="st">&quot;map-&quot;</span><span class="ch">]</span> <span class="kw">{</span>
    <span class="kw">position:</span> <span class="dt">absolute</span><span class="kw">;</span>
    <span class="kw">top:</span> <span class="dt">0</span><span class="kw">;</span>
    <span class="kw">left:</span> <span class="dt">0</span><span class="kw">;</span>
<span class="kw">}</span></code></pre></td></tr></table>
<p>Here we’re using a couple of <span class="smcp">CSS</span> tricks to apply this positioning to all of the individual symbols within this element. We start by selecting the element with an <code>id</code> of <code>map</code>. Nothing fancy there. The direct descendent selector (<code>&gt;</code>), however, says that what follows match only elements that are immediate children of that element, not arbitrary descendants. Finally, the attribute selector <code>[class*=&quot;map‑&quot;]</code>specifies only children that have a class containing the characters <code>map-</code>. Since all the country symbols will be <code>&lt;span&gt;</code> elements with a class of <code>map‑xx</code> (where <code>xx</code> is the two-letter country abbreviation), this will match all of our countries.</p>
<p>In our JavaScript we can start with an array listing all of the countries and iterate through it. For each country we create a <code>&lt;span&gt;</code> element with the appropriate class and insert it in the map <code>&lt;div&gt;</code>.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> countries = [
  <span class="st">&quot;ad&quot;</span>, <span class="st">&quot;al&quot;</span>, <span class="st">&quot;at&quot;</span>, <span class="st">&quot;ba&quot;</span>, <span class="st">&quot;be&quot;</span>, <span class="st">&quot;bg&quot;</span>, <span class="st">&quot;by&quot;</span>, <span class="st">&quot;ch&quot;</span>, <span class="st">&quot;cy&quot;</span>, <span class="st">&quot;cz&quot;</span>,
  <span class="st">&quot;de&quot;</span>, <span class="st">&quot;dk&quot;</span>, <span class="st">&quot;ee&quot;</span>, <span class="st">&quot;es&quot;</span>, <span class="st">&quot;fi&quot;</span>, <span class="st">&quot;fo&quot;</span>, <span class="st">&quot;fr&quot;</span>, <span class="st">&quot;ge&quot;</span>, <span class="st">&quot;gg&quot;</span>, <span class="st">&quot;gr&quot;</span>,
  <span class="st">&quot;hr&quot;</span>, <span class="st">&quot;hu&quot;</span>, <span class="st">&quot;ie&quot;</span>, <span class="st">&quot;im&quot;</span>, <span class="st">&quot;is&quot;</span>, <span class="st">&quot;it&quot;</span>, <span class="st">&quot;je&quot;</span>, <span class="st">&quot;li&quot;</span>, <span class="st">&quot;lt&quot;</span>, <span class="st">&quot;lu&quot;</span>,
  <span class="st">&quot;lv&quot;</span>, <span class="st">&quot;mc&quot;</span>, <span class="st">&quot;md&quot;</span>, <span class="st">&quot;me&quot;</span>, <span class="st">&quot;mk&quot;</span>, <span class="st">&quot;mt&quot;</span>, <span class="st">&quot;nl&quot;</span>, <span class="st">&quot;no&quot;</span>, <span class="st">&quot;pl&quot;</span>, <span class="st">&quot;pt&quot;</span>,
  <span class="st">&quot;ro&quot;</span>, <span class="st">&quot;rs&quot;</span>, <span class="st">&quot;ru&quot;</span>, <span class="st">&quot;se&quot;</span>, <span class="st">&quot;si&quot;</span>, <span class="st">&quot;sk&quot;</span>, <span class="st">&quot;sm&quot;</span>, <span class="st">&quot;tr&quot;</span>, <span class="st">&quot;ua&quot;</span>, <span class="st">&quot;uk&quot;</span>,
  <span class="st">&quot;va&quot;</span>
];

<span class="kw">var</span> map = <span class="ot">document</span>.<span class="fu">getElementById</span>(<span class="st">&quot;map&quot;</span>);
<span class="ot">countries</span>.<span class="fu">forEach</span>(<span class="kw">function</span>(cc) {
    <span class="kw">var</span> span = <span class="ot">document</span>.<span class="fu">createElement</span>(<span class="st">&quot;span&quot;</span>);
    <span class="ot">span</span>.<span class="fu">className</span> = <span class="st">&quot;map-&quot;</span> + cc;
    <span class="ot">map</span>.<span class="fu">appendChild</span>(span);
});</code></pre></td></tr></table>
<p>With these style rules defined, inserting multiple <code>&lt;span&gt;</code> elements within our map <code>&lt;div&gt;</code> creates the complete, if somewhat uninteresting, map of Europe shown in figure <span class="nextfigure"/>.</p>
<style>
#map-font-2 {
    position: relative;
    margin-bottom: -40px;
    font-size: 300px;
    height: 300px;
    padding: 20px 0;
}
#map-font-2 > [class*="map-"] {
    position: absolute;
    top: 0;
    left: 0;
}
</style>
<figure>
<div id="map-font-2">

</div>
<figcaption>
Overlaying map characters on top of one another creates a complete map.
</figcaption>
</figure>
<h3 id="step-4-vary-the-countries-based-on-the-data">Step 4: Vary the Countries Based on the Data</h3>
<p>Now we’re ready to create the actual data visualization. Naturally, we’ll start with the data, in this case from the United Nations. Here’s how we could format that data in a JavaScript array. (The full data set can be found with the book’s <a href="https://github.com/sathomas/jsDataV.is-source">source code</a>.)</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> ages = [
    { <span class="st">&quot;country&quot;</span>: <span class="st">&quot;al&quot;</span>, <span class="st">&quot;age&quot;</span>: <span class="fl">29.968</span> },
    { <span class="st">&quot;country&quot;</span>: <span class="st">&quot;at&quot;</span>, <span class="st">&quot;age&quot;</span>: <span class="fl">41.768</span> },
    { <span class="st">&quot;country&quot;</span>: <span class="st">&quot;ba&quot;</span>, <span class="st">&quot;age&quot;</span>: <span class="fl">39.291</span> },
    { <span class="st">&quot;country&quot;</span>: <span class="st">&quot;be&quot;</span>, <span class="st">&quot;age&quot;</span>: <span class="fl">41.301</span> },
    { <span class="st">&quot;country&quot;</span>: <span class="st">&quot;bg&quot;</span>, <span class="st">&quot;age&quot;</span>: <span class="fl">41.731</span> },
    <span class="co">// Data set continues...</span></code></pre></td></tr></table>
<p>There are several ways we could use this data to modify the map. We could use JavaScript code to set the visualization properties directly by, for example, changing the <code>color</code> style for each country symbol. That would work, but it forgoes one of the big advantages of map fonts. With map fonts our visualization is standard <span class="smcp">HTML</span>, so we can use standard <span class="smcp">CSS</span> to style it. If, in the future, we want to change the styles on the page, they’ll all be contained within the stylesheets, and we won’t have to hunt through our JavaScript code just to adjust colors.</p>
<p>To indicate which styles are appropriate for an individual country symbol, we can attach a <code>data-</code> attribute to each. In the following code, we set the <code>data-age</code> attribute to the mean age, rounded to the nearest whole number. To find the age for a given country, we need that country’s index in the <code>ages</code> array. The <code>findCountryIndex()</code> function does that in a straightforward way.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> findCountryIndex = <span class="kw">function</span>(cc) {
    <span class="kw">for</span> (<span class="kw">var</span> idx=<span class="dv">0</span>; idx&lt;<span class="ot">ages</span>.<span class="fu">length</span>; idx++) {
        <span class="kw">if</span> (ages[idx].<span class="fu">country</span> === cc) {
            <span class="kw">return</span> idx;
        }
    }
    <span class="kw">return</span> -<span class="dv">1</span>;
}
<span class="kw">var</span> map = <span class="ot">document</span>.<span class="fu">getElementById</span>(<span class="st">&quot;map&quot;</span>);
<span class="ot">countries</span>.<span class="fu">forEach</span>(<span class="kw">function</span>(cc) {
    <span class="kw">var</span> idx = <span class="fu">findCountryIndex</span>(cc);
    <span class="kw">if</span> (idx !== -<span class="dv">1</span>) {
        <span class="kw">var</span> span = <span class="ot">document</span>.<span class="fu">createElement</span>(<span class="st">&quot;span&quot;</span>);
        <span class="ot">span</span>.<span class="fu">className</span> = <span class="st">&quot;map-&quot;</span> + cc;
        <span class="ot">span</span>.<span class="fu">setAttribute</span>(<span class="st">&quot;data-age&quot;</span>, <span class="ot">Math</span>.<span class="fu">round</span>(ages[idx].<span class="fu">age</span>));
        <span class="ot">map</span>.<span class="fu">appendChild</span>(span);
    }
});</code></pre></td></tr></table>
<p>Now we can assign <span class="smcp">CSS</span> style rules based on that <code>data-age</code> attribute. Here’s the start of a simple blue gradient for the different ages, where greater median ages are colored darker blue-green.</p>
<table class="sourceCode css numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
</pre></td><td class="sourceCode"><pre><code class="sourceCode css"><span class="fl">#map</span> &gt; <span class="ch">[data-age=</span><span class="st">&quot;44&quot;</span><span class="ch">]</span> <span class="kw">{</span> <span class="kw">color:</span> <span class="dt">#2d9999</span><span class="kw">;</span> <span class="kw">}</span>
<span class="fl">#map</span> &gt; <span class="ch">[data-age=</span><span class="st">&quot;43&quot;</span><span class="ch">]</span> <span class="kw">{</span> <span class="kw">color:</span> <span class="dt">#2a9493</span><span class="kw">;</span> <span class="kw">}</span>
<span class="fl">#map</span> &gt; <span class="ch">[data-age=</span><span class="st">&quot;42&quot;</span><span class="ch">]</span> <span class="kw">{</span> <span class="kw">color:</span> <span class="dt">#278f8e</span><span class="kw">;</span> <span class="kw">}</span>
<span class="co">/* CSS rules continue... */</span></code></pre></td></tr></table>
<blockquote>
<p>Note: Although they’re beyond the scope of this book, <span class="smcp">CSS</span> preprocessors such as <a href="http://lesscss.org"><span class="smcp">LESS</span></a> and <a href="http://sass-lang.com"><span class="smcp">SASS</span></a> make it easy to create these kinds of rules.</p>
</blockquote>
<p>Now we have the nice visualization of the age trends shown in figure <span class="nextfigure"/>.</p>
<style>
#map-font-3 {
    display: inline-block;
    width: 310px;
    position: relative;
    font-size: 300px;
    height: 310px;
    color: lightgray;
    background-color: rgb(245, 245, 245);
    border: 1px solid rgb(208, 208, 208);
    border-radius: 3px;
}
#map-font-3 > [class*="map-"] {
    position: absolute;
    top: 0px;
    left: 10px;
}
#map-font-3 > [data-age="28"] { color: #2d9999; }
#map-font-3 > [data-age="29"] { color: #2a9493; }
#map-font-3 > [data-age="30"] { color: #278f8e; }
#map-font-3 > [data-age="31"] { color: #258a89; }
#map-font-3 > [data-age="32"] { color: #228584; }
#map-font-3 > [data-age="33"] { color: #1f7f7f; }
#map-font-3 > [data-age="34"] { color: #1c7b7a; }
#map-font-3 > [data-age="35"] { color: #1a7575; }
#map-font-3 > [data-age="36"] { color: #177070; }
#map-font-3 > [data-age="37"] { color: #146b6b; }
#map-font-3 > [data-age="38"] { color: #116766; }
#map-font-3 > [data-age="39"] { color: #0e6261; }
#map-font-3 > [data-age="40"] { color: #0a5d5c; }
#map-font-3 > [data-age="41"] { color: #085858; }
#map-font-3 > [data-age="42"] { color: #055453; }
#map-font-3 > [data-age="43"] { color: #024f4e; }
#map-font-3 > [data-age="44"] { color: #004a4a; }
</style>
<figure>
<div id="map-font-3">

</div>
<figcaption>
With <span class="smcp">CSS</span> rules we can change the styles of individual map symbols.</figcation>
</figure>
<h3 id="step-5-add-a-legend">Step 5: Add a Legend</h3>
<p>To finish off the visualization, we can add a legend to the map. Because the map itself is nothing more than standard <span class="smcp">HTML</span> elements with <span class="smcp">CSS</span> styling, it’s easy to create a matching legend. This example covers a fairly broad range (ages 28 to 44), so a linear gradient works well as a key. Your own implementation will depend on the specific browser versions that you wish to support, but a generic style rule would be:</p>
<table class="sourceCode css numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode css"><span class="fl">#map-legend</span> <span class="fl">.key</span> <span class="kw">{</span>
    <span class="kw">background:</span> linear-gradient(to <span class="dt">bottom</span>, <span class="dt">#004a4a</span> <span class="dt">0%</span>,<span class="dt">#2d9999</span> <span class="dt">100%</span>)<span class="kw">;</span>
<span class="kw">}</span></code></pre></td></tr></table>
<p>The resulting visualization in figure <span class="nextfigure"/> summarizes the median age for European countries in a clear and concise format.</p>
<style>
#map-font-4 {
    display: inline-block;
    float: left;
    width: 310px;
    position: relative;
    font-size: 300px;
    height: 310px;
    color: lightgray;
    background-color: rgb(245, 245, 245);
    border: 1px solid rgb(208, 208, 208);
    border-radius: 3px;
}
#map-font-4 > [class*="map-"] {
    position: absolute;
    top: 0px;
    left: 10px;
}
#map-font-4 > [data-age="28"] { color: #2d9999; }
#map-font-4 > [data-age="29"] { color: #2a9493; }
#map-font-4 > [data-age="30"] { color: #278f8e; }
#map-font-4 > [data-age="31"] { color: #258a89; }
#map-font-4 > [data-age="32"] { color: #228584; }
#map-font-4 > [data-age="33"] { color: #1f7f7f; }
#map-font-4 > [data-age="34"] { color: #1c7b7a; }
#map-font-4 > [data-age="35"] { color: #1a7575; }
#map-font-4 > [data-age="36"] { color: #177070; }
#map-font-4 > [data-age="37"] { color: #146b6b; }
#map-font-4 > [data-age="38"] { color: #116766; }
#map-font-4 > [data-age="39"] { color: #0e6261; }
#map-font-4 > [data-age="40"] { color: #0a5d5c; }
#map-font-4 > [data-age="41"] { color: #085858; }
#map-font-4 > [data-age="42"] { color: #055453; }
#map-font-4 > [data-age="43"] { color: #024f4e; }
#map-font-4 > [data-age="44"] { color: #004a4a; }
#map-font-4-legend {
    float: left;
    padding-left: 20px;
    position: relative;
}
#map-font-4-legend .key {
    margin-left: 20px;
    margin-top: 8px;
    display: inline-block;
    height: 250px;
    width: 20px;
    background: -moz-linear-gradient(top, #004a4a 0%, #2d9999 100%);
    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#004a4a), color-stop(100%,#2d9999));
    background: -webkit-linear-gradient(top, #004a4a 0%,#2d9999 100%);
    background: -o-linear-gradient(top, #004a4a 0%,#2d9999 100%);
    background: -ms-linear-gradient(top, #004a4a 0%,#2d9999 100%);
    background: linear-gradient(to bottom, #004a4a 0%,#2d9999 100%);
    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#004a4a', endColorstr='#2d9999',GradientType=0 );
}
#map-font-4-legend .top {
    position: absolute;
    top: 28px;
    left: 70px;
}
#map-font-4-legend .middle {
    position: absolute;
    top: 145px;
    left: 70px;
}
#map-font-4-legend .bottom {
    position: absolute;
    top: 264px;
    left: 70px;
}
</style>
<figure>
<div id="map-font-4">

</div>
<div id="map-font-4-legend">
<div class="title">
Median Age
</div>
<span class="key"></span><span class="top">44</span><span class="middle">35</span><span class="bottom">28</span>
</div>
<figcaption>
Standard <span class="smcp">HTML</span> can also provide a legend for the visualization.
</figcaption>
</figure>
<script>
;(function(){

    draw = function() {

        var fr = document.createElement("span");
        fr.className = "map-fr";
        var map1 = document.getElementById("map-font-1");
        map1.appendChild(fr);
        
        var countries = [
          "ad", "al", "at", "ba", "be", "bg", "by", "ch", "cy", "cz",
          "de", "dk", "ee", "es", "fi", "fo", "fr", "ge", "gg", "gr",
          "hr", "hu", "ie", "im", "is", "it", "je", "li", "lt", "lu",
          "lv", "mc", "md", "me", "mk", "mt", "nl", "no", "pl", "pt",
          "ro", "rs", "ru", "se", "si", "sk", "sm", "tr", "ua", "uk",
          "va"
        ];
        
        var map2 = document.getElementById("map-font-2");
        countries.forEach(function(cc) {
            var sp = document.createElement("span");
            sp.className = "map-" + cc;
            map2.appendChild(sp);
        });
        
        var ages = [
            { "country": "al", "age": 29.968 },
            { "country": "at", "age": 41.768 },
            { "country": "ba", "age": 39.291 },
            { "country": "be", "age": 41.301 },
            { "country": "bg", "age": 41.731 },
            { "country": "by", "age": 38.223 },
            { "country": "ch", "age": 41.915 },
            { "country": "cy", "age": 36.491 },
            { "country": "cz", "age": 39.59  },
            { "country": "de", "age": 44.328 },
            { "country": "dk", "age": 40.802 },
            { "country": "ee", "age": 39.581 },
            { "country": "es", "age": 40.174 },
            { "country": "fi", "age": 41.984 },
            { "country": "fr", "age": 40.112 },
            { "country": "ge", "age": 37.582 },
            { "country": "gg", "age": 42.152 },
            { "country": "gr", "age": 41.638 },
            { "country": "hr", "age": 41.555 },
            { "country": "hu", "age": 39.807 },
            { "country": "ie", "age": 34.582 },
            { "country": "is", "age": 35.098 },
            { "country": "it", "age": 43.316 },
            { "country": "je", "age": 42.152 },
            { "country": "lt", "age": 39.846 },
            { "country": "lu", "age": 39.299 },
            { "country": "lv", "age": 40.04  },
            { "country": "md", "age": 35.219 },
            { "country": "me", "age": 35.856 },
            { "country": "mk", "age": 36.011 },
            { "country": "mt", "age": 39.021 },
            { "country": "nl", "age": 40.839 },
            { "country": "no", "age": 38.901 },
            { "country": "pl", "age": 38.208 },
            { "country": "pt", "age": 40.958 },
            { "country": "ro", "age": 38.499 },
            { "country": "rs", "age": 37.574 },
            { "country": "ru", "age": 38.054 },
            { "country": "se", "age": 40.887 },
            { "country": "si", "age": 41.689 },
            { "country": "sk", "age": 37.199 },
            { "country": "tr", "age": 28.344 },
            { "country": "ua", "age": 39.521 },
            { "country": "uk", "age": 39.858 }
        ];
        
        
        var findCountryIndex = function(cc) {
            for (var idx=0; idx<ages.length; idx++) {
                if (ages[idx].country === cc) {
                    return idx;
                }
            }
            return -1;
        }
        var map3 = document.getElementById("map-font-3");
        countries.forEach(function(cc) {
            var idx = findCountryIndex(cc);
            if (idx !== -1) {
                var span = document.createElement("span");
                span.className = "map-" + cc;
                span.setAttribute("data-age", Math.round(ages[idx].age));
                map3.appendChild(span);
            }
        });
        
        var map4 = document.getElementById("map-font-4");
        countries.forEach(function(cc) {
            var idx = findCountryIndex(cc);
            if (idx !== -1) {
                var span = document.createElement("span");
                span.className = "map-" + cc;
                span.setAttribute("data-age", Math.round(ages[idx].age));
                map4.appendChild(span);
            }
        });

    };
    
    if (typeof contentLoaded != "undefined") {
        contentLoaded.done(draw);
    } else {
        window.addEventListener('load', draw);
    }

}());
</script>
<h2 id="working-with-scalable-vector-graphics">Working with Scalable Vector Graphics</h2>
<p>Map fonts like those in the previous example are easy to use and visually effective, but only a few map fonts exist, and they definitely don’t cover all the conceivable geographic regions. For visualizations of other regions, we’ll have to find a different technique. Maps, of course, are ultimately images, and web browsers can display many different image formats. One format in particular, called <em>Scalable Vector Graphics,</em> or <span class="smcp">SVG</span>, is especially well suited for interactive visualizations. That’s because, as we’ll see in this example, JavaScript code (as well as <span class="smcp">CSS</span> styles) can easily and naturally interact with <span class="smcp">SVG</span> images.</p>
<p>Although our example for this section deals with a map, the techniques here are by no means limited to maps. Whenever you have a diagram or illustration in <span class="smcp">SVG</span> format, you can manipulate it directly on a web page.</p>
<blockquote>
<p>There is one important consideration for using <span class="smcp">SVG</span>: only modern web browsers support it. More specifically, Internet Explorer version 8 (and earlier) cannot display <span class="smcp">SVG</span> images. If a significant number of your users are using older browsers, you might want to consider other alternatives.</p>
</blockquote>
<p>For web developers <span class="smcp">SVG</span> is especially convenient because its syntax uses the same structure as <span class="smcp">HTML</span>. You can use many of the same tools and techniques for working with <span class="smcp">HTML</span> on <span class="smcp">SVG</span> as well. Consider, for example, a skeletal <span class="smcp">HTML</span> document.</p>
<table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;head&gt;</span><span class="co">&lt;!-- --&gt;</span><span class="kw">&lt;/head&gt;</span>
  <span class="kw">&lt;body&gt;</span>
    <span class="kw">&lt;nav&gt;</span><span class="co">&lt;!-- --&gt;</span><span class="kw">&lt;/nav&gt;</span>
    <span class="kw">&lt;main&gt;</span>
      <span class="kw">&lt;section&gt;</span><span class="co">&lt;!-- --&gt;</span><span class="kw">&lt;/section&gt;</span>
    <span class="kw">&lt;/main&gt;</span>
    <span class="kw">&lt;nav&gt;</span><span class="co">&lt;!-- --&gt;</span><span class="kw">&lt;/nav&gt;</span>
  <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre></td></tr></table>
<p>Compare that to the next example, the universal symbol for first aid represented in an <span class="smcp">SVG</span> document.</p>
<blockquote>
<p>If you have worked with <span class="smcp">HTML</span> before <span class="smcp">HTML5</span>, the similarities might be especially striking, as the <span class="smcp">SVG</span> header text follows the same format as <span class="smcp">HTML4</span>.</p>
</blockquote>
<table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;<span class="kw">?&gt;</span>
<span class="dt">&lt;!DOCTYPE </span>svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot;
    &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;<span class="dt">&gt;</span>
<span class="kw">&lt;svg</span><span class="ot"> id=</span><span class="st">&quot;firstaid&quot;</span><span class="ot"> version=</span><span class="st">&quot;1.1&quot;</span><span class="ot"> xmlns=</span><span class="st">&quot;http://www.w3.org/2000/svg&quot;</span> 
<span class="ot">     width=</span><span class="st">&quot;100&quot;</span><span class="ot"> height=</span><span class="st">&quot;100&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;rect</span><span class="ot"> id=</span><span class="st">&quot;background&quot;</span><span class="ot"> x=</span><span class="st">&quot;0&quot;</span><span class="ot"> y=</span><span class="st">&quot;0&quot;</span><span class="ot"> width=</span><span class="st">&quot;100&quot;</span><span class="ot"> height=</span><span class="st">&quot;100&quot;</span><span class="ot"> rx=</span><span class="st">&quot;20&quot;</span> <span class="kw">/&gt;</span>
    <span class="kw">&lt;rect</span><span class="ot"> id=</span><span class="st">&quot;vertical&quot;</span><span class="ot">   x=</span><span class="st">&quot;39&quot;</span><span class="ot"> y=</span><span class="st">&quot;19&quot;</span><span class="ot"> width=</span><span class="st">&quot;22&quot;</span><span class="ot"> height=</span><span class="st">&quot;62&quot;</span> <span class="kw">/&gt;</span>
    <span class="kw">&lt;rect</span><span class="ot"> id=</span><span class="st">&quot;horizontal&quot;</span><span class="ot"> x=</span><span class="st">&quot;19&quot;</span><span class="ot"> y=</span><span class="st">&quot;39&quot;</span><span class="ot"> width=</span><span class="st">&quot;62&quot;</span><span class="ot"> height=</span><span class="st">&quot;22&quot;</span> <span class="kw">/&gt;</span>
<span class="kw">&lt;/svg&gt;</span></code></pre></td></tr></table>
<p>You can even style the <span class="smcp">SVG</span> elements using <span class="smcp">CSS</span>. Here’s how we could color the preceding image:</p>
<table class="sourceCode css numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="sourceCode"><pre><code class="sourceCode css">svg<span class="fl">#firstaid</span> <span class="kw">{</span>
    <span class="kw">stroke:</span> <span class="dt">none</span><span class="kw">;</span>
<span class="kw">}</span>
svg<span class="fl">#firstaid</span> <span class="fl">#background</span> <span class="kw">{</span>
    <span class="kw">fill:</span> <span class="dt">#000</span><span class="kw">;</span>
<span class="kw">}</span>
svg<span class="fl">#firstaid</span> <span class="fl">#vertical</span>,
svg<span class="fl">#firstaid</span> <span class="fl">#horizontal</span> <span class="kw">{</span>
    <span class="kw">fill:</span> <span class="dt">#FFF</span><span class="kw">;</span>
<span class="kw">}</span></code></pre></td></tr></table>
<style>
svg#firstaid {
    stroke: none;
}
svg#firstaid #background {
    fill: rgb(68,68,68);
}
svg#firstaid #vertical,
svg#firstaid #horizontal {
    fill: #EFEFEF;
}
</style>
<p>If you’re curious, figure <span class="nextfigure"/> shows how that <span class="smcp">SVG</span> renders.</p>
<figure>
<svg id="firstaid" version="1.1" xmlns="http://www.w3.org/2000/svg" width="100" height="100">
<rect id="background" x="0" y="0" width="100" height="100" rx="20" /> <rect id="vertical" x="39" y="19" width="22" height="62" /> <rect id="horizontal" x="19" y="39" width="62" height="22" />
</svg>
<figcaption>
SVG images may be embedded directly within web pages.
</figcaption>
</figure>
<p>The affinity between <span class="smcp">HTML</span> and <span class="smcp">SVG</span> is, in fact, far stronger than the similar syntax. With modern browsers you can mix <span class="smcp">SVG</span> and <span class="smcp">HTML</span> in the same web page. To see how that works, let’s visualize health data for the 159 counties in the <span class="smcp">US</span> state of Georgia. The data comes from <a href="http://www.countyhealthrankings.org">County Health Rankings</a>.</p>
<h3 id="step-1-create-the-svg-map">Step 1: Create the SVG Map</h3>
<p>Our visualization starts with a map, so we’ll need an illustration of Georgia’s counties in <span class="smcp">SVG</span> format. Although that might seem like a challenge, there are actually many sources for <span class="smcp">SVG</span> maps that are free to use, as well as special-purpose applications that can generate <span class="smcp">SVG</span> maps for almost any region. The <a href="http://commons.wikimedia.org/wiki/Main_Page">Wikimedia Commons</a>, for example, contains a large number of open source maps, including many of Georgia. We’ll use <a href="http://commons.wikimedia.org/wiki/File:NRHP_Georgia_Map.svg#file">one</a> showing data from the National Register of Historic Places.</p>
<p>After downloading the map file, we can adjust it to better fit our needs, removing the legend, colors, and other elements that we don’t need. Although you can do this in a text editor (just as you can edit <span class="smcp">HTML</span>), you may find it easier to use a graphics program such as Adobe Illustrator or a more web-focused app like <a href="http://www.bohemiancoding.com/sketch/">Sketch</a>. You might also want to take advantage of an <span class="smcp">SVG</span> optimization <a href="http://petercollingridge.appspot.com/svg-optimiser">web site</a> or <a href="https://github.com/svg">application</a>, which can compress an <span class="smcp">SVG</span> by removing extraneous tags and reducing the sometimes-excessive precision of graphics programs.</p>
<p>Our result will be a series of <code>&lt;path&gt;</code> elements, one for each county. We’ll also want to assign a <code>class</code> or <code>id</code> to each path to indicate the county. The resulting <span class="smcp">SVG</span> file might begin like the following.</p>
<table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="kw">&lt;svg</span><span class="ot"> version=</span><span class="st">&quot;1.1&quot;</span><span class="ot"> xmlns=</span><span class="st">&quot;http://www.w3.org/2000/svg&quot;</span> 
<span class="ot">    width=</span><span class="st">&quot;497&quot;</span><span class="ot"> height=</span><span class="st">&quot;558&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;path</span><span class="ot"> id=</span><span class="st">&quot;ck&quot;</span><span class="ot"> d=</span><span class="st">&quot;M 216.65,131.53 L 216.41,131.53 216.17,131.53...&quot;</span> <span class="kw">/&gt;</span>
    <span class="kw">&lt;path</span><span class="ot"> id=</span><span class="st">&quot;me&quot;</span><span class="ot"> d=</span><span class="st">&quot;M 74.32,234.01 L 74.32,232.09 74.32,231.61...&quot;</span> <span class="kw">/&gt;</span>
    <span class="kw">&lt;path</span><span class="ot"> id=</span><span class="st">&quot;ms&quot;</span><span class="ot"> d=</span><span class="st">&quot;M 64.96,319.22 L 64.72,319.22 64.48,318.98...&quot;</span> <span class="kw">/&gt;</span>
    <span class="co">&lt;!-- Markup continues... --&gt;</span></code></pre></td></tr></table>
<p>To summarize, here are the steps to create the <span class="smcp">SVG</span> map.</p>
<ol type="1">
<li>Locate a suitably licensed <span class="smcp">SVG</span>-format map file or create one using a special-purpose map application.</li>
<li>Edit the <span class="smcp">SVG</span> file in a graphics application to remove extraneous components and simplify the illustration.</li>
<li>Optimize the <span class="smcp">SVG</span> file using an optimization site or application.</li>
<li>Make final adjustments (such as adding <code>id</code> attributes) in your regular <span class="smcp">HTML</span> editor.</li>
</ol>
<h3 id="step-2-embed-the-map-in-the-page">Step 2: Embed the Map in the Page</h3>
<p>The simplest way to include an <span class="smcp">SVG</span> map in a web page is to embed the <span class="smcp">SVG</span> markup directly within the <span class="smcp">HTML</span> markup. To include the first aid symbol, for example, just include the <span class="smcp">SVG</span> tags within the page itself, as in lines 9 through 18. As the example below shows, you don’t have to include the header tags that are normally present in a standalone <span class="smcp">SVG</span> file.</p>
<table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;head&gt;</span>
    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;title&gt;&lt;/title&gt;</span>
  <span class="kw">&lt;/head&gt;</span>
  <span class="kw">&lt;body&gt;</span>
    <span class="kw">&lt;div&gt;</span>
      <span class="kw">&lt;svg</span><span class="ot"> id=</span><span class="st">&quot;firstaid&quot;</span><span class="ot"> version=</span><span class="st">&quot;1.1&quot;</span> 
<span class="ot">           xmlns=</span><span class="st">&quot;http://www.w3.org/2000/svg&quot;</span> 
<span class="ot">        width=</span><span class="st">&quot;100&quot;</span><span class="ot"> height=</span><span class="st">&quot;100&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;rect</span><span class="ot"> id=</span><span class="st">&quot;background&quot;</span><span class="ot"> x=</span><span class="st">&quot;0&quot;</span><span class="ot"> y=</span><span class="st">&quot;0&quot;</span> 
<span class="ot">              width=</span><span class="st">&quot;100&quot;</span><span class="ot"> height=</span><span class="st">&quot;100&quot;</span><span class="ot"> rx=</span><span class="st">&quot;20&quot;</span> <span class="kw">/&gt;</span>
        <span class="kw">&lt;rect</span><span class="ot"> id=</span><span class="st">&quot;vertical&quot;</span><span class="ot"> x=</span><span class="st">&quot;39&quot;</span><span class="ot"> y=</span><span class="st">&quot;19&quot;</span> 
<span class="ot">              width=</span><span class="st">&quot;22&quot;</span><span class="ot"> height=</span><span class="st">&quot;62&quot;</span> <span class="kw">/&gt;</span>
        <span class="kw">&lt;rect</span><span class="ot"> id=</span><span class="st">&quot;horizontal&quot;</span><span class="ot"> x=</span><span class="st">&quot;19&quot;</span><span class="ot"> y=</span><span class="st">&quot;39&quot;</span> 
<span class="ot">              width=</span><span class="st">&quot;62&quot;</span><span class="ot"> height=</span><span class="st">&quot;22&quot;</span> <span class="kw">/&gt;</span>
      <span class="kw">&lt;/svg&gt;</span>
   <span class="kw">&lt;/div&gt;</span>
  <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre></td></tr></table>
<p>If your map is relatively simple, direct embedding is the easiest way to include it in the page. Our map of Georgia, however, is about 1 <class="smcp">MB</span> in size even after optimization. That’s not unusual for maps with reasonable resolution, as describing complex borders such as coastlines or rivers can make for large <code>&lt;path&gt;</code> elements. Especially if the map isn’t the sole focus of the page, you can provide a better user experience by loading the rest of the page first. That will give your users something to read while the map loads in the background. You can even add a simple animated progress loader if that’s appropriate for your site.</p>
<p>If you’re using jQuery, loading the map is a single instruction. You do want to make sure, though, that your code doesn’t start manipulating the map until the load is complete. Here’s how that would look in the source code.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="fu">$</span>(<span class="st">&quot;#map&quot;</span>).<span class="fu">load</span>(<span class="st">&quot;img/ga.svg&quot;</span>, <span class="kw">function</span>() {
    <span class="co">// Only manipulate the map inside this block</span>
})</code></pre></td></tr></table>
<h3 id="step-3-collect-the-data">Step 3: Collect the Data</h3>
<p>The data for our visualization is available as an Excel spreadsheet directly from <a href="http://www.countyhealthrankings.org">County Health Rankings</a>. We’ll convert that to a JavaScript object in advance, and we’ll add a two-letter code corresponding to each county. Here’s how that array might begin.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> counties = [
    {
      <span class="st">&quot;name&quot;</span>:<span class="st">&quot;Appling&quot;</span>,
      <span class="st">&quot;code&quot;</span>:<span class="st">&quot;ap&quot;</span>,
      <span class="st">&quot;outcomes_z&quot;</span>:<span class="fl">0.93</span>,
      <span class="st">&quot;outcomes_rank&quot;</span>:<span class="dv">148</span>,
      <span class="co">// Data continues...</span>
    },
    {
      <span class="st">&quot;name&quot;</span>:<span class="st">&quot;Atkinson&quot;</span>,
      <span class="st">&quot;code&quot;</span>:<span class="st">&quot;at&quot;</span>,
      <span class="st">&quot;outcomes_z&quot;</span>:<span class="fl">0.40</span>,
      <span class="st">&quot;outcomes_rank&quot;</span>:<span class="dv">118</span>,
    <span class="co">// Data set continues...</span>
];</code></pre></td></tr></table>
<p>For this visualization we’d like to show the variation in health outcomes among counties. The data set provides two variables for that value, a ranking and a z-score (a measure of how far a sample is from the mean in terms of standard deviations). The County Health Rankings provide z-scores slightly modified from the traditional statistical definition. Normal z-scores are always positive; in this data set, however, measurements that are subjectively better than average are multiplied by –1 so that they are negative. A county whose health outcome is two standard deviations “better” than the mean, for example, is given a z-score of –2 instead of 2. This adjustment makes it easier to use these z-scores in our visualization.</p>
<p>Our first step in working with these z scores is to find the maximum and minimum values. We can do that by extracting the outcomes as a separate array and then using the JavaScript built-in <code>Math.max</code> and <code>Math.min</code> functions. Note that the following code uses the <code>map()</code> method to extract the array, and that method is available only in modern browsers. Since we’ve chosen to use <span class="smcp">SVG</span> images, however, we’ve already restricted our users to modern browsers, so we might as well take advantage of that when we can.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> outcomes = <span class="ot">counties</span>.<span class="fu">map</span>(<span class="kw">function</span>(county) {<span class="kw">return</span> <span class="ot">county</span>.<span class="fu">outcomes_z</span>;});
<span class="kw">var</span> maxZ = <span class="ot">Math</span>.<span class="ot">max</span>.<span class="fu">apply</span>(<span class="kw">null</span>, outcomes);
<span class="kw">var</span> minZ = <span class="ot">Math</span>.<span class="ot">min</span>.<span class="fu">apply</span>(<span class="kw">null</span>, outcomes);</code></pre></td></tr></table>
<p>Notice how we’ve used the <code>.apply()</code> method here. Normally the <code>Math.max()</code> and <code>Math.min()</code> functions accept a comma-separated list of arguments. We, of course, have an array instead. The <code>apply()</code> method, which works with any JavaScript function, turns an array into a comma-separated list. The first parameter is the context to use, which in our case doesn’t matter, so we set it to <code>null</code>.</p>
<p>To complete the data preparation, let’s make sure the minimum and maximum ranges are symmetric about the mean. If, for example, the z-scores ranged from <code>-2</code> to <code>1.5</code>, we’ll extend the range to <code>[-2, 2]</code>. This adjustment will make the color scales symmetric as well, thus making our visualization easier for users to interpret.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">if</span> (<span class="ot">Math</span>.<span class="fu">abs</span>(minZ) &gt; <span class="ot">Math</span>.<span class="fu">abs</span>(maxZ)) {
    maxZ = -minZ;
} <span class="kw">else</span> {
    minZ = -maxZ;
}</code></pre></td></tr></table>
<h3 id="step-4-define-the-color-scheme">Step 4: Define the Color Scheme</h3>
<p>Defining an effective color scheme for a map can be quite tricky, but fortunately there are some excellent resources available. For this visualization we’ll rely on the <a href="http://driven-by-data.net/about/chromajs/">Chroma.js</a> library. That library includes many tools for working with and manipulating colors and color scales, and it can satisfy the most advanced color theorist. For our example, however, we can take advantage of the predefined color scales, specifically those defined originally by <a href="http://colorbrewer2.org/">Cynthia Brewer</a>.</p>
<p>The Chroma.js library is available on popular content distribution networks, so we can rely on a network such as CloudFlare’s <a href="http://cdnjs.com">cdnjs</a> to host it.</p>
<table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;head&gt;</span>
    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;title&gt;&lt;/title&gt;</span>
  <span class="kw">&lt;/head&gt;</span>
  <span class="kw">&lt;body&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;map&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
    <span class="kw">&lt;script</span> 
<span class="ot">     src=</span><span class="st">&quot;///cdnjs.cloudflare.com/ajax/libs/chroma-js/0.5.2/chroma.min.js&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;/script&gt;</span>
  <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre></td></tr></table>
<p>To use a predefined scale we pass the scale’s name (<code>&quot;BrBG&quot;</code> for the Brewer’s brown to blue/green scale) to the <code>chroma.scale()</code> function. At the same time we indicate the domain for our scale (<code>minZ</code> to <code>maxZ</code>, although we’re reversing the order because of the data set’s z-score adjustment) and our desired output. The <code>&quot;hex&quot;</code> output is the common <code>&quot;#012345&quot;</code> format compatible with <span class="smcp">CSS</span> and <span class="smcp">HTML</span> markup.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> scale = <span class="ot">chroma</span>.<span class="fu">scale</span>(<span class="st">&quot;BrBG&quot;</span>).<span class="fu">domain</span>([maxZ, minZ]).<span class="fu">out</span>(<span class="st">&quot;hex&quot;</span>);</code></pre></td></tr></table>
<h3 id="step-5-color-the-map">Step 5: Color the Map</h3>
<p>With our color scheme established, we can now apply the appropriate colors to each county on the map. That’s probably the easiest step in the whole visualization. We iterate through all the counties, finding their <code>&lt;path&gt;</code> elements based on their <code>id</code> values, and applying the color by setting the <code>fill</code> attribute.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">counties</span>.<span class="fu">forEach</span>(<span class="kw">function</span>(county) {
    <span class="ot">document</span>.<span class="fu">getElementById</span>(<span class="ot">county</span>.<span class="fu">code</span>)
      .<span class="fu">setAttribute</span>(<span class="st">&quot;fill&quot;</span>, <span class="fu">scale</span>(<span class="ot">county</span>.<span class="fu">outcomes_z</span>));
})</code></pre></td></tr></table>
<p>The resulting map, shown in figure <span class="nextfigure"/>, illustrates which counties are above average and which are below average for health outcomes in 2014.</p>
<figure>
<div id="map-svg-1">

</div>
<figcaption>
<span class="lgcp">CSS</span> rules can set the styles for individual <span class="smcp">SVG</span> elements within an <span class="smcp">SVG</span> illustration.
</figcaption>
</figure>
<h3 id="step-6-add-a-legend">Step 6: Add a Legend</h3>
<p>To help users interpret the map we can add a legend to the visualization. We can take advantage of the Chroma.js scale to easily create a table that explains the variation. For the table we’ll use four increments for the colors on each side of the mean value. That gives us a total of nine colors for the legend.</p>
<table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="kw">&lt;table</span><span class="ot"> id=</span><span class="st">&quot;legend&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;tr</span><span class="ot"> class=</span><span class="st">&quot;scale&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;</span>
        <span class="kw">&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;</span>
    <span class="kw">&lt;/tr&gt;</span>
    <span class="kw">&lt;tr</span><span class="ot"> class=</span><span class="st">&quot;text&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;td</span><span class="ot"> colspan=</span><span class="st">&quot;4&quot;</span><span class="kw">&gt;</span>Worse than Average<span class="kw">&lt;/td&gt;</span>
        <span class="kw">&lt;td&gt;</span>Average<span class="kw">&lt;/td&gt;</span>
        <span class="kw">&lt;td</span><span class="ot"> colspan=</span><span class="st">&quot;4&quot;</span><span class="kw">&gt;</span>Better than Average<span class="kw">&lt;/td&gt;</span>
    <span class="kw">&lt;/tr&gt;</span>
<span class="kw">&lt;/table&gt;</span></code></pre></td></tr></table>
<p>Some straightforward <span class="smcp">CSS</span> will style the table appropriately. Because we have nine colors, we set the width of each table cell to 11.1111% (1/9 is 0.111111).</p>
<table class="sourceCode css numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="sourceCode"><pre><code class="sourceCode css">table<span class="fl">#legend</span> tr<span class="fl">.scale</span> td <span class="kw">{</span>
    <span class="kw">height:</span> <span class="dt">1em</span><span class="kw">;</span>
    <span class="kw">width:</span> <span class="dt">11.1111%</span><span class="kw">;</span>
<span class="kw">}</span>
table<span class="fl">#legend</span> tr<span class="fl">.text</span> td<span class="dv">:first-child</span> <span class="kw">{</span>
    <span class="kw">text-align:</span> <span class="dt">left</span><span class="kw">;</span>
<span class="kw">}</span>
table<span class="fl">#legend</span> tr<span class="fl">.text</span> td<span class="dv">:nth-child</span>(2) <span class="kw">{</span>
    <span class="kw">text-align:</span> <span class="dt">center</span><span class="kw">;</span>
<span class="kw">}</span>
table<span class="fl">#legend</span> tr<span class="fl">.text</span> td<span class="dv">:last-child</span> <span class="kw">{</span>
    <span class="kw">text-align:</span> <span class="dt">right</span><span class="kw">;</span>
<span class="kw">}</span></code></pre></td></tr></table>
<p>Finally, we use the Chroma scale created earlier to set the background color for the legend’s table cells. Because the legend is a <code>&lt;table&gt;</code> element, we can directly access the rows and the cells within the rows. Although these elements look like arrays in the following code, they’re not true JavaScript arrays, so they don’t support array methods such as <code>forEach()</code>. For now, we’ll iterate through them with a <code>for</code> loop, but if you’d rather use the array methods stay tuned for a simple trick. Note that once again we’re working backward because of the data set’s z-score adjustments.</p>
<table class="sourceCode javascript numberLines line-5"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> legend = <span class="ot">document</span>.<span class="fu">getElementById</span>(<span class="st">&quot;legend&quot;</span>);
<span class="kw">var</span> cells = <span class="ot">legend</span>.<span class="fu">rows</span>[<span class="dv">0</span>].<span class="fu">cells</span>;
<span class="kw">for</span> (<span class="kw">var</span> idx=<span class="dv">0</span>; idx&lt;<span class="ot">cells</span>.<span class="fu">length</span>; idx++) {
    <span class="kw">var</span> td = cells[idx];
    <span class="ot">td</span>.<span class="ot">style</span>.<span class="fu">backgroundColor</span> = <span class="fu">scale</span>(maxZ - 
        ((idx + <span class="fl">0.5</span>) / <span class="ot">cells</span>.<span class="fu">length</span>) * (maxZ - minZ));
};</code></pre></td></tr></table>
<p>In line 5 we calculate the fraction of the current index from the total number of legend colors <code>((idx + 0.5) / cells.length)</code>, multiply that by the total range of the scale <code>(maxZ - minZ)</code>, and subtract the result from the maximum value.</p>
<p>The result is the legend for the map in figure <span class="nextfigure"/>.</p>
<style>
table#legend-svg-1, table#legend-svg-2 {
    width: 497px;
    border: none;
}
table#legend-svg-1 td, table#legend-svg-2 td {
    border: none;
}
table#legend-svg-1 tbody:first-child tr:first-child>td:first-child,
table#legend-svg-2 tbody:first-child tr:first-child>td:first-child {
    -webkit-border-top-left-radius: 0;
        -moz-border-radius-topleft: 0;
            border-top-left-radius: 0;
}
table#legend-svg-1 tbody:first-child tr:first-child>td:last-child,
table#legend-svg-2 tbody:first-child tr:first-child>td:last-child {
    -webkit-border-top-right-radius: 0;
        -moz-border-radius-topright: 0;
            border-top-right-radius: 0;
}
table#legend-svg-1 tr.scale td, table#legend-svg-2 tr.scale td {
    height: 0.5em;
    width: 11.1111%;
}
table#legend-svg-1 tr.text td, table#legend-svg-2 tr.text td {
    padding-left: 0;
    padding-right: 0;
}
table#legend-svg-1 tr.text td:first-child, table#legend-svg-2 tr.text td:first-child {
    text-align: left;
}
table#legend-svg-1 tr.text td:nth-child(2), table#legend-svg-2 tr.text td:nth-child(2) {
    text-align: center;
}
table#legend-svg-1 tr.text td:last-child, table#legend-svg-2 tr.text td:last-child {
    text-align: right;
}
</style>
<figure>
<table id="legend-svg-1">
<tr class="scale">
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr class="text">
<td colspan="4">
Worse than Average
</td>
<td>
Average
</td>
<td colspan="4">
Better than Average
</td>
</tr>
</table>
<figcaption>
An <span class="smcp">HTML</span> &lt;table&gt; can serve as a legend.
</figcaption>
</figure>
<h3 id="step-7-add-interactions">Step 7: Add Interactions</h3>
<p>To complete the visualization, let’s enable users to hover their mouse over a county on the map to see more details. Of course, mouse interactions are not available for tablet or smartphone users. To support those users you could add a similar interaction for tap or click events. That code would be almost identical to the next example.</p>
<p>We’ll start by defining a table to show county details.</p>
<table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="kw">&lt;table</span><span class="ot"> id=</span><span class="st">&quot;details&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>County:<span class="kw">&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>Rank:<span class="kw">&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>Health Behaviors:<span class="kw">&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>Clinical Care:<span class="kw">&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>Social <span class="er">&amp;</span> Economic Factors:<span class="kw">&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>Physical Environment:<span class="kw">&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="kw">&lt;/table&gt;</span></code></pre></td></tr></table>
<p>Initially, we don’t want that table to be visible.</p>
<table class="sourceCode css numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode css">table<span class="fl">#details</span> <span class="kw">{</span>
    <span class="kw">display:</span> <span class="dt">none</span><span class="kw">;</span>
<span class="kw">}</span></code></pre></td></tr></table>
<p>To show the table we use event handler functions that track when the mouse enters or leaves an <span class="smcp">SVG</span> path for a county. To find these <code>&lt;path&gt;</code> elements, we can use the <code>querySelectorAll()</code> function that modern browsers support. Unfortunately, that function doesn’t return a true array of elements, so we can’t use array methods such as <code>forEach()</code> to iterate through those elements. There’s a trick, however, that will let us convert the returned list into a true array. The following code shows this trick; it calls the <code>[].slice.call()</code> function with the “not quite array” object as its parameter. The result is a true array with all of its useful methods.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">[].<span class="ot">slice</span>.<span class="fu">call</span>(<span class="ot">document</span>.<span class="fu">querySelectorAll</span>(<span class="st">&#39;#map path&#39;</span>))
    .<span class="fu">forEach</span>(<span class="kw">function</span>(path) {
        <span class="ot">path</span>.<span class="fu">addEventListener</span>(<span class="st">&#39;mouseenter&#39;</span>, <span class="kw">function</span>(){
            <span class="ot">document</span>.<span class="fu">getElementById</span>(<span class="st">&quot;details&quot;</span>).<span class="ot">style</span>.<span class="fu">display</span> = <span class="st">&quot;table&quot;</span>;
        });
        <span class="ot">path</span>.<span class="fu">addEventListener</span>(<span class="st">&#39;mouseleave&#39;</span>, <span class="kw">function</span>(){
            <span class="ot">document</span>.<span class="fu">getElementById</span>(<span class="st">&quot;details&quot;</span>).<span class="ot">style</span>.<span class="fu">display</span> = <span class="st">&quot;none&quot;</span>;
        });
    }
);</code></pre></td></tr></table>
<p>In addition to making the details table visible, we’ll also want to update it with the appropriate information. To help with this display, we can write a function that converts a Z score into a more user-friendly explanation. The specific values in the following example are arbitrary since we’re not trying for statistical precision in this visualization.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> zToText = <span class="kw">function</span>(z) {
    z = +z;
    <span class="kw">if</span> (z &gt;  <span class="fl">0.25</span>) { <span class="kw">return</span> <span class="st">&quot;Far below Average&quot;</span>; }
    <span class="kw">if</span> (z &gt;  <span class="fl">0.1</span>)  { <span class="kw">return</span> <span class="st">&quot;Below Average&quot;</span>; }
    <span class="kw">if</span> (z &gt; -<span class="fl">0.1</span>)  { <span class="kw">return</span> <span class="st">&quot;Average&quot;</span>; }
    <span class="kw">if</span> (z &gt; -<span class="fl">0.25</span>) { <span class="kw">return</span> <span class="st">&quot;Above Average&quot;</span>; }
    <span class="kw">return</span> <span class="st">&quot;Far above Average&quot;</span>;
}</code></pre></td></tr></table>
<p>There are a couple of noteworthy items in this function. First, the statement, <code>z = +z</code> converts the z-score from a string to a numeric value for the tests that follow. Second, remember that because of the z-score adjustments the negative z-scores are actually better than average, while the positive values are below average.</p>
<p>We can use this function to provide the data for our details table. The first step is finding the full data set for the associated <code>&lt;path&gt;</code> element. To do that we search through the <code>counties</code> array looking for a <code>code</code> property that matches the <code>id</code> attribute of the path. Because <code>indexOf()</code> doesn’t allow us to find objects by key, we’ll borrow the <code>some()</code> method instead. That method terminates as soon as it finds a match, so we avoid iterating through the entire array.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> county = <span class="kw">null</span>;
<span class="ot">counties</span>.<span class="fu">some</span>(<span class="kw">function</span>(c) {
    <span class="kw">if</span> (<span class="ot">c</span>.<span class="fu">code</span> === <span class="kw">this</span>.<span class="fu">id</span>) {
        county = c;
        <span class="kw">return</span> <span class="kw">true</span>;
    }
    <span class="kw">return</span> <span class="kw">false</span>;
});</code></pre></td></tr></table>
<p>Once we’ve found the county data, it’s a straightforward process to update the table. The following code directly updates the relevant table cell’s text content. For a more robust implementation, you could provide class names for the cells and update based on those class names.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> table = <span class="ot">document</span>.<span class="fu">getElementById</span>(<span class="st">&quot;details&quot;</span>);
<span class="ot">table</span>.<span class="fu">rows</span>[<span class="dv">0</span>].<span class="fu">cells</span>[<span class="dv">1</span>].<span class="fu">textContent</span> = 
    <span class="ot">county</span>.<span class="fu">name</span>;
<span class="ot">table</span>.<span class="fu">rows</span>[<span class="dv">1</span>].<span class="fu">cells</span>[<span class="dv">1</span>].<span class="fu">textContent</span> = 
    <span class="ot">county</span>.<span class="fu">outcomes_rank</span> + <span class="st">&quot; out of &quot;</span> + <span class="ot">counties</span>.<span class="fu">length</span>;
<span class="ot">table</span>.<span class="fu">rows</span>[<span class="dv">2</span>].<span class="fu">cells</span>[<span class="dv">1</span>].<span class="fu">textContent</span> = 
    <span class="fu">zToText</span>(<span class="ot">county</span>.<span class="fu">health_behaviors_z</span>);
<span class="ot">table</span>.<span class="fu">rows</span>[<span class="dv">3</span>].<span class="fu">cells</span>[<span class="dv">1</span>].<span class="fu">textContent</span> = 
    <span class="fu">zToText</span>(<span class="ot">county</span>.<span class="fu">clinical_care_z</span>);
<span class="ot">table</span>.<span class="fu">rows</span>[<span class="dv">4</span>].<span class="fu">cells</span>[<span class="dv">1</span>].<span class="fu">textContent</span> = 
    <span class="fu">zToText</span>(<span class="ot">county</span>.<span class="fu">social_and_economic_factors_z</span>);
<span class="ot">table</span>.<span class="fu">rows</span>[<span class="dv">5</span>].<span class="fu">cells</span>[<span class="dv">1</span>].<span class="fu">textContent</span> = 
    <span class="fu">zToText</span>(<span class="ot">county</span>.<span class="fu">physical_environment_z</span>);</code></pre></td></tr></table>
<p>For the last refinement, let’s add a stroke color for counties that are highlighted (line 3). We remove the stroke (in line 7) when the mouse leaves the path.</p>
<table class="sourceCode javascript numberLines line-3 line-7"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">path</span>.<span class="fu">addEventListener</span>(<span class="st">&#39;mouseleave&#39;</span>, <span class="kw">function</span>(){
    <span class="co">// Previous code</span>
    <span class="kw">this</span>.<span class="fu">setAttribute</span>(<span class="st">&quot;stroke&quot;</span>, <span class="st">&quot;#444444&quot;</span>);
});
<span class="ot">path</span>.<span class="fu">addEventListener</span>(<span class="st">&#39;mouseleave&#39;</span>, <span class="kw">function</span>(){
    <span class="co">// Previous code</span>
    <span class="kw">this</span>.<span class="fu">setAttribute</span>(<span class="st">&quot;stroke&quot;</span>, <span class="st">&quot;none&quot;</span>);
});</code></pre></td></tr></table>
<style>
#svg-2 {
    position: relative;
}
table#details-svg-2 {
    font-size: 0.7em;
    display: none;
    position: absolute;
    left: 356px;
    width: auto;
}
table#details-svg-2 tr td:first-child {
    font-weight: bold;
}
</style>
<p>At this point our visualization example is complete. Figure <span class="nextfigure"/> shows the result.</p>
<h3 id="health-outcomes-in-georgia-counties">2014 Health Outcomes in Georgia Counties</h3>
<figure id="svg-2">
<table id="details-svg-2">
<tr>
<td>
County:
</td>
<td>
name
</td>
</tr>
<tr>
<td>
Rank:
</td>
<td>
outcomes_rank
</td>
</tr>
<tr>
<td>
Health Behaviors:
</td>
<td>
</td>
</tr>
<tr>
<td>
Clinical Care:
</td>
<td>
</td>
</tr>
<tr>
<td>
Social &amp; Economic Factors:
</td>
<td>
</td>
</tr>
<tr>
<td>
Physical Environment:
</td>
<td>
</td>
</tr>
</table>
<div id="map-svg-2">

</div>
<table id="legend-svg-2">
<tr class="scale">
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr class="text">
<td colspan="4">
Worse than Average
</td>
<td>
Average
</td>
<td colspan="4">
Better than Average
</td>
</tr>
</table>
<figcaption>
Browsers (and a bit of code) can turn <span class="smcp">SVG</span> illustrations into interactive visualizations.
</figcaption>
</figure>
<script>
;(function(){

    draw = function() {

        var counties = [
          {
            "name":"Appling",
            "code":"ap",
            "outcomes_z":0.93,
            "outcomes_rank":148,
            "factors_z":0.49,
            "factors_rank":144,
            "length_of_life_z":0.51,
            "length_of_life_rank":141,
            "quality_of_life_z":0.42,
            "quality_of_life_rank":145,
            "health_behaviors_z":0.25,
            "health_behaviors_rank":155,
            "clinical_care_z":0.14,
            "clinical_care_rank":143,
            "social_and_economic_factors_z":0.16,
            "social_and_economic_factors_rank":116,
            "physical_environment_z":-0.07,
            "physical_environment_rank":12
          },
          {
            "name":"Atkinson",
            "code":"at",
            "outcomes_z":0.40,
            "outcomes_rank":118,
            "factors_z":0.62,
            "factors_rank":154,
            "length_of_life_z":0.33,
            "length_of_life_rank":120,
            "quality_of_life_z":0.07,
            "quality_of_life_rank":94,
            "health_behaviors_z":0.06,
            "health_behaviors_rank":102,
            "clinical_care_z":0.37,
            "clinical_care_rank":159,
            "social_and_economic_factors_z":0.26,
            "social_and_economic_factors_rank":137,
            "physical_environment_z":-0.06,
            "physical_environment_rank":17
          },
          {
            "name":"Bacon",
            "code":"ba",
            "outcomes_z":0.35,
            "outcomes_rank":109,
            "factors_z":0.24,
            "factors_rank":110,
            "length_of_life_z":0.43,
            "length_of_life_rank":133,
            "quality_of_life_z":-0.08,
            "quality_of_life_rank":64,
            "health_behaviors_z":0.08,
            "health_behaviors_rank":109,
            "clinical_care_z":0.21,
            "clinical_care_rank":152,
            "social_and_economic_factors_z":0.03,
            "social_and_economic_factors_rank":77,
            "physical_environment_z":-0.07,
            "physical_environment_rank":14
          },
          {
            "name":"Baker",
            "code":"bk",
            "outcomes_z":0.02,
            "outcomes_rank":72,
            "factors_z":0.30,
            "factors_rank":119,
            "length_of_life_z":-0.02,
            "length_of_life_rank":80,
            "quality_of_life_z":0.04,
            "quality_of_life_rank":91,
            "health_behaviors_z":0.14,
            "health_behaviors_rank":131,
            "clinical_care_z":0.04,
            "clinical_care_rank":106,
            "social_and_economic_factors_z":0.11,
            "social_and_economic_factors_rank":99,
            "physical_environment_z":0.01,
            "physical_environment_rank":88
          },
          {
            "name":"Baldwin",
            "code":"bd",
            "outcomes_z":0.08,
            "outcomes_rank":76,
            "factors_z":0.10,
            "factors_rank":82,
            "length_of_life_z":-0.30,
            "length_of_life_rank":43,
            "quality_of_life_z":0.38,
            "quality_of_life_rank":140,
            "health_behaviors_z":0.07,
            "health_behaviors_rank":107,
            "clinical_care_z":-0.15,
            "clinical_care_rank":15,
            "social_and_economic_factors_z":0.18,
            "social_and_economic_factors_rank":121,
            "physical_environment_z":0.00,
            "physical_environment_rank":84
          },
          {
            "name":"Banks",
            "code":"bn",
            "outcomes_z":-0.37,
            "outcomes_rank":48,
            "factors_z":-0.11,
            "factors_rank":53,
            "length_of_life_z":-0.26,
            "length_of_life_rank":50,
            "quality_of_life_z":-0.11,
            "quality_of_life_rank":59,
            "health_behaviors_z":-0.02,
            "health_behaviors_rank":65,
            "clinical_care_z":0.10,
            "clinical_care_rank":132,
            "social_and_economic_factors_z":-0.24,
            "social_and_economic_factors_rank":30,
            "physical_environment_z":0.06,
            "physical_environment_rank":144
          },
          {
            "name":"Barrow",
            "code":"bw",
            "outcomes_z":-0.50,
            "outcomes_rank":38,
            "factors_z":-0.10,
            "factors_rank":57,
            "length_of_life_z":-0.28,
            "length_of_life_rank":46,
            "quality_of_life_z":-0.21,
            "quality_of_life_rank":37,
            "health_behaviors_z":0.05,
            "health_behaviors_rank":92,
            "clinical_care_z":0.01,
            "clinical_care_rank":91,
            "social_and_economic_factors_z":-0.20,
            "social_and_economic_factors_rank":36,
            "physical_environment_z":0.04,
            "physical_environment_rank":135
          },
          {
            "name":"Bartow",
            "code":"bt",
            "outcomes_z":-0.33,
            "outcomes_rank":54,
            "factors_z":-0.19,
            "factors_rank":44,
            "length_of_life_z":-0.22,
            "length_of_life_rank":56,
            "quality_of_life_z":-0.11,
            "quality_of_life_rank":58,
            "health_behaviors_z":-0.10,
            "health_behaviors_rank":37,
            "clinical_care_z":-0.01,
            "clinical_care_rank":76,
            "social_and_economic_factors_z":-0.14,
            "social_and_economic_factors_rank":43,
            "physical_environment_z":0.06,
            "physical_environment_rank":146
          },
          {
            "name":"Ben Hill",
            "code":"bh",
            "outcomes_z":0.85,
            "outcomes_rank":146,
            "factors_z":0.53,
            "factors_rank":149,
            "length_of_life_z":0.13,
            "length_of_life_rank":95,
            "quality_of_life_z":0.73,
            "quality_of_life_rank":158,
            "health_behaviors_z":0.17,
            "health_behaviors_rank":140,
            "clinical_care_z":0.07,
            "clinical_care_rank":122,
            "social_and_economic_factors_z":0.33,
            "social_and_economic_factors_rank":147,
            "physical_environment_z":-0.03,
            "physical_environment_rank":39
          },
          {
            "name":"Berrien",
            "code":"bi",
            "outcomes_z":0.15,
            "outcomes_rank":88,
            "factors_z":0.33,
            "factors_rank":124,
            "length_of_life_z":-0.15,
            "length_of_life_rank":65,
            "quality_of_life_z":0.30,
            "quality_of_life_rank":132,
            "health_behaviors_z":0.18,
            "health_behaviors_rank":145,
            "clinical_care_z":0.15,
            "clinical_care_rank":147,
            "social_and_economic_factors_z":0.04,
            "social_and_economic_factors_rank":82,
            "physical_environment_z":-0.04,
            "physical_environment_rank":32
          },
          {
            "name":"Bibb",
            "code":"bb",
            "outcomes_z":0.67,
            "outcomes_rank":139,
            "factors_z":0.01,
            "factors_rank":74,
            "length_of_life_z":0.53,
            "length_of_life_rank":144,
            "quality_of_life_z":0.14,
            "quality_of_life_rank":106,
            "health_behaviors_z":-0.07,
            "health_behaviors_rank":46,
            "clinical_care_z":-0.19,
            "clinical_care_rank":5,
            "social_and_economic_factors_z":0.24,
            "social_and_economic_factors_rank":132,
            "physical_environment_z":0.02,
            "physical_environment_rank":104
          },
          {
            "name":"Bleckley",
            "code":"bl",
            "outcomes_z":0.53,
            "outcomes_rank":131,
            "factors_z":-0.03,
            "factors_rank":68,
            "length_of_life_z":0.30,
            "length_of_life_rank":116,
            "quality_of_life_z":0.23,
            "quality_of_life_rank":119,
            "health_behaviors_z":-0.05,
            "health_behaviors_rank":53,
            "clinical_care_z":-0.09,
            "clinical_care_rank":35,
            "social_and_economic_factors_z":0.12,
            "social_and_economic_factors_rank":101,
            "physical_environment_z":-0.00,
            "physical_environment_rank":82
          },
          {
            "name":"Brantley",
            "code":"be",
            "outcomes_z":0.40,
            "outcomes_rank":119,
            "factors_z":0.40,
            "factors_rank":131,
            "length_of_life_z":0.49,
            "length_of_life_rank":140,
            "quality_of_life_z":-0.09,
            "quality_of_life_rank":62,
            "health_behaviors_z":0.00,
            "health_behaviors_rank":74,
            "clinical_care_z":0.24,
            "clinical_care_rank":155,
            "social_and_economic_factors_z":0.17,
            "social_and_economic_factors_rank":119,
            "physical_environment_z":-0.01,
            "physical_environment_rank":69
          },
          {
            "name":"Brooks",
            "code":"bo",
            "outcomes_z":0.02,
            "outcomes_rank":73,
            "factors_z":0.29,
            "factors_rank":116,
            "length_of_life_z":-0.29,
            "length_of_life_rank":44,
            "quality_of_life_z":0.32,
            "quality_of_life_rank":135,
            "health_behaviors_z":0.10,
            "health_behaviors_rank":119,
            "clinical_care_z":0.05,
            "clinical_care_rank":110,
            "social_and_economic_factors_z":0.22,
            "social_and_economic_factors_rank":126,
            "physical_environment_z":-0.08,
            "physical_environment_rank":7
          },
          {
            "name":"Bryan",
            "code":"br",
            "outcomes_z":-0.83,
            "outcomes_rank":19,
            "factors_z":-0.88,
            "factors_rank":8,
            "length_of_life_z":-0.37,
            "length_of_life_rank":33,
            "quality_of_life_z":-0.47,
            "quality_of_life_rank":12,
            "health_behaviors_z":-0.28,
            "health_behaviors_rank":10,
            "clinical_care_z":-0.17,
            "clinical_care_rank":9,
            "social_and_economic_factors_z":-0.49,
            "social_and_economic_factors_rank":7,
            "physical_environment_z":0.05,
            "physical_environment_rank":140
          },
          {
            "name":"Bulloch",
            "code":"bc",
            "outcomes_z":-0.37,
            "outcomes_rank":47,
            "factors_z":-0.08,
            "factors_rank":61,
            "length_of_life_z":-0.27,
            "length_of_life_rank":48,
            "quality_of_life_z":-0.11,
            "quality_of_life_rank":60,
            "health_behaviors_z":0.00,
            "health_behaviors_rank":76,
            "clinical_care_z":0.02,
            "clinical_care_rank":94,
            "social_and_economic_factors_z":-0.11,
            "social_and_economic_factors_rank":48,
            "physical_environment_z":0.00,
            "physical_environment_rank":85
          },
          {
            "name":"Burke",
            "code":"bu",
            "outcomes_z":0.84,
            "outcomes_rank":145,
            "factors_z":0.34,
            "factors_rank":125,
            "length_of_life_z":0.51,
            "length_of_life_rank":142,
            "quality_of_life_z":0.33,
            "quality_of_life_rank":138,
            "health_behaviors_z":-0.05,
            "health_behaviors_rank":56,
            "clinical_care_z":-0.02,
            "clinical_care_rank":66,
            "social_and_economic_factors_z":0.40,
            "social_and_economic_factors_rank":152,
            "physical_environment_z":0.01,
            "physical_environment_rank":90
          },
          {
            "name":"Butts",
            "code":"bs",
            "outcomes_z":0.64,
            "outcomes_rank":137,
            "factors_z":0.12,
            "factors_rank":87,
            "length_of_life_z":0.63,
            "length_of_life_rank":148,
            "quality_of_life_z":0.02,
            "quality_of_life_rank":84,
            "health_behaviors_z":-0.01,
            "health_behaviors_rank":69,
            "clinical_care_z":-0.05,
            "clinical_care_rank":49,
            "social_and_economic_factors_z":0.08,
            "social_and_economic_factors_rank":93,
            "physical_environment_z":0.11,
            "physical_environment_rank":156
          },
          {
            "name":"Calhoun",
            "code":"cl",
            "outcomes_z":-0.42,
            "outcomes_rank":41,
            "factors_z":0.26,
            "factors_rank":113,
            "length_of_life_z":-0.65,
            "length_of_life_rank":12,
            "quality_of_life_z":0.23,
            "quality_of_life_rank":121,
            "health_behaviors_z":0.03,
            "health_behaviors_rank":87,
            "clinical_care_z":0.17,
            "clinical_care_rank":148,
            "social_and_economic_factors_z":0.17,
            "social_and_economic_factors_rank":120,
            "physical_environment_z":-0.12,
            "physical_environment_rank":1
          },
          {
            "name":"Camden",
            "code":"cm",
            "outcomes_z":-1.00,
            "outcomes_rank":10,
            "factors_z":-0.51,
            "factors_rank":19,
            "length_of_life_z":-0.60,
            "length_of_life_rank":16,
            "quality_of_life_z":-0.39,
            "quality_of_life_rank":19,
            "health_behaviors_z":-0.05,
            "health_behaviors_rank":55,
            "clinical_care_z":-0.15,
            "clinical_care_rank":17,
            "social_and_economic_factors_z":-0.29,
            "social_and_economic_factors_rank":25,
            "physical_environment_z":-0.02,
            "physical_environment_rank":57
          },
          {
            "name":"Candler",
            "code":"cn",
            "outcomes_z":0.12,
            "outcomes_rank":82,
            "factors_z":0.45,
            "factors_rank":138,
            "length_of_life_z":0.45,
            "length_of_life_rank":136,
            "quality_of_life_z":-0.34,
            "quality_of_life_rank":27,
            "health_behaviors_z":0.19,
            "health_behaviors_rank":146,
            "clinical_care_z":0.23,
            "clinical_care_rank":154,
            "social_and_economic_factors_z":0.07,
            "social_and_economic_factors_rank":92,
            "physical_environment_z":-0.04,
            "physical_environment_rank":28
          },
          {
            "name":"Carroll",
            "code":"cr",
            "outcomes_z":-0.29,
            "outcomes_rank":58,
            "factors_z":-0.11,
            "factors_rank":54,
            "length_of_life_z":-0.11,
            "length_of_life_rank":70,
            "quality_of_life_z":-0.18,
            "quality_of_life_rank":46,
            "health_behaviors_z":-0.01,
            "health_behaviors_rank":70,
            "clinical_care_z":-0.08,
            "clinical_care_rank":39,
            "social_and_economic_factors_z":-0.09,
            "social_and_economic_factors_rank":55,
            "physical_environment_z":0.07,
            "physical_environment_rank":149
          },
          {
            "name":"Catoosa",
            "code":"cs",
            "outcomes_z":-0.46,
            "outcomes_rank":39,
            "factors_z":-0.50,
            "factors_rank":20,
            "length_of_life_z":-0.51,
            "length_of_life_rank":21,
            "quality_of_life_z":0.05,
            "quality_of_life_rank":92,
            "health_behaviors_z":0.01,
            "health_behaviors_rank":77,
            "clinical_care_z":-0.07,
            "clinical_care_rank":43,
            "social_and_economic_factors_z":-0.46,
            "social_and_economic_factors_rank":8,
            "physical_environment_z":0.03,
            "physical_environment_rank":111
          },
          {
            "name":"Charlton",
            "code":"ch",
            "outcomes_z":0.18,
            "outcomes_rank":93,
            "factors_z":0.43,
            "factors_rank":135,
            "length_of_life_z":0.04,
            "length_of_life_rank":85,
            "quality_of_life_z":0.14,
            "quality_of_life_rank":107,
            "health_behaviors_z":0.26,
            "health_behaviors_rank":156,
            "clinical_care_z":0.15,
            "clinical_care_rank":146,
            "social_and_economic_factors_z":0.07,
            "social_and_economic_factors_rank":90,
            "physical_environment_z":-0.04,
            "physical_environment_rank":27
          },
          {
            "name":"Chatham",
            "code":"ca",
            "outcomes_z":-0.34,
            "outcomes_rank":52,
            "factors_z":-0.32,
            "factors_rank":36,
            "length_of_life_z":-0.16,
            "length_of_life_rank":64,
            "quality_of_life_z":-0.18,
            "quality_of_life_rank":48,
            "health_behaviors_z":-0.11,
            "health_behaviors_rank":35,
            "clinical_care_z":-0.17,
            "clinical_care_rank":10,
            "social_and_economic_factors_z":-0.04,
            "social_and_economic_factors_rank":63,
            "physical_environment_z":-0.00,
            "physical_environment_rank":81
          },
          {
            "name":"Chattahoochee",
            "code":"cc",
            "outcomes_z":-0.22,
            "outcomes_rank":63,
            "factors_z":-0.29,
            "factors_rank":40,
            "length_of_life_z":-0.04,
            "length_of_life_rank":79,
            "quality_of_life_z":-0.19,
            "quality_of_life_rank":43,
            "health_behaviors_z":0.06,
            "health_behaviors_rank":101,
            "clinical_care_z":-0.14,
            "clinical_care_rank":21,
            "social_and_economic_factors_z":-0.10,
            "social_and_economic_factors_rank":51,
            "physical_environment_z":-0.11,
            "physical_environment_rank":2
          },
          {
            "name":"Chattooga",
            "code":"cg",
            "outcomes_z":0.51,
            "outcomes_rank":129,
            "factors_z":0.24,
            "factors_rank":109,
            "length_of_life_z":0.20,
            "length_of_life_rank":104,
            "quality_of_life_z":0.31,
            "quality_of_life_rank":133,
            "health_behaviors_z":0.11,
            "health_behaviors_rank":121,
            "clinical_care_z":0.02,
            "clinical_care_rank":96,
            "social_and_economic_factors_z":0.04,
            "social_and_economic_factors_rank":85,
            "physical_environment_z":0.06,
            "physical_environment_rank":147
          },
          {
            "name":"Cherokee",
            "code":"ce",
            "outcomes_z":-1.47,
            "outcomes_rank":5,
            "factors_z":-0.96,
            "factors_rank":6,
            "length_of_life_z":-0.88,
            "length_of_life_rank":7,
            "quality_of_life_z":-0.59,
            "quality_of_life_rank":4,
            "health_behaviors_z":-0.27,
            "health_behaviors_rank":11,
            "clinical_care_z":-0.12,
            "clinical_care_rank":28,
            "social_and_economic_factors_z":-0.61,
            "social_and_economic_factors_rank":5,
            "physical_environment_z":0.04,
            "physical_environment_rank":130
          },
          {
            "name":"Clarke",
            "code":"ck",
            "outcomes_z":-0.85,
            "outcomes_rank":16,
            "factors_z":-0.63,
            "factors_rank":12,
            "length_of_life_z":-0.63,
            "length_of_life_rank":14,
            "quality_of_life_z":-0.22,
            "quality_of_life_rank":35,
            "health_behaviors_z":-0.26,
            "health_behaviors_rank":13,
            "clinical_care_z":-0.15,
            "clinical_care_rank":18,
            "social_and_economic_factors_z":-0.25,
            "social_and_economic_factors_rank":28,
            "physical_environment_z":0.03,
            "physical_environment_rank":112
          },
          {
            "name":"Clay",
            "code":"cy",
            "outcomes_z":1.68,
            "outcomes_rank":159,
            "factors_z":0.28,
            "factors_rank":115,
            "length_of_life_z":1.50,
            "length_of_life_rank":159,
            "quality_of_life_z":0.18,
            "quality_of_life_rank":113,
            "health_behaviors_z":0.03,
            "health_behaviors_rank":83,
            "clinical_care_z":-0.03,
            "clinical_care_rank":60,
            "social_and_economic_factors_z":0.29,
            "social_and_economic_factors_rank":141,
            "physical_environment_z":-0.01,
            "physical_environment_rank":76
          },
          {
            "name":"Clayton",
            "code":"ct",
            "outcomes_z":-0.41,
            "outcomes_rank":44,
            "factors_z":0.37,
            "factors_rank":129,
            "length_of_life_z":-0.33,
            "length_of_life_rank":39,
            "quality_of_life_z":-0.07,
            "quality_of_life_rank":67,
            "health_behaviors_z":0.00,
            "health_behaviors_rank":75,
            "clinical_care_z":0.06,
            "clinical_care_rank":119,
            "social_and_economic_factors_z":0.25,
            "social_and_economic_factors_rank":136,
            "physical_environment_z":0.05,
            "physical_environment_rank":141
          },
          {
            "name":"Clinch",
            "code":"ci",
            "outcomes_z":1.07,
            "outcomes_rank":149,
            "factors_z":0.31,
            "factors_rank":121,
            "length_of_life_z":0.78,
            "length_of_life_rank":153,
            "quality_of_life_z":0.28,
            "quality_of_life_rank":131,
            "health_behaviors_z":0.10,
            "health_behaviors_rank":120,
            "clinical_care_z":0.21,
            "clinical_care_rank":153,
            "social_and_economic_factors_z":0.06,
            "social_and_economic_factors_rank":87,
            "physical_environment_z":-0.06,
            "physical_environment_rank":19
          },
          {
            "name":"Cobb",
            "code":"cb",
            "outcomes_z":-1.42,
            "outcomes_rank":6,
            "factors_z":-0.89,
            "factors_rank":7,
            "length_of_life_z":-0.88,
            "length_of_life_rank":6,
            "quality_of_life_z":-0.54,
            "quality_of_life_rank":8,
            "health_behaviors_z":-0.35,
            "health_behaviors_rank":4,
            "clinical_care_z":-0.14,
            "clinical_care_rank":24,
            "social_and_economic_factors_z":-0.43,
            "social_and_economic_factors_rank":10,
            "physical_environment_z":0.03,
            "physical_environment_rank":118
          },
          {
            "name":"Coffee",
            "code":"cf",
            "outcomes_z":0.12,
            "outcomes_rank":81,
            "factors_z":0.51,
            "factors_rank":148,
            "length_of_life_z":-0.08,
            "length_of_life_rank":75,
            "quality_of_life_z":0.19,
            "quality_of_life_rank":114,
            "health_behaviors_z":0.01,
            "health_behaviors_rank":78,
            "clinical_care_z":0.26,
            "clinical_care_rank":156,
            "social_and_economic_factors_z":0.30,
            "social_and_economic_factors_rank":144,
            "physical_environment_z":-0.06,
            "physical_environment_rank":21
          },
          {
            "name":"Colquitt",
            "code":"cq",
            "outcomes_z":-0.00,
            "outcomes_rank":69,
            "factors_z":0.11,
            "factors_rank":85,
            "length_of_life_z":-0.14,
            "length_of_life_rank":66,
            "quality_of_life_z":0.14,
            "quality_of_life_rank":105,
            "health_behaviors_z":0.11,
            "health_behaviors_rank":122,
            "clinical_care_z":0.05,
            "clinical_care_rank":111,
            "social_and_economic_factors_z":0.04,
            "social_and_economic_factors_rank":81,
            "physical_environment_z":-0.09,
            "physical_environment_rank":6
          },
          {
            "name":"Columbia",
            "code":"cu",
            "outcomes_z":-1.32,
            "outcomes_rank":7,
            "factors_z":-1.17,
            "factors_rank":4,
            "length_of_life_z":-0.77,
            "length_of_life_rank":9,
            "quality_of_life_z":-0.54,
            "quality_of_life_rank":7,
            "health_behaviors_z":-0.30,
            "health_behaviors_rank":9,
            "clinical_care_z":-0.24,
            "clinical_care_rank":3,
            "social_and_economic_factors_z":-0.61,
            "social_and_economic_factors_rank":4,
            "physical_environment_z":-0.02,
            "physical_environment_rank":52
          },
          {
            "name":"Cook",
            "code":"co",
            "outcomes_z":0.28,
            "outcomes_rank":105,
            "factors_z":0.24,
            "factors_rank":111,
            "length_of_life_z":0.29,
            "length_of_life_rank":112,
            "quality_of_life_z":-0.02,
            "quality_of_life_rank":77,
            "health_behaviors_z":0.09,
            "health_behaviors_rank":116,
            "clinical_care_z":0.12,
            "clinical_care_rank":139,
            "social_and_economic_factors_z":0.06,
            "social_and_economic_factors_rank":88,
            "physical_environment_z":-0.02,
            "physical_environment_rank":49
          },
          {
            "name":"Coweta",
            "code":"cw",
            "outcomes_z":-1.17,
            "outcomes_rank":8,
            "factors_z":-0.68,
            "factors_rank":11,
            "length_of_life_z":-0.78,
            "length_of_life_rank":8,
            "quality_of_life_z":-0.39,
            "quality_of_life_rank":20,
            "health_behaviors_z":-0.19,
            "health_behaviors_rank":17,
            "clinical_care_z":-0.12,
            "clinical_care_rank":26,
            "social_and_economic_factors_z":-0.39,
            "social_and_economic_factors_rank":12,
            "physical_environment_z":0.02,
            "physical_environment_rank":102
          },
          {
            "name":"Crawford",
            "code":"cd",
            "outcomes_z":-0.41,
            "outcomes_rank":43,
            "factors_z":0.22,
            "factors_rank":105,
            "length_of_life_z":-0.49,
            "length_of_life_rank":24,
            "quality_of_life_z":0.08,
            "quality_of_life_rank":96,
            "health_behaviors_z":0.03,
            "health_behaviors_rank":84,
            "clinical_care_z":0.05,
            "clinical_care_rank":109,
            "social_and_economic_factors_z":0.10,
            "social_and_economic_factors_rank":97,
            "physical_environment_z":0.04,
            "physical_environment_rank":136
          },
          {
            "name":"Crisp",
            "code":"cp",
            "outcomes_z":1.12,
            "outcomes_rank":151,
            "factors_z":0.51,
            "factors_rank":147,
            "length_of_life_z":0.44,
            "length_of_life_rank":135,
            "quality_of_life_z":0.67,
            "quality_of_life_rank":156,
            "health_behaviors_z":0.15,
            "health_behaviors_rank":134,
            "clinical_care_z":-0.03,
            "clinical_care_rank":63,
            "social_and_economic_factors_z":0.44,
            "social_and_economic_factors_rank":154,
            "physical_environment_z":-0.05,
            "physical_environment_rank":24
          },
          {
            "name":"Dade",
            "code":"da",
            "outcomes_z":0.44,
            "outcomes_rank":122,
            "factors_z":-0.46,
            "factors_rank":26,
            "length_of_life_z":0.42,
            "length_of_life_rank":132,
            "quality_of_life_z":0.02,
            "quality_of_life_rank":86,
            "health_behaviors_z":-0.16,
            "health_behaviors_rank":24,
            "clinical_care_z":-0.05,
            "clinical_care_rank":54,
            "social_and_economic_factors_z":-0.25,
            "social_and_economic_factors_rank":29,
            "physical_environment_z":-0.01,
            "physical_environment_rank":75
          },
          {
            "name":"Dawson",
            "code":"dw",
            "outcomes_z":-0.73,
            "outcomes_rank":23,
            "factors_z":-0.17,
            "factors_rank":45,
            "length_of_life_z":-0.37,
            "length_of_life_rank":32,
            "quality_of_life_z":-0.36,
            "quality_of_life_rank":24,
            "health_behaviors_z":0.08,
            "health_behaviors_rank":112,
            "clinical_care_z":-0.03,
            "clinical_care_rank":61,
            "social_and_economic_factors_z":-0.37,
            "social_and_economic_factors_rank":17,
            "physical_environment_z":0.14,
            "physical_environment_rank":159
          },
          {
            "name":"Decatur",
            "code":"de",
            "outcomes_z":0.53,
            "outcomes_rank":132,
            "factors_z":0.57,
            "factors_rank":151,
            "length_of_life_z":0.44,
            "length_of_life_rank":134,
            "quality_of_life_z":0.10,
            "quality_of_life_rank":101,
            "health_behaviors_z":0.18,
            "health_behaviors_rank":143,
            "clinical_care_z":0.07,
            "clinical_care_rank":124,
            "social_and_economic_factors_z":0.35,
            "social_and_economic_factors_rank":149,
            "physical_environment_z":-0.03,
            "physical_environment_rank":37
          },
          {
            "name":"DeKalb",
            "code":"dk",
            "outcomes_z":-0.85,
            "outcomes_rank":18,
            "factors_z":-0.47,
            "factors_rank":23,
            "length_of_life_z":-0.52,
            "length_of_life_rank":20,
            "quality_of_life_z":-0.33,
            "quality_of_life_rank":29,
            "health_behaviors_z":-0.32,
            "health_behaviors_rank":7,
            "clinical_care_z":-0.15,
            "clinical_care_rank":14,
            "social_and_economic_factors_z":-0.03,
            "social_and_economic_factors_rank":64,
            "physical_environment_z":0.03,
            "physical_environment_rank":124
          },
          {
            "name":"Dodge",
            "code":"do",
            "outcomes_z":0.46,
            "outcomes_rank":126,
            "factors_z":0.22,
            "factors_rank":104,
            "length_of_life_z":0.13,
            "length_of_life_rank":96,
            "quality_of_life_z":0.34,
            "quality_of_life_rank":139,
            "health_behaviors_z":0.05,
            "health_behaviors_rank":94,
            "clinical_care_z":0.05,
            "clinical_care_rank":107,
            "social_and_economic_factors_z":0.16,
            "social_and_economic_factors_rank":113,
            "physical_environment_z":-0.04,
            "physical_environment_rank":34
          },
          {
            "name":"Dooly",
            "code":"dl",
            "outcomes_z":-0.69,
            "outcomes_rank":27,
            "factors_z":0.47,
            "factors_rank":140,
            "length_of_life_z":-0.92,
            "length_of_life_rank":5,
            "quality_of_life_z":0.23,
            "quality_of_life_rank":120,
            "health_behaviors_z":0.08,
            "health_behaviors_rank":108,
            "clinical_care_z":0.06,
            "clinical_care_rank":117,
            "social_and_economic_factors_z":0.35,
            "social_and_economic_factors_rank":150,
            "physical_environment_z":-0.02,
            "physical_environment_rank":58
          },
          {
            "name":"Dougherty",
            "code":"du",
            "outcomes_z":0.34,
            "outcomes_rank":107,
            "factors_z":0.34,
            "factors_rank":126,
            "length_of_life_z":0.17,
            "length_of_life_rank":100,
            "quality_of_life_z":0.17,
            "quality_of_life_rank":110,
            "health_behaviors_z":0.15,
            "health_behaviors_rank":136,
            "clinical_care_z":-0.09,
            "clinical_care_rank":36,
            "social_and_economic_factors_z":0.33,
            "social_and_economic_factors_rank":148,
            "physical_environment_z":-0.05,
            "physical_environment_rank":22
          },
          {
            "name":"Douglas",
            "code":"dg",
            "outcomes_z":-0.70,
            "outcomes_rank":26,
            "factors_z":-0.39,
            "factors_rank":32,
            "length_of_life_z":-0.49,
            "length_of_life_rank":25,
            "quality_of_life_z":-0.21,
            "quality_of_life_rank":39,
            "health_behaviors_z":-0.12,
            "health_behaviors_rank":33,
            "clinical_care_z":-0.04,
            "clinical_care_rank":56,
            "social_and_economic_factors_z":-0.25,
            "social_and_economic_factors_rank":27,
            "physical_environment_z":0.03,
            "physical_environment_rank":116
          },
          {
            "name":"Early",
            "code":"ea",
            "outcomes_z":1.38,
            "outcomes_rank":154,
            "factors_z":0.41,
            "factors_rank":134,
            "length_of_life_z":0.83,
            "length_of_life_rank":154,
            "quality_of_life_z":0.54,
            "quality_of_life_rank":153,
            "health_behaviors_z":0.19,
            "health_behaviors_rank":147,
            "clinical_care_z":0.05,
            "clinical_care_rank":112,
            "social_and_economic_factors_z":0.20,
            "social_and_economic_factors_rank":124,
            "physical_environment_z":-0.04,
            "physical_environment_rank":35
          },
          {
            "name":"Echols",
            "code":"ec",
            "outcomes_z":-0.25,
            "outcomes_rank":62,
            "factors_z":-0.04,
            "factors_rank":67,
            "length_of_life_z":-0.25,
            "length_of_life_rank":52,
            "quality_of_life_z":0.00,
            "quality_of_life_rank":80,
            "health_behaviors_z":-0.03,
            "health_behaviors_rank":63,
            "clinical_care_z":0.10,
            "clinical_care_rank":133,
            "social_and_economic_factors_z":-0.03,
            "social_and_economic_factors_rank":67,
            "physical_environment_z":-0.08,
            "physical_environment_rank":8
          },
          {
            "name":"Effingham",
            "code":"ef",
            "outcomes_z":-0.60,
            "outcomes_rank":35,
            "factors_z":-0.70,
            "factors_rank":10,
            "length_of_life_z":-0.38,
            "length_of_life_rank":31,
            "quality_of_life_z":-0.22,
            "quality_of_life_rank":36,
            "health_behaviors_z":-0.15,
            "health_behaviors_rank":25,
            "clinical_care_z":-0.10,
            "clinical_care_rank":31,
            "social_and_economic_factors_z":-0.45,
            "social_and_economic_factors_rank":9,
            "physical_environment_z":0.00,
            "physical_environment_rank":83
          },
          {
            "name":"Elbert",
            "code":"el",
            "outcomes_z":0.36,
            "outcomes_rank":112,
            "factors_z":0.23,
            "factors_rank":107,
            "length_of_life_z":0.08,
            "length_of_life_rank":92,
            "quality_of_life_z":0.28,
            "quality_of_life_rank":129,
            "health_behaviors_z":0.07,
            "health_behaviors_rank":106,
            "clinical_care_z":0.01,
            "clinical_care_rank":88,
            "social_and_economic_factors_z":0.16,
            "social_and_economic_factors_rank":114,
            "physical_environment_z":-0.01,
            "physical_environment_rank":68
          },
          {
            "name":"Emanuel",
            "code":"em",
            "outcomes_z":0.37,
            "outcomes_rank":115,
            "factors_z":0.31,
            "factors_rank":120,
            "length_of_life_z":0.47,
            "length_of_life_rank":137,
            "quality_of_life_z":-0.09,
            "quality_of_life_rank":61,
            "health_behaviors_z":0.03,
            "health_behaviors_rank":86,
            "clinical_care_z":0.12,
            "clinical_care_rank":138,
            "social_and_economic_factors_z":0.20,
            "social_and_economic_factors_rank":123,
            "physical_environment_z":-0.04,
            "physical_environment_rank":33
          },
          {
            "name":"Evans",
            "code":"ev",
            "outcomes_z":0.20,
            "outcomes_rank":95,
            "factors_z":0.61,
            "factors_rank":153,
            "length_of_life_z":-0.08,
            "length_of_life_rank":72,
            "quality_of_life_z":0.28,
            "quality_of_life_rank":130,
            "health_behaviors_z":0.34,
            "health_behaviors_rank":158,
            "clinical_care_z":0.13,
            "clinical_care_rank":142,
            "social_and_economic_factors_z":0.15,
            "social_and_economic_factors_rank":106,
            "physical_environment_z":-0.00,
            "physical_environment_rank":80
          },
          {
            "name":"Fannin",
            "code":"fa",
            "outcomes_z":0.35,
            "outcomes_rank":110,
            "factors_z":0.10,
            "factors_rank":83,
            "length_of_life_z":0.17,
            "length_of_life_rank":101,
            "quality_of_life_z":0.18,
            "quality_of_life_rank":112,
            "health_behaviors_z":-0.03,
            "health_behaviors_rank":62,
            "clinical_care_z":0.09,
            "clinical_care_rank":128,
            "social_and_economic_factors_z":0.03,
            "social_and_economic_factors_rank":78,
            "physical_environment_z":0.02,
            "physical_environment_rank":100
          },
          {
            "name":"Fayette",
            "code":"fy",
            "outcomes_z":-1.68,
            "outcomes_rank":2,
            "factors_z":-1.33,
            "factors_rank":3,
            "length_of_life_z":-1.01,
            "length_of_life_rank":3,
            "quality_of_life_z":-0.67,
            "quality_of_life_rank":3,
            "health_behaviors_z":-0.42,
            "health_behaviors_rank":3,
            "clinical_care_z":-0.37,
            "clinical_care_rank":1,
            "social_and_economic_factors_z":-0.64,
            "social_and_economic_factors_rank":3,
            "physical_environment_z":0.10,
            "physical_environment_rank":154
          },
          {
            "name":"Floyd",
            "code":"fl",
            "outcomes_z":0.25,
            "outcomes_rank":100,
            "factors_z":-0.30,
            "factors_rank":39,
            "length_of_life_z":0.05,
            "length_of_life_rank":89,
            "quality_of_life_z":0.20,
            "quality_of_life_rank":115,
            "health_behaviors_z":-0.13,
            "health_behaviors_rank":30,
            "clinical_care_z":-0.15,
            "clinical_care_rank":16,
            "social_and_economic_factors_z":-0.02,
            "social_and_economic_factors_rank":69,
            "physical_environment_z":-0.00,
            "physical_environment_rank":79
          },
          {
            "name":"Forsyth",
            "code":"fo",
            "outcomes_z":-2.04,
            "outcomes_rank":1,
            "factors_z":-1.39,
            "factors_rank":2,
            "length_of_life_z":-1.27,
            "length_of_life_rank":1,
            "quality_of_life_z":-0.76,
            "quality_of_life_rank":1,
            "health_behaviors_z":-0.45,
            "health_behaviors_rank":1,
            "clinical_care_z":-0.16,
            "clinical_care_rank":12,
            "social_and_economic_factors_z":-0.79,
            "social_and_economic_factors_rank":2,
            "physical_environment_z":0.01,
            "physical_environment_rank":93
          },
          {
            "name":"Franklin",
            "code":"fr",
            "outcomes_z":0.26,
            "outcomes_rank":101,
            "factors_z":-0.08,
            "factors_rank":60,
            "length_of_life_z":0.38,
            "length_of_life_rank":127,
            "quality_of_life_z":-0.12,
            "quality_of_life_rank":54,
            "health_behaviors_z":-0.13,
            "health_behaviors_rank":28,
            "clinical_care_z":0.01,
            "clinical_care_rank":90,
            "social_and_economic_factors_z":0.03,
            "social_and_economic_factors_rank":79,
            "physical_environment_z":0.01,
            "physical_environment_rank":86
          },
          {
            "name":"Fulton",
            "code":"fu",
            "outcomes_z":-0.65,
            "outcomes_rank":29,
            "factors_z":-0.50,
            "factors_rank":21,
            "length_of_life_z":-0.31,
            "length_of_life_rank":42,
            "quality_of_life_z":-0.34,
            "quality_of_life_rank":26,
            "health_behaviors_z":-0.31,
            "health_behaviors_rank":8,
            "clinical_care_z":-0.16,
            "clinical_care_rank":11,
            "social_and_economic_factors_z":-0.12,
            "social_and_economic_factors_rank":44,
            "physical_environment_z":0.10,
            "physical_environment_rank":153
          },
          {
            "name":"Gilmer",
            "code":"gi",
            "outcomes_z":-0.66,
            "outcomes_rank":28,
            "factors_z":-0.02,
            "factors_rank":69,
            "length_of_life_z":-0.44,
            "length_of_life_rank":26,
            "quality_of_life_z":-0.21,
            "quality_of_life_rank":38,
            "health_behaviors_z":-0.06,
            "health_behaviors_rank":47,
            "clinical_care_z":0.07,
            "clinical_care_rank":123,
            "social_and_economic_factors_z":-0.05,
            "social_and_economic_factors_rank":60,
            "physical_environment_z":0.02,
            "physical_environment_rank":107
          },
          {
            "name":"Glascock",
            "code":"gl",
            "outcomes_z":0.46,
            "outcomes_rank":125,
            "factors_z":-0.06,
            "factors_rank":65,
            "length_of_life_z":0.38,
            "length_of_life_rank":128,
            "quality_of_life_z":0.08,
            "quality_of_life_rank":95,
            "health_behaviors_z":0.03,
            "health_behaviors_rank":88,
            "clinical_care_z":-0.01,
            "clinical_care_rank":78,
            "social_and_economic_factors_z":-0.11,
            "social_and_economic_factors_rank":47,
            "physical_environment_z":0.02,
            "physical_environment_rank":108
          },
          {
            "name":"Glynn",
            "code":"gy",
            "outcomes_z":-0.27,
            "outcomes_rank":59,
            "factors_z":-0.22,
            "factors_rank":41,
            "length_of_life_z":0.02,
            "length_of_life_rank":82,
            "quality_of_life_z":-0.29,
            "quality_of_life_rank":31,
            "health_behaviors_z":-0.06,
            "health_behaviors_rank":50,
            "clinical_care_z":-0.10,
            "clinical_care_rank":32,
            "social_and_economic_factors_z":-0.05,
            "social_and_economic_factors_rank":61,
            "physical_environment_z":-0.02,
            "physical_environment_rank":53
          },
          {
            "name":"Gordon",
            "code":"go",
            "outcomes_z":-0.30,
            "outcomes_rank":57,
            "factors_z":-0.08,
            "factors_rank":63,
            "length_of_life_z":-0.12,
            "length_of_life_rank":67,
            "quality_of_life_z":-0.18,
            "quality_of_life_rank":45,
            "health_behaviors_z":-0.02,
            "health_behaviors_rank":66,
            "clinical_care_z":0.07,
            "clinical_care_rank":121,
            "social_and_economic_factors_z":-0.14,
            "social_and_economic_factors_rank":42,
            "physical_environment_z":0.02,
            "physical_environment_rank":109
          },
          {
            "name":"Grady",
            "code":"gr",
            "outcomes_z":0.17,
            "outcomes_rank":89,
            "factors_z":0.15,
            "factors_rank":95,
            "length_of_life_z":0.05,
            "length_of_life_rank":88,
            "quality_of_life_z":0.12,
            "quality_of_life_rank":103,
            "health_behaviors_z":0.17,
            "health_behaviors_rank":141,
            "clinical_care_z":0.06,
            "clinical_care_rank":116,
            "social_and_economic_factors_z":-0.03,
            "social_and_economic_factors_rank":68,
            "physical_environment_z":-0.05,
            "physical_environment_rank":25
          },
          {
            "name":"Greene",
            "code":"ge",
            "outcomes_z":0.11,
            "outcomes_rank":79,
            "factors_z":0.02,
            "factors_rank":77,
            "length_of_life_z":-0.06,
            "length_of_life_rank":78,
            "quality_of_life_z":0.16,
            "quality_of_life_rank":108,
            "health_behaviors_z":-0.17,
            "health_behaviors_rank":19,
            "clinical_care_z":-0.08,
            "clinical_care_rank":37,
            "social_and_economic_factors_z":0.24,
            "social_and_economic_factors_rank":130,
            "physical_environment_z":0.03,
            "physical_environment_rank":119
          },
          {
            "name":"Gwinnett",
            "code":"gw",
            "outcomes_z":-1.56,
            "outcomes_rank":4,
            "factors_z":-0.74,
            "factors_rank":9,
            "length_of_life_z":-0.97,
            "length_of_life_rank":4,
            "quality_of_life_z":-0.58,
            "quality_of_life_rank":5,
            "health_behaviors_z":-0.33,
            "health_behaviors_rank":6,
            "clinical_care_z":-0.08,
            "clinical_care_rank":38,
            "social_and_economic_factors_z":-0.38,
            "social_and_economic_factors_rank":14,
            "physical_environment_z":0.05,
            "physical_environment_rank":142
          },
          {
            "name":"Habersham",
            "code":"ha",
            "outcomes_z":-0.86,
            "outcomes_rank":15,
            "factors_z":-0.30,
            "factors_rank":37,
            "length_of_life_z":-0.53,
            "length_of_life_rank":19,
            "quality_of_life_z":-0.33,
            "quality_of_life_rank":28,
            "health_behaviors_z":-0.06,
            "health_behaviors_rank":48,
            "clinical_care_z":-0.05,
            "clinical_care_rank":47,
            "social_and_economic_factors_z":-0.22,
            "social_and_economic_factors_rank":34,
            "physical_environment_z":0.03,
            "physical_environment_rank":120
          },
          {
            "name":"Hall",
            "code":"hl",
            "outcomes_z":-0.98,
            "outcomes_rank":12,
            "factors_z":-0.44,
            "factors_rank":27,
            "length_of_life_z":-0.60,
            "length_of_life_rank":17,
            "quality_of_life_z":-0.38,
            "quality_of_life_rank":22,
            "health_behaviors_z":-0.17,
            "health_behaviors_rank":21,
            "clinical_care_z":-0.06,
            "clinical_care_rank":45,
            "social_and_economic_factors_z":-0.24,
            "social_and_economic_factors_rank":31,
            "physical_environment_z":0.03,
            "physical_environment_rank":126
          },
          {
            "name":"Hancock",
            "code":"hn",
            "outcomes_z":0.21,
            "outcomes_rank":96,
            "factors_z":0.82,
            "factors_rank":157,
            "length_of_life_z":-0.23,
            "length_of_life_rank":54,
            "quality_of_life_z":0.44,
            "quality_of_life_rank":147,
            "health_behaviors_z":0.20,
            "health_behaviors_rank":150,
            "clinical_care_z":0.03,
            "clinical_care_rank":101,
            "social_and_economic_factors_z":0.47,
            "social_and_economic_factors_rank":157,
            "physical_environment_z":0.11,
            "physical_environment_rank":157
          },
          {
            "name":"Haralson",
            "code":"hr",
            "outcomes_z":0.44,
            "outcomes_rank":123,
            "factors_z":0.17,
            "factors_rank":97,
            "length_of_life_z":0.55,
            "length_of_life_rank":145,
            "quality_of_life_z":-0.11,
            "quality_of_life_rank":57,
            "health_behaviors_z":0.13,
            "health_behaviors_rank":127,
            "clinical_care_z":-0.08,
            "clinical_care_rank":41,
            "social_and_economic_factors_z":0.10,
            "social_and_economic_factors_rank":98,
            "physical_environment_z":0.01,
            "physical_environment_rank":89
          },
          {
            "name":"Harris",
            "code":"hi",
            "outcomes_z":-0.61,
            "outcomes_rank":33,
            "factors_z":-0.98,
            "factors_rank":5,
            "length_of_life_z":-0.17,
            "length_of_life_rank":63,
            "quality_of_life_z":-0.44,
            "quality_of_life_rank":14,
            "health_behaviors_z":-0.21,
            "health_behaviors_rank":16,
            "clinical_care_z":-0.18,
            "clinical_care_rank":7,
            "social_and_economic_factors_z":-0.58,
            "social_and_economic_factors_rank":6,
            "physical_environment_z":-0.00,
            "physical_environment_rank":77
          },
          {
            "name":"Hart",
            "code":"ht",
            "outcomes_z":-0.25,
            "outcomes_rank":61,
            "factors_z":-0.09,
            "factors_rank":59,
            "length_of_life_z":-0.20,
            "length_of_life_rank":57,
            "quality_of_life_z":-0.05,
            "quality_of_life_rank":72,
            "health_behaviors_z":-0.12,
            "health_behaviors_rank":32,
            "clinical_care_z":-0.01,
            "clinical_care_rank":77,
            "social_and_economic_factors_z":0.00,
            "social_and_economic_factors_rank":71,
            "physical_environment_z":0.04,
            "physical_environment_rank":129
          },
          {
            "name":"Heard",
            "code":"he",
            "outcomes_z":0.12,
            "outcomes_rank":84,
            "factors_z":0.13,
            "factors_rank":91,
            "length_of_life_z":0.29,
            "length_of_life_rank":113,
            "quality_of_life_z":-0.17,
            "quality_of_life_rank":50,
            "health_behaviors_z":-0.08,
            "health_behaviors_rank":43,
            "clinical_care_z":0.12,
            "clinical_care_rank":140,
            "social_and_economic_factors_z":-0.00,
            "social_and_economic_factors_rank":70,
            "physical_environment_z":0.10,
            "physical_environment_rank":152
          },
          {
            "name":"Henry",
            "code":"hy",
            "outcomes_z":-0.89,
            "outcomes_rank":13,
            "factors_z":-0.57,
            "factors_rank":17,
            "length_of_life_z":-0.50,
            "length_of_life_rank":22,
            "quality_of_life_z":-0.39,
            "quality_of_life_rank":21,
            "health_behaviors_z":-0.14,
            "health_behaviors_rank":27,
            "clinical_care_z":-0.14,
            "clinical_care_rank":23,
            "social_and_economic_factors_z":-0.33,
            "social_and_economic_factors_rank":20,
            "physical_environment_z":0.04,
            "physical_environment_rank":128
          },
          {
            "name":"Houston",
            "code":"ho",
            "outcomes_z":-0.77,
            "outcomes_rank":22,
            "factors_z":-0.46,
            "factors_rank":25,
            "length_of_life_z":-0.35,
            "length_of_life_rank":36,
            "quality_of_life_z":-0.42,
            "quality_of_life_rank":17,
            "health_behaviors_z":-0.09,
            "health_behaviors_rank":40,
            "clinical_care_z":-0.05,
            "clinical_care_rank":50,
            "social_and_economic_factors_z":-0.33,
            "social_and_economic_factors_rank":19,
            "physical_environment_z":0.01,
            "physical_environment_rank":92
          },
          {
            "name":"Irwin",
            "code":"ir",
            "outcomes_z":0.56,
            "outcomes_rank":134,
            "factors_z":0.12,
            "factors_rank":86,
            "length_of_life_z":0.30,
            "length_of_life_rank":114,
            "quality_of_life_z":0.26,
            "quality_of_life_rank":127,
            "health_behaviors_z":0.02,
            "health_behaviors_rank":82,
            "clinical_care_z":0.03,
            "clinical_care_rank":98,
            "social_and_economic_factors_z":0.15,
            "social_and_economic_factors_rank":109,
            "physical_environment_z":-0.09,
            "physical_environment_rank":4
          },
          {
            "name":"Jackson",
            "code":"ja",
            "outcomes_z":-0.42,
            "outcomes_rank":42,
            "factors_z":-0.49,
            "factors_rank":22,
            "length_of_life_z":-0.26,
            "length_of_life_rank":51,
            "quality_of_life_z":-0.16,
            "quality_of_life_rank":51,
            "health_behaviors_z":-0.12,
            "health_behaviors_rank":31,
            "clinical_care_z":-0.05,
            "clinical_care_rank":52,
            "social_and_economic_factors_z":-0.33,
            "social_and_economic_factors_rank":21,
            "physical_environment_z":0.02,
            "physical_environment_rank":95
          },
          {
            "name":"Jasper",
            "code":"js",
            "outcomes_z":-0.18,
            "outcomes_rank":64,
            "factors_z":-0.12,
            "factors_rank":50,
            "length_of_life_z":-0.10,
            "length_of_life_rank":71,
            "quality_of_life_z":-0.07,
            "quality_of_life_rank":68,
            "health_behaviors_z":-0.05,
            "health_behaviors_rank":54,
            "clinical_care_z":-0.01,
            "clinical_care_rank":72,
            "social_and_economic_factors_z":-0.09,
            "social_and_economic_factors_rank":56,
            "physical_environment_z":0.03,
            "physical_environment_rank":125
          },
          {
            "name":"Jeff Davis",
            "code":"jd",
            "outcomes_z":0.73,
            "outcomes_rank":143,
            "factors_z":0.48,
            "factors_rank":143,
            "length_of_life_z":0.52,
            "length_of_life_rank":143,
            "quality_of_life_z":0.21,
            "quality_of_life_rank":118,
            "health_behaviors_z":-0.02,
            "health_behaviors_rank":64,
            "clinical_care_z":0.32,
            "clinical_care_rank":157,
            "social_and_economic_factors_z":0.25,
            "social_and_economic_factors_rank":133,
            "physical_environment_z":-0.06,
            "physical_environment_rank":20
          },
          {
            "name":"Jefferson",
            "code":"je",
            "outcomes_z":0.49,
            "outcomes_rank":128,
            "factors_z":0.40,
            "factors_rank":133,
            "length_of_life_z":0.24,
            "length_of_life_rank":108,
            "quality_of_life_z":0.24,
            "quality_of_life_rank":123,
            "health_behaviors_z":0.10,
            "health_behaviors_rank":118,
            "clinical_care_z":-0.00,
            "clinical_care_rank":80,
            "social_and_economic_factors_z":0.32,
            "social_and_economic_factors_rank":146,
            "physical_environment_z":-0.01,
            "physical_environment_rank":63
          },
          {
            "name":"Jenkins",
            "code":"jk",
            "outcomes_z":0.73,
            "outcomes_rank":142,
            "factors_z":0.69,
            "factors_rank":155,
            "length_of_life_z":0.64,
            "length_of_life_rank":149,
            "quality_of_life_z":0.09,
            "quality_of_life_rank":100,
            "health_behaviors_z":0.05,
            "health_behaviors_rank":97,
            "clinical_care_z":0.10,
            "clinical_care_rank":134,
            "social_and_economic_factors_z":0.55,
            "social_and_economic_factors_rank":159,
            "physical_environment_z":-0.02,
            "physical_environment_rank":61
          },
          {
            "name":"Johnson",
            "code":"jo",
            "outcomes_z":0.39,
            "outcomes_rank":117,
            "factors_z":0.16,
            "factors_rank":96,
            "length_of_life_z":-0.01,
            "length_of_life_rank":81,
            "quality_of_life_z":0.41,
            "quality_of_life_rank":143,
            "health_behaviors_z":-0.04,
            "health_behaviors_rank":59,
            "clinical_care_z":-0.01,
            "clinical_care_rank":79,
            "social_and_economic_factors_z":0.18,
            "social_and_economic_factors_rank":122,
            "physical_environment_z":0.03,
            "physical_environment_rank":115
          },
          {
            "name":"Jones",
            "code":"jn",
            "outcomes_z":-0.37,
            "outcomes_rank":49,
            "factors_z":-0.39,
            "factors_rank":31,
            "length_of_life_z":-0.57,
            "length_of_life_rank":18,
            "quality_of_life_z":0.20,
            "quality_of_life_rank":116,
            "health_behaviors_z":-0.01,
            "health_behaviors_rank":71,
            "clinical_care_z":-0.10,
            "clinical_care_rank":30,
            "social_and_economic_factors_z":-0.31,
            "social_and_economic_factors_rank":22,
            "physical_environment_z":0.02,
            "physical_environment_rank":110
          },
          {
            "name":"Lamar",
            "code":"la",
            "outcomes_z":0.45,
            "outcomes_rank":124,
            "factors_z":0.01,
            "factors_rank":76,
            "length_of_life_z":0.35,
            "length_of_life_rank":125,
            "quality_of_life_z":0.10,
            "quality_of_life_rank":102,
            "health_behaviors_z":0.02,
            "health_behaviors_rank":80,
            "clinical_care_z":-0.03,
            "clinical_care_rank":62,
            "social_and_economic_factors_z":0.01,
            "social_and_economic_factors_rank":72,
            "physical_environment_z":0.02,
            "physical_environment_rank":96
          },
          {
            "name":"Lanier",
            "code":"ln",
            "outcomes_z":0.27,
            "outcomes_rank":102,
            "factors_z":0.15,
            "factors_rank":94,
            "length_of_life_z":0.19,
            "length_of_life_rank":103,
            "quality_of_life_z":0.09,
            "quality_of_life_rank":99,
            "health_behaviors_z":-0.04,
            "health_behaviors_rank":61,
            "clinical_care_z":0.35,
            "clinical_care_rank":158,
            "social_and_economic_factors_z":-0.10,
            "social_and_economic_factors_rank":50,
            "physical_environment_z":-0.05,
            "physical_environment_rank":23
          },
          {
            "name":"Laurens",
            "code":"lu",
            "outcomes_z":0.11,
            "outcomes_rank":80,
            "factors_z":0.11,
            "factors_rank":84,
            "length_of_life_z":0.08,
            "length_of_life_rank":91,
            "quality_of_life_z":0.04,
            "quality_of_life_rank":89,
            "health_behaviors_z":0.08,
            "health_behaviors_rank":110,
            "clinical_care_z":-0.20,
            "clinical_care_rank":4,
            "social_and_economic_factors_z":0.25,
            "social_and_economic_factors_rank":134,
            "physical_environment_z":-0.02,
            "physical_environment_rank":56
          },
          {
            "name":"Lee",
            "code":"le",
            "outcomes_z":-0.78,
            "outcomes_rank":21,
            "factors_z":-0.58,
            "factors_rank":16,
            "length_of_life_z":-0.43,
            "length_of_life_rank":29,
            "quality_of_life_z":-0.35,
            "quality_of_life_rank":25,
            "health_behaviors_z":-0.08,
            "health_behaviors_rank":44,
            "clinical_care_z":-0.05,
            "clinical_care_rank":53,
            "social_and_economic_factors_z":-0.38,
            "social_and_economic_factors_rank":15,
            "physical_environment_z":-0.07,
            "physical_environment_rank":11
          },
          {
            "name":"Liberty",
            "code":"li",
            "outcomes_z":-0.40,
            "outcomes_rank":45,
            "factors_z":0.01,
            "factors_rank":75,
            "length_of_life_z":-0.33,
            "length_of_life_rank":38,
            "quality_of_life_z":-0.07,
            "quality_of_life_rank":70,
            "health_behaviors_z":0.19,
            "health_behaviors_rank":148,
            "clinical_care_z":-0.06,
            "clinical_care_rank":44,
            "social_and_economic_factors_z":-0.10,
            "social_and_economic_factors_rank":49,
            "physical_environment_z":-0.02,
            "physical_environment_rank":54
          },
          {
            "name":"Lincoln",
            "code":"lc",
            "outcomes_z":-0.36,
            "outcomes_rank":50,
            "factors_z":0.55,
            "factors_rank":150,
            "length_of_life_z":0.11,
            "length_of_life_rank":93,
            "quality_of_life_z":-0.47,
            "quality_of_life_rank":11,
            "health_behaviors_z":0.37,
            "health_behaviors_rank":159,
            "clinical_care_z":0.11,
            "clinical_care_rank":137,
            "social_and_economic_factors_z":0.04,
            "social_and_economic_factors_rank":83,
            "physical_environment_z":0.03,
            "physical_environment_rank":121
          },
          {
            "name":"Long",
            "code":"lo",
            "outcomes_z":-0.61,
            "outcomes_rank":34,
            "factors_z":-0.00,
            "factors_rank":71,
            "length_of_life_z":-0.37,
            "length_of_life_rank":34,
            "quality_of_life_z":-0.24,
            "quality_of_life_rank":33,
            "health_behaviors_z":-0.00,
            "health_behaviors_rank":72,
            "clinical_care_z":0.17,
            "clinical_care_rank":149,
            "social_and_economic_factors_z":-0.17,
            "social_and_economic_factors_rank":39,
            "physical_environment_z":-0.01,
            "physical_environment_rank":70
          },
          {
            "name":"Lowndes",
            "code":"lw",
            "outcomes_z":0.08,
            "outcomes_rank":77,
            "factors_z":-0.00,
            "factors_rank":72,
            "length_of_life_z":0.04,
            "length_of_life_rank":86,
            "quality_of_life_z":0.04,
            "quality_of_life_rank":90,
            "health_behaviors_z":0.13,
            "health_behaviors_rank":128,
            "clinical_care_z":-0.04,
            "clinical_care_rank":57,
            "social_and_economic_factors_z":-0.12,
            "social_and_economic_factors_rank":46,
            "physical_environment_z":0.02,
            "physical_environment_rank":99
          },
          {
            "name":"Lumpkin",
            "code":"lp",
            "outcomes_z":-1.09,
            "outcomes_rank":9,
            "factors_z":-0.35,
            "factors_rank":34,
            "length_of_life_z":-0.34,
            "length_of_life_rank":37,
            "quality_of_life_z":-0.75,
            "quality_of_life_rank":2,
            "health_behaviors_z":-0.16,
            "health_behaviors_rank":23,
            "clinical_care_z":-0.00,
            "clinical_care_rank":83,
            "social_and_economic_factors_z":-0.24,
            "social_and_economic_factors_rank":32,
            "physical_environment_z":0.05,
            "physical_environment_rank":138
          },
          {
            "name":"McDuffie",
            "code":"mc",
            "outcomes_z":1.33,
            "outcomes_rank":152,
            "factors_z":0.15,
            "factors_rank":93,
            "length_of_life_z":1.01,
            "length_of_life_rank":155,
            "quality_of_life_z":0.33,
            "quality_of_life_rank":136,
            "health_behaviors_z":0.14,
            "health_behaviors_rank":129,
            "clinical_care_z":-0.06,
            "clinical_care_rank":46,
            "social_and_economic_factors_z":0.08,
            "social_and_economic_factors_rank":94,
            "physical_environment_z":-0.01,
            "physical_environment_rank":72
          },
          {
            "name":"McIntosh",
            "code":"mi",
            "outcomes_z":-0.32,
            "outcomes_rank":56,
            "factors_z":0.12,
            "factors_rank":89,
            "length_of_life_z":-0.31,
            "length_of_life_rank":41,
            "quality_of_life_z":-0.01,
            "quality_of_life_rank":78,
            "health_behaviors_z":0.11,
            "health_behaviors_rank":125,
            "clinical_care_z":-0.02,
            "clinical_care_rank":69,
            "social_and_economic_factors_z":0.04,
            "social_and_economic_factors_rank":84,
            "physical_environment_z":-0.01,
            "physical_environment_rank":64
          },
          {
            "name":"Macon",
            "code":"ma",
            "outcomes_z":0.40,
            "outcomes_rank":120,
            "factors_z":0.84,
            "factors_rank":158,
            "length_of_life_z":0.15,
            "length_of_life_rank":97,
            "quality_of_life_z":0.25,
            "quality_of_life_rank":125,
            "health_behaviors_z":0.31,
            "health_behaviors_rank":157,
            "clinical_care_z":0.09,
            "clinical_care_rank":131,
            "social_and_economic_factors_z":0.45,
            "social_and_economic_factors_rank":155,
            "physical_environment_z":-0.02,
            "physical_environment_rank":55
          },
          {
            "name":"Madison",
            "code":"md",
            "outcomes_z":0.36,
            "outcomes_rank":113,
            "factors_z":-0.12,
            "factors_rank":52,
            "length_of_life_z":0.28,
            "length_of_life_rank":109,
            "quality_of_life_z":0.08,
            "quality_of_life_rank":97,
            "health_behaviors_z":0.00,
            "health_behaviors_rank":73,
            "clinical_care_z":0.03,
            "clinical_care_rank":99,
            "social_and_economic_factors_z":-0.16,
            "social_and_economic_factors_rank":41,
            "physical_environment_z":0.01,
            "physical_environment_rank":87
          },
          {
            "name":"Marion",
            "code":"mr",
            "outcomes_z":0.35,
            "outcomes_rank":108,
            "factors_z":0.13,
            "factors_rank":90,
            "length_of_life_z":-0.08,
            "length_of_life_rank":73,
            "quality_of_life_z":0.42,
            "quality_of_life_rank":146,
            "health_behaviors_z":0.10,
            "health_behaviors_rank":117,
            "clinical_care_z":0.03,
            "clinical_care_rank":104,
            "social_and_economic_factors_z":0.01,
            "social_and_economic_factors_rank":74,
            "physical_environment_z":-0.02,
            "physical_environment_rank":60
          },
          {
            "name":"Meriwether",
            "code":"me",
            "outcomes_z":0.08,
            "outcomes_rank":78,
            "factors_z":0.21,
            "factors_rank":102,
            "length_of_life_z":0.16,
            "length_of_life_rank":99,
            "quality_of_life_z":-0.08,
            "quality_of_life_rank":65,
            "health_behaviors_z":-0.04,
            "health_behaviors_rank":58,
            "clinical_care_z":0.02,
            "clinical_care_rank":95,
            "social_and_economic_factors_z":0.15,
            "social_and_economic_factors_rank":107,
            "physical_environment_z":0.08,
            "physical_environment_rank":151
          },
          {
            "name":"Miller",
            "code":"ml",
            "outcomes_z":0.17,
            "outcomes_rank":91,
            "factors_z":-0.11,
            "factors_rank":55,
            "length_of_life_z":0.61,
            "length_of_life_rank":147,
            "quality_of_life_z":-0.44,
            "quality_of_life_rank":15,
            "health_behaviors_z":0.09,
            "health_behaviors_rank":115,
            "clinical_care_z":0.08,
            "clinical_care_rank":125,
            "social_and_economic_factors_z":-0.21,
            "social_and_economic_factors_rank":35,
            "physical_environment_z":-0.07,
            "physical_environment_rank":13
          },
          {
            "name":"Mitchell",
            "code":"mt",
            "outcomes_z":0.32,
            "outcomes_rank":106,
            "factors_z":0.07,
            "factors_rank":80,
            "length_of_life_z":0.32,
            "length_of_life_rank":118,
            "quality_of_life_z":0.01,
            "quality_of_life_rank":81,
            "health_behaviors_z":0.03,
            "health_behaviors_rank":85,
            "clinical_care_z":-0.04,
            "clinical_care_rank":59,
            "social_and_economic_factors_z":0.16,
            "social_and_economic_factors_rank":111,
            "physical_environment_z":-0.09,
            "physical_environment_rank":5
          },
          {
            "name":"Monroe",
            "code":"mo",
            "outcomes_z":-0.59,
            "outcomes_rank":36,
            "factors_z":-0.40,
            "factors_rank":30,
            "length_of_life_z":-0.44,
            "length_of_life_rank":27,
            "quality_of_life_z":-0.15,
            "quality_of_life_rank":52,
            "health_behaviors_z":0.06,
            "health_behaviors_rank":103,
            "clinical_care_z":-0.14,
            "clinical_care_rank":22,
            "social_and_economic_factors_z":-0.33,
            "social_and_economic_factors_rank":18,
            "physical_environment_z":0.02,
            "physical_environment_rank":97
          },
          {
            "name":"Montgomery",
            "code":"mg",
            "outcomes_z":-0.08,
            "outcomes_rank":65,
            "factors_z":0.19,
            "factors_rank":99,
            "length_of_life_z":-0.06,
            "length_of_life_rank":77,
            "quality_of_life_z":-0.02,
            "quality_of_life_rank":75,
            "health_behaviors_z":0.05,
            "health_behaviors_rank":93,
            "clinical_care_z":0.00,
            "clinical_care_rank":86,
            "social_and_economic_factors_z":0.17,
            "social_and_economic_factors_rank":117,
            "physical_environment_z":-0.03,
            "physical_environment_rank":44
          },
          {
            "name":"Morgan",
            "code":"mn",
            "outcomes_z":-0.70,
            "outcomes_rank":24,
            "factors_z":-0.63,
            "factors_rank":13,
            "length_of_life_z":-0.44,
            "length_of_life_rank":28,
            "quality_of_life_z":-0.26,
            "quality_of_life_rank":32,
            "health_behaviors_z":-0.17,
            "health_behaviors_rank":20,
            "clinical_care_z":-0.12,
            "clinical_care_rank":27,
            "social_and_economic_factors_z":-0.38,
            "social_and_economic_factors_rank":13,
            "physical_environment_z":0.04,
            "physical_environment_rank":132
          },
          {
            "name":"Murray",
            "code":"mu",
            "outcomes_z":0.14,
            "outcomes_rank":85,
            "factors_z":0.33,
            "factors_rank":122,
            "length_of_life_z":-0.06,
            "length_of_life_rank":76,
            "quality_of_life_z":0.20,
            "quality_of_life_rank":117,
            "health_behaviors_z":0.02,
            "health_behaviors_rank":79,
            "clinical_care_z":0.09,
            "clinical_care_rank":127,
            "social_and_economic_factors_z":0.16,
            "social_and_economic_factors_rank":115,
            "physical_environment_z":0.06,
            "physical_environment_rank":145
          },
          {
            "name":"Muscogee",
            "code":"ms",
            "outcomes_z":0.36,
            "outcomes_rank":114,
            "factors_z":-0.10,
            "factors_rank":58,
            "length_of_life_z":0.34,
            "length_of_life_rank":123,
            "quality_of_life_z":0.02,
            "quality_of_life_rank":85,
            "health_behaviors_z":0.20,
            "health_behaviors_rank":149,
            "clinical_care_z":-0.19,
            "clinical_care_rank":6,
            "social_and_economic_factors_z":-0.08,
            "social_and_economic_factors_rank":57,
            "physical_environment_z":-0.03,
            "physical_environment_rank":40
          },
          {
            "name":"Newton",
            "code":"ne",
            "outcomes_z":-0.62,
            "outcomes_rank":32,
            "factors_z":-0.13,
            "factors_rank":49,
            "length_of_life_z":-0.33,
            "length_of_life_rank":40,
            "quality_of_life_z":-0.29,
            "quality_of_life_rank":30,
            "health_behaviors_z":-0.02,
            "health_behaviors_rank":67,
            "clinical_care_z":-0.04,
            "clinical_care_rank":55,
            "social_and_economic_factors_z":-0.12,
            "social_and_economic_factors_rank":45,
            "physical_environment_z":0.05,
            "physical_environment_rank":139
          },
          {
            "name":"Oconee",
            "code":"oc",
            "outcomes_z":-1.63,
            "outcomes_rank":3,
            "factors_z":-1.54,
            "factors_rank":1,
            "length_of_life_z":-1.12,
            "length_of_life_rank":2,
            "quality_of_life_z":-0.51,
            "quality_of_life_rank":10,
            "health_behaviors_z":-0.42,
            "health_behaviors_rank":2,
            "clinical_care_z":-0.27,
            "clinical_care_rank":2,
            "social_and_economic_factors_z":-0.83,
            "social_and_economic_factors_rank":1,
            "physical_environment_z":-0.02,
            "physical_environment_rank":51
          },
          {
            "name":"Oglethorpe",
            "code":"og",
            "outcomes_z":-0.80,
            "outcomes_rank":20,
            "factors_z":-0.38,
            "factors_rank":33,
            "length_of_life_z":-0.61,
            "length_of_life_rank":15,
            "quality_of_life_z":-0.19,
            "quality_of_life_rank":41,
            "health_behaviors_z":-0.05,
            "health_behaviors_rank":57,
            "clinical_care_z":0.00,
            "clinical_care_rank":84,
            "social_and_economic_factors_z":-0.30,
            "social_and_economic_factors_rank":23,
            "physical_environment_z":-0.03,
            "physical_environment_rank":45
          },
          {
            "name":"Paulding",
            "code":"pd",
            "outcomes_z":-0.85,
            "outcomes_rank":17,
            "factors_z":-0.61,
            "factors_rank":14,
            "length_of_life_z":-0.67,
            "length_of_life_rank":10,
            "quality_of_life_z":-0.18,
            "quality_of_life_rank":49,
            "health_behaviors_z":-0.26,
            "health_behaviors_rank":12,
            "clinical_care_z":0.02,
            "clinical_care_rank":93,
            "social_and_economic_factors_z":-0.40,
            "social_and_economic_factors_rank":11,
            "physical_environment_z":0.04,
            "physical_environment_rank":131
          },
          {
            "name":"Peach",
            "code":"pa",
            "outcomes_z":0.23,
            "outcomes_rank":98,
            "factors_z":0.27,
            "factors_rank":114,
            "length_of_life_z":0.22,
            "length_of_life_rank":106,
            "quality_of_life_z":0.01,
            "quality_of_life_rank":83,
            "health_behaviors_z":0.07,
            "health_behaviors_rank":105,
            "clinical_care_z":0.05,
            "clinical_care_rank":114,
            "social_and_economic_factors_z":0.16,
            "social_and_economic_factors_rank":112,
            "physical_environment_z":-0.01,
            "physical_environment_rank":73
          },
          {
            "name":"Pickens",
            "code":"pc",
            "outcomes_z":-0.63,
            "outcomes_rank":31,
            "factors_z":-0.44,
            "factors_rank":28,
            "length_of_life_z":-0.20,
            "length_of_life_rank":58,
            "quality_of_life_z":-0.43,
            "quality_of_life_rank":16,
            "health_behaviors_z":-0.12,
            "health_behaviors_rank":34,
            "clinical_care_z":-0.08,
            "clinical_care_rank":40,
            "social_and_economic_factors_z":-0.27,
            "social_and_economic_factors_rank":26,
            "physical_environment_z":0.03,
            "physical_environment_rank":114
          },
          {
            "name":"Pierce",
            "code":"pe",
            "outcomes_z":0.36,
            "outcomes_rank":111,
            "factors_z":-0.15,
            "factors_rank":46,
            "length_of_life_z":0.47,
            "length_of_life_rank":139,
            "quality_of_life_z":-0.11,
            "quality_of_life_rank":56,
            "health_behaviors_z":-0.08,
            "health_behaviors_rank":45,
            "clinical_care_z":0.09,
            "clinical_care_rank":129,
            "social_and_economic_factors_z":-0.16,
            "social_and_economic_factors_rank":40,
            "physical_environment_z":-0.00,
            "physical_environment_rank":78
          },
          {
            "name":"Pike",
            "code":"pi",
            "outcomes_z":-0.38,
            "outcomes_rank":46,
            "factors_z":-0.34,
            "factors_rank":35,
            "length_of_life_z":-0.20,
            "length_of_life_rank":59,
            "quality_of_life_z":-0.18,
            "quality_of_life_rank":47,
            "health_behaviors_z":-0.06,
            "health_behaviors_rank":51,
            "clinical_care_z":0.06,
            "clinical_care_rank":118,
            "social_and_economic_factors_z":-0.38,
            "social_and_economic_factors_rank":16,
            "physical_environment_z":0.03,
            "physical_environment_rank":113
          },
          {
            "name":"Polk",
            "code":"po",
            "outcomes_z":0.64,
            "outcomes_rank":136,
            "factors_z":0.06,
            "factors_rank":78,
            "length_of_life_z":0.33,
            "length_of_life_rank":121,
            "quality_of_life_z":0.31,
            "quality_of_life_rank":134,
            "health_behaviors_z":-0.04,
            "health_behaviors_rank":60,
            "clinical_care_z":0.01,
            "clinical_care_rank":89,
            "social_and_economic_factors_z":0.01,
            "social_and_economic_factors_rank":75,
            "physical_environment_z":0.08,
            "physical_environment_rank":150
          },
          {
            "name":"Pulaski",
            "code":"pl",
            "outcomes_z":-0.46,
            "outcomes_rank":40,
            "factors_z":-0.14,
            "factors_rank":48,
            "length_of_life_z":-0.23,
            "length_of_life_rank":53,
            "quality_of_life_z":-0.23,
            "quality_of_life_rank":34,
            "health_behaviors_z":-0.08,
            "health_behaviors_rank":41,
            "clinical_care_z":-0.09,
            "clinical_care_rank":34,
            "social_and_economic_factors_z":0.06,
            "social_and_economic_factors_rank":89,
            "physical_environment_z":-0.03,
            "physical_environment_rank":48
          },
          {
            "name":"Putnam",
            "code":"pu",
            "outcomes_z":-0.34,
            "outcomes_rank":53,
            "factors_z":0.07,
            "factors_rank":81,
            "length_of_life_z":-0.27,
            "length_of_life_rank":49,
            "quality_of_life_z":-0.07,
            "quality_of_life_rank":69,
            "health_behaviors_z":-0.10,
            "health_behaviors_rank":38,
            "clinical_care_z":0.03,
            "clinical_care_rank":100,
            "social_and_economic_factors_z":0.14,
            "social_and_economic_factors_rank":105,
            "physical_environment_z":-0.01,
            "physical_environment_rank":62
          },
          {
            "name":"Quitman",
            "code":"qu",
            "outcomes_z":-0.03,
            "outcomes_rank":68,
            "factors_z":0.20,
            "factors_rank":101,
            "length_of_life_z":-0.50,
            "length_of_life_rank":23,
            "quality_of_life_z":0.47,
            "quality_of_life_rank":150,
            "health_behaviors_z":0.02,
            "health_behaviors_rank":81,
            "clinical_care_z":-0.02,
            "clinical_care_rank":68,
            "social_and_economic_factors_z":0.29,
            "social_and_economic_factors_rank":140,
            "physical_environment_z":-0.09,
            "physical_environment_rank":3
          },
          {
            "name":"Rabun",
            "code":"rb",
            "outcomes_z":0.06,
            "outcomes_rank":75,
            "factors_z":-0.05,
            "factors_rank":66,
            "length_of_life_z":0.47,
            "length_of_life_rank":138,
            "quality_of_life_z":-0.41,
            "quality_of_life_rank":18,
            "health_behaviors_z":-0.17,
            "health_behaviors_rank":22,
            "clinical_care_z":0.12,
            "clinical_care_rank":141,
            "social_and_economic_factors_z":-0.03,
            "social_and_economic_factors_rank":66,
            "physical_environment_z":0.02,
            "physical_environment_rank":106
          },
          {
            "name":"Randolph",
            "code":"ra",
            "outcomes_z":0.75,
            "outcomes_rank":144,
            "factors_z":0.40,
            "factors_rank":132,
            "length_of_life_z":0.30,
            "length_of_life_rank":115,
            "quality_of_life_z":0.45,
            "quality_of_life_rank":148,
            "health_behaviors_z":0.15,
            "health_behaviors_rank":135,
            "clinical_care_z":0.00,
            "clinical_care_rank":85,
            "social_and_economic_factors_z":0.32,
            "social_and_economic_factors_rank":145,
            "physical_environment_z":-0.07,
            "physical_environment_rank":9
          },
          {
            "name":"Richmond",
            "code":"ri",
            "outcomes_z":0.57,
            "outcomes_rank":135,
            "factors_z":0.29,
            "factors_rank":117,
            "length_of_life_z":0.57,
            "length_of_life_rank":146,
            "quality_of_life_z":-0.00,
            "quality_of_life_rank":79,
            "health_behaviors_z":0.16,
            "health_behaviors_rank":137,
            "clinical_care_z":-0.15,
            "clinical_care_rank":19,
            "social_and_economic_factors_z":0.29,
            "social_and_economic_factors_rank":139,
            "physical_environment_z":-0.01,
            "physical_environment_rank":65
          },
          {
            "name":"Rockdale",
            "code":"ro",
            "outcomes_z":-0.99,
            "outcomes_rank":11,
            "factors_z":-0.30,
            "factors_rank":38,
            "length_of_life_z":-0.64,
            "length_of_life_rank":13,
            "quality_of_life_z":-0.36,
            "quality_of_life_rank":23,
            "health_behaviors_z":-0.15,
            "health_behaviors_rank":26,
            "clinical_care_z":-0.10,
            "clinical_care_rank":33,
            "social_and_economic_factors_z":-0.09,
            "social_and_economic_factors_rank":53,
            "physical_environment_z":0.03,
            "physical_environment_rank":127
          },
          {
            "name":"Schley",
            "code":"sc",
            "outcomes_z":-0.26,
            "outcomes_rank":60,
            "factors_z":-0.07,
            "factors_rank":64,
            "length_of_life_z":-0.08,
            "length_of_life_rank":74,
            "quality_of_life_z":-0.19,
            "quality_of_life_rank":43,
            "health_behaviors_z":-0.06,
            "health_behaviors_rank":52,
            "clinical_care_z":0.07,
            "clinical_care_rank":120,
            "social_and_economic_factors_z":-0.05,
            "social_and_economic_factors_rank":59,
            "physical_environment_z":-0.03,
            "physical_environment_rank":42
          },
          {
            "name":"Screven",
            "code":"sr",
            "outcomes_z":0.20,
            "outcomes_rank":94,
            "factors_z":0.12,
            "factors_rank":88,
            "length_of_life_z":0.40,
            "length_of_life_rank":131,
            "quality_of_life_z":-0.20,
            "quality_of_life_rank":40,
            "health_behaviors_z":0.08,
            "health_behaviors_rank":113,
            "clinical_care_z":-0.00,
            "clinical_care_rank":81,
            "social_and_economic_factors_z":0.07,
            "social_and_economic_factors_rank":91,
            "physical_environment_z":-0.03,
            "physical_environment_rank":38
          },
          {
            "name":"Seminole",
            "code":"sm",
            "outcomes_z":0.27,
            "outcomes_rank":103,
            "factors_z":-0.01,
            "factors_rank":70,
            "length_of_life_z":0.39,
            "length_of_life_rank":130,
            "quality_of_life_z":-0.12,
            "quality_of_life_rank":55,
            "health_behaviors_z":-0.02,
            "health_behaviors_rank":68,
            "clinical_care_z":0.03,
            "clinical_care_rank":103,
            "social_and_economic_factors_z":0.01,
            "social_and_economic_factors_rank":73,
            "physical_environment_z":-0.03,
            "physical_environment_rank":36
          },
          {
            "name":"Spalding",
            "code":"sp",
            "outcomes_z":0.72,
            "outcomes_rank":141,
            "factors_z":0.21,
            "factors_rank":103,
            "length_of_life_z":0.33,
            "length_of_life_rank":122,
            "quality_of_life_z":0.38,
            "quality_of_life_rank":141,
            "health_behaviors_z":0.04,
            "health_behaviors_rank":90,
            "clinical_care_z":-0.02,
            "clinical_care_rank":64,
            "social_and_economic_factors_z":0.16,
            "social_and_economic_factors_rank":110,
            "physical_environment_z":0.04,
            "physical_environment_rank":133
          },
          {
            "name":"Stephens",
            "code":"se",
            "outcomes_z":0.12,
            "outcomes_rank":83,
            "factors_z":-0.19,
            "factors_rank":43,
            "length_of_life_z":0.06,
            "length_of_life_rank":90,
            "quality_of_life_z":0.06,
            "quality_of_life_rank":93,
            "health_behaviors_z":-0.10,
            "health_behaviors_rank":36,
            "clinical_care_z":-0.02,
            "clinical_care_rank":71,
            "social_and_economic_factors_z":-0.10,
            "social_and_economic_factors_rank":52,
            "physical_environment_z":0.03,
            "physical_environment_rank":117
          },
          {
            "name":"Stewart",
            "code":"st",
            "outcomes_z":1.39,
            "outcomes_rank":156,
            "factors_z":0.74,
            "factors_rank":156,
            "length_of_life_z":1.23,
            "length_of_life_rank":158,
            "quality_of_life_z":0.17,
            "quality_of_life_rank":109,
            "health_behaviors_z":0.15,
            "health_behaviors_rank":133,
            "clinical_care_z":0.20,
            "clinical_care_rank":151,
            "social_and_economic_factors_z":0.38,
            "social_and_economic_factors_rank":151,
            "physical_environment_z":0.01,
            "physical_environment_rank":91
          },
          {
            "name":"Sumter",
            "code":"su",
            "outcomes_z":-0.33,
            "outcomes_rank":55,
            "factors_z":0.48,
            "factors_rank":142,
            "length_of_life_z":-0.19,
            "length_of_life_rank":60,
            "quality_of_life_z":-0.13,
            "quality_of_life_rank":53,
            "health_behaviors_z":0.17,
            "health_behaviors_rank":142,
            "clinical_care_z":-0.07,
            "clinical_care_rank":42,
            "social_and_economic_factors_z":0.40,
            "social_and_economic_factors_rank":153,
            "physical_environment_z":-0.02,
            "physical_environment_rank":50
          },
          {
            "name":"Talbot",
            "code":"tb",
            "outcomes_z":0.90,
            "outcomes_rank":147,
            "factors_z":0.48,
            "factors_rank":141,
            "length_of_life_z":0.39,
            "length_of_life_rank":129,
            "quality_of_life_z":0.51,
            "quality_of_life_rank":151,
            "health_behaviors_z":0.14,
            "health_behaviors_rank":130,
            "clinical_care_z":0.09,
            "clinical_care_rank":130,
            "social_and_economic_factors_z":0.23,
            "social_and_economic_factors_rank":128,
            "physical_environment_z":0.02,
            "physical_environment_rank":101
          },
          {
            "name":"Taliaferro",
            "code":"ta",
            "outcomes_z":1.46,
            "outcomes_rank":158,
            "factors_z":0.59,
            "factors_rank":152,
            "length_of_life_z":1.06,
            "length_of_life_rank":156,
            "quality_of_life_z":0.40,
            "quality_of_life_rank":142,
            "health_behaviors_z":0.11,
            "health_behaviors_rank":123,
            "clinical_care_z":0.14,
            "clinical_care_rank":145,
            "social_and_economic_factors_z":0.30,
            "social_and_economic_factors_rank":142,
            "physical_environment_z":0.04,
            "physical_environment_rank":137
          },
          {
            "name":"Tattnall",
            "code":"tt",
            "outcomes_z":0.53,
            "outcomes_rank":130,
            "factors_z":0.51,
            "factors_rank":145,
            "length_of_life_z":0.28,
            "length_of_life_rank":110,
            "quality_of_life_z":0.24,
            "quality_of_life_rank":124,
            "health_behaviors_z":0.24,
            "health_behaviors_rank":154,
            "clinical_care_z":0.14,
            "clinical_care_rank":144,
            "social_and_economic_factors_z":0.15,
            "social_and_economic_factors_rank":108,
            "physical_environment_z":-0.03,
            "physical_environment_rank":46
          },
          {
            "name":"Taylor",
            "code":"ty",
            "outcomes_z":0.15,
            "outcomes_rank":86,
            "factors_z":0.37,
            "factors_rank":128,
            "length_of_life_z":-0.11,
            "length_of_life_rank":69,
            "quality_of_life_z":0.26,
            "quality_of_life_rank":126,
            "health_behaviors_z":0.06,
            "health_behaviors_rank":99,
            "clinical_care_z":0.04,
            "clinical_care_rank":105,
            "social_and_economic_factors_z":0.29,
            "social_and_economic_factors_rank":138,
            "physical_environment_z":-0.01,
            "physical_environment_rank":66
          },
          {
            "name":"Telfair",
            "code":"tf",
            "outcomes_z":0.01,
            "outcomes_rank":71,
            "factors_z":0.88,
            "factors_rank":159,
            "length_of_life_z":-0.23,
            "length_of_life_rank":55,
            "quality_of_life_z":0.23,
            "quality_of_life_rank":122,
            "health_behaviors_z":0.23,
            "health_behaviors_rank":153,
            "clinical_care_z":0.18,
            "clinical_care_rank":150,
            "social_and_economic_factors_z":0.49,
            "social_and_economic_factors_rank":158,
            "physical_environment_z":-0.03,
            "physical_environment_rank":47
          },
          {
            "name":"Terrell",
            "code":"tl",
            "outcomes_z":1.34,
            "outcomes_rank":153,
            "factors_z":0.34,
            "factors_rank":127,
            "length_of_life_z":0.74,
            "length_of_life_rank":152,
            "quality_of_life_z":0.60,
            "quality_of_life_rank":154,
            "health_behaviors_z":0.22,
            "health_behaviors_rank":152,
            "clinical_care_z":0.01,
            "clinical_care_rank":87,
            "social_and_economic_factors_z":0.13,
            "social_and_economic_factors_rank":102,
            "physical_environment_z":-0.02,
            "physical_environment_rank":59
          },
          {
            "name":"Thomas",
            "code":"th",
            "outcomes_z":0.18,
            "outcomes_rank":92,
            "factors_z":-0.21,
            "factors_rank":42,
            "length_of_life_z":0.15,
            "length_of_life_rank":98,
            "quality_of_life_z":0.02,
            "quality_of_life_rank":87,
            "health_behaviors_z":0.08,
            "health_behaviors_rank":111,
            "clinical_care_z":-0.18,
            "clinical_care_rank":8,
            "social_and_economic_factors_z":-0.05,
            "social_and_economic_factors_rank":62,
            "physical_environment_z":-0.06,
            "physical_environment_rank":15
          },
          {
            "name":"Tift",
            "code":"ti",
            "outcomes_z":0.00,
            "outcomes_rank":70,
            "factors_z":-0.08,
            "factors_rank":62,
            "length_of_life_z":0.02,
            "length_of_life_rank":84,
            "quality_of_life_z":-0.02,
            "quality_of_life_rank":74,
            "health_behaviors_z":-0.09,
            "health_behaviors_rank":39,
            "clinical_care_z":-0.02,
            "clinical_care_rank":70,
            "social_and_economic_factors_z":0.09,
            "social_and_economic_factors_rank":96,
            "physical_environment_z":-0.06,
            "physical_environment_rank":18
          },
          {
            "name":"Toombs",
            "code":"tm",
            "outcomes_z":0.03,
            "outcomes_rank":74,
            "factors_z":0.19,
            "factors_rank":98,
            "length_of_life_z":0.04,
            "length_of_life_rank":87,
            "quality_of_life_z":-0.02,
            "quality_of_life_rank":76,
            "health_behaviors_z":0.04,
            "health_behaviors_rank":89,
            "clinical_care_z":0.01,
            "clinical_care_rank":92,
            "social_and_economic_factors_z":0.17,
            "social_and_economic_factors_rank":118,
            "physical_environment_z":-0.03,
            "physical_environment_rank":43
          },
          {
            "name":"Towns",
            "code":"to",
            "outcomes_z":-0.70,
            "outcomes_rank":25,
            "factors_z":-0.60,
            "factors_rank":15,
            "length_of_life_z":-0.12,
            "length_of_life_rank":68,
            "quality_of_life_z":-0.58,
            "quality_of_life_rank":6,
            "health_behaviors_z":-0.24,
            "health_behaviors_rank":14,
            "clinical_care_z":-0.14,
            "clinical_care_rank":20,
            "social_and_economic_factors_z":-0.17,
            "social_and_economic_factors_rank":38,
            "physical_environment_z":-0.04,
            "physical_environment_rank":30
          },
          {
            "name":"Treutlen",
            "code":"te",
            "outcomes_z":0.27,
            "outcomes_rank":104,
            "factors_z":0.46,
            "factors_rank":139,
            "length_of_life_z":0.36,
            "length_of_life_rank":126,
            "quality_of_life_z":-0.08,
            "quality_of_life_rank":63,
            "health_behaviors_z":0.13,
            "health_behaviors_rank":126,
            "clinical_care_z":-0.04,
            "clinical_care_rank":58,
            "social_and_economic_factors_z":0.30,
            "social_and_economic_factors_rank":143,
            "physical_environment_z":0.06,
            "physical_environment_rank":148
          },
          {
            "name":"Troup",
            "code":"tr",
            "outcomes_z":0.15,
            "outcomes_rank":87,
            "factors_z":-0.11,
            "factors_rank":56,
            "length_of_life_z":0.18,
            "length_of_life_rank":102,
            "quality_of_life_z":-0.03,
            "quality_of_life_rank":73,
            "health_behaviors_z":-0.13,
            "health_behaviors_rank":29,
            "clinical_care_z":-0.02,
            "clinical_care_rank":65,
            "social_and_economic_factors_z":0.02,
            "social_and_economic_factors_rank":76,
            "physical_environment_z":0.02,
            "physical_environment_rank":105
          },
          {
            "name":"Turner",
            "code":"tu",
            "outcomes_z":1.38,
            "outcomes_rank":155,
            "factors_z":0.14,
            "factors_rank":92,
            "length_of_life_z":0.68,
            "length_of_life_rank":151,
            "quality_of_life_z":0.71,
            "quality_of_life_rank":157,
            "health_behaviors_z":0.06,
            "health_behaviors_rank":100,
            "clinical_care_z":-0.02,
            "clinical_care_rank":67,
            "social_and_economic_factors_z":0.14,
            "social_and_economic_factors_rank":103,
            "physical_environment_z":-0.03,
            "physical_environment_rank":41
          },
          {
            "name":"Twiggs",
            "code":"tw",
            "outcomes_z":0.54,
            "outcomes_rank":133,
            "factors_z":0.30,
            "factors_rank":118,
            "length_of_life_z":0.02,
            "length_of_life_rank":83,
            "quality_of_life_z":0.52,
            "quality_of_life_rank":152,
            "health_behaviors_z":0.04,
            "health_behaviors_rank":91,
            "clinical_care_z":-0.01,
            "clinical_care_rank":73,
            "social_and_economic_factors_z":0.25,
            "social_and_economic_factors_rank":135,
            "physical_environment_z":0.01,
            "physical_environment_rank":94
          },
          {
            "name":"Union",
            "code":"un",
            "outcomes_z":-0.88,
            "outcomes_rank":14,
            "factors_z":-0.54,
            "factors_rank":18,
            "length_of_life_z":-0.35,
            "length_of_life_rank":35,
            "quality_of_life_z":-0.53,
            "quality_of_life_rank":9,
            "health_behaviors_z":-0.33,
            "health_behaviors_rank":5,
            "clinical_care_z":-0.16,
            "clinical_care_rank":13,
            "social_and_economic_factors_z":-0.08,
            "social_and_economic_factors_rank":58,
            "physical_environment_z":0.03,
            "physical_environment_rank":123
          },
          {
            "name":"Upson",
            "code":"up",
            "outcomes_z":0.43,
            "outcomes_rank":121,
            "factors_z":0.25,
            "factors_rank":112,
            "length_of_life_z":0.34,
            "length_of_life_rank":124,
            "quality_of_life_z":0.08,
            "quality_of_life_rank":98,
            "health_behaviors_z":0.14,
            "health_behaviors_rank":132,
            "clinical_care_z":0.03,
            "clinical_care_rank":102,
            "social_and_economic_factors_z":0.09,
            "social_and_economic_factors_rank":95,
            "physical_environment_z":-0.01,
            "physical_environment_rank":67
          },
          {
            "name":"Walker",
            "code":"wk",
            "outcomes_z":0.39,
            "outcomes_rank":116,
            "factors_z":-0.14,
            "factors_rank":47,
            "length_of_life_z":0.12,
            "length_of_life_rank":94,
            "quality_of_life_z":0.27,
            "quality_of_life_rank":128,
            "health_behaviors_z":0.05,
            "health_behaviors_rank":95,
            "clinical_care_z":-0.01,
            "clinical_care_rank":74,
            "social_and_economic_factors_z":-0.20,
            "social_and_economic_factors_rank":37,
            "physical_environment_z":0.02,
            "physical_environment_rank":98
          },
          {
            "name":"Walton",
            "code":"wn",
            "outcomes_z":-0.63,
            "outcomes_rank":30,
            "factors_z":-0.42,
            "factors_rank":29,
            "length_of_life_z":-0.18,
            "length_of_life_rank":62,
            "quality_of_life_z":-0.45,
            "quality_of_life_rank":13,
            "health_behaviors_z":-0.18,
            "health_behaviors_rank":18,
            "clinical_care_z":-0.05,
            "clinical_care_rank":51,
            "social_and_economic_factors_z":-0.29,
            "social_and_economic_factors_rank":24,
            "physical_environment_z":0.10,
            "physical_environment_rank":155
          },
          {
            "name":"Ware",
            "code":"wa",
            "outcomes_z":0.25,
            "outcomes_rank":99,
            "factors_z":0.23,
            "factors_rank":108,
            "length_of_life_z":0.23,
            "length_of_life_rank":107,
            "quality_of_life_z":0.02,
            "quality_of_life_rank":88,
            "health_behaviors_z":0.17,
            "health_behaviors_rank":139,
            "clinical_care_z":-0.01,
            "clinical_care_rank":75,
            "social_and_economic_factors_z":0.14,
            "social_and_economic_factors_rank":104,
            "physical_environment_z":-0.06,
            "physical_environment_rank":16
          },
          {
            "name":"Warren",
            "code":"wr",
            "outcomes_z":1.41,
            "outcomes_rank":157,
            "factors_z":0.51,
            "factors_rank":146,
            "length_of_life_z":0.66,
            "length_of_life_rank":150,
            "quality_of_life_z":0.75,
            "quality_of_life_rank":159,
            "health_behaviors_z":0.18,
            "health_behaviors_rank":144,
            "clinical_care_z":-0.13,
            "clinical_care_rank":25,
            "social_and_economic_factors_z":0.47,
            "social_and_economic_factors_rank":156,
            "physical_environment_z":-0.01,
            "physical_environment_rank":71
          },
          {
            "name":"Washington",
            "code":"wg",
            "outcomes_z":0.65,
            "outcomes_rank":138,
            "factors_z":0.22,
            "factors_rank":106,
            "length_of_life_z":0.32,
            "length_of_life_rank":119,
            "quality_of_life_z":0.33,
            "quality_of_life_rank":137,
            "health_behaviors_z":0.22,
            "health_behaviors_rank":151,
            "clinical_care_z":-0.10,
            "clinical_care_rank":29,
            "social_and_economic_factors_z":0.12,
            "social_and_economic_factors_rank":100,
            "physical_environment_z":-0.01,
            "physical_environment_rank":74
          },
          {
            "name":"Wayne",
            "code":"wy",
            "outcomes_z":0.49,
            "outcomes_rank":127,
            "factors_z":0.45,
            "factors_rank":137,
            "length_of_life_z":0.31,
            "length_of_life_rank":117,
            "quality_of_life_z":0.17,
            "quality_of_life_rank":111,
            "health_behaviors_z":0.16,
            "health_behaviors_rank":138,
            "clinical_care_z":0.11,
            "clinical_care_rank":136,
            "social_and_economic_factors_z":0.22,
            "social_and_economic_factors_rank":127,
            "physical_environment_z":-0.04,
            "physical_environment_rank":31
          },
          {
            "name":"Webster",
            "code":"ws",
            "outcomes_z":-0.07,
            "outcomes_rank":66,
            "factors_z":-0.12,
            "factors_rank":51,
            "length_of_life_z":-0.67,
            "length_of_life_rank":11,
            "quality_of_life_z":0.60,
            "quality_of_life_rank":155,
            "health_behaviors_z":-0.08,
            "health_behaviors_rank":42,
            "clinical_care_z":0.11,
            "clinical_care_rank":135,
            "social_and_economic_factors_z":-0.09,
            "social_and_economic_factors_rank":54,
            "physical_environment_z":-0.04,
            "physical_environment_rank":29
          },
          {
            "name":"Wheeler",
            "code":"we",
            "outcomes_z":-0.06,
            "outcomes_rank":67,
            "factors_z":0.33,
            "factors_rank":123,
            "length_of_life_z":-0.19,
            "length_of_life_rank":61,
            "quality_of_life_z":0.13,
            "quality_of_life_rank":104,
            "health_behaviors_z":0.11,
            "health_behaviors_rank":124,
            "clinical_care_z":0.05,
            "clinical_care_rank":113,
            "social_and_economic_factors_z":0.23,
            "social_and_economic_factors_rank":129,
            "physical_environment_z":-0.07,
            "physical_environment_rank":10
          },
          {
            "name":"White",
            "code":"wt",
            "outcomes_z":-0.34,
            "outcomes_rank":51,
            "factors_z":-0.47,
            "factors_rank":24,
            "length_of_life_z":-0.27,
            "length_of_life_rank":47,
            "quality_of_life_z":-0.08,
            "quality_of_life_rank":66,
            "health_behaviors_z":-0.23,
            "health_behaviors_rank":15,
            "clinical_care_z":-0.05,
            "clinical_care_rank":48,
            "social_and_economic_factors_z":-0.22,
            "social_and_economic_factors_rank":33,
            "physical_environment_z":0.04,
            "physical_environment_rank":134
          },
          {
            "name":"Whitfield",
            "code":"wh",
            "outcomes_z":-0.59,
            "outcomes_rank":37,
            "factors_z":0.06,
            "factors_rank":79,
            "length_of_life_z":-0.40,
            "length_of_life_rank":30,
            "quality_of_life_z":-0.19,
            "quality_of_life_rank":42,
            "health_behaviors_z":-0.06,
            "health_behaviors_rank":49,
            "clinical_care_z":0.05,
            "clinical_care_rank":108,
            "social_and_economic_factors_z":0.04,
            "social_and_economic_factors_rank":86,
            "physical_environment_z":0.03,
            "physical_environment_rank":122
          },
          {
            "name":"Wilcox",
            "code":"wc",
            "outcomes_z":1.07,
            "outcomes_rank":150,
            "factors_z":0.43,
            "factors_rank":136,
            "length_of_life_z":1.14,
            "length_of_life_rank":157,
            "quality_of_life_z":-0.06,
            "quality_of_life_rank":71,
            "health_behaviors_z":0.06,
            "health_behaviors_rank":104,
            "clinical_care_z":0.08,
            "clinical_care_rank":126,
            "social_and_economic_factors_z":0.24,
            "social_and_economic_factors_rank":131,
            "physical_environment_z":0.05,
            "physical_environment_rank":143
          },
          {
            "name":"Wilkes",
            "code":"wl",
            "outcomes_z":0.22,
            "outcomes_rank":97,
            "factors_z":0.39,
            "factors_rank":130,
            "length_of_life_z":0.21,
            "length_of_life_rank":105,
            "quality_of_life_z":0.01,
            "quality_of_life_rank":82,
            "health_behaviors_z":0.05,
            "health_behaviors_rank":98,
            "clinical_care_z":-0.00,
            "clinical_care_rank":82,
            "social_and_economic_factors_z":0.22,
            "social_and_economic_factors_rank":125,
            "physical_environment_z":0.12,
            "physical_environment_rank":158
          },
          {
            "name":"Wilkinson",
            "code":"wi",
            "outcomes_z":0.71,
            "outcomes_rank":140,
            "factors_z":0.19,
            "factors_rank":100,
            "length_of_life_z":0.29,
            "length_of_life_rank":111,
            "quality_of_life_z":0.42,
            "quality_of_life_rank":144,
            "health_behaviors_z":0.09,
            "health_behaviors_rank":114,
            "clinical_care_z":0.06,
            "clinical_care_rank":115,
            "social_and_economic_factors_z":0.03,
            "social_and_economic_factors_rank":80,
            "physical_environment_z":0.02,
            "physical_environment_rank":103
          },
          {
            "name":"Worth",
            "code":"wo",
            "outcomes_z":0.17,
            "outcomes_rank":90,
            "factors_z":-0.00,
            "factors_rank":73,
            "length_of_life_z":-0.29,
            "length_of_life_rank":45,
            "quality_of_life_z":0.46,
            "quality_of_life_rank":149,
            "health_behaviors_z":0.05,
            "health_behaviors_rank":96,
            "clinical_care_z":0.03,
            "clinical_care_rank":97,
            "social_and_economic_factors_z":-0.03,
            "social_and_economic_factors_rank":65,
            "physical_environment_z":-0.05,
            "physical_environment_rank":26
          }
        ];
        
        var outcomes = counties.map(function(county) {return county.outcomes_z;});
        var maxZ = Math.max.apply(null, outcomes);
        var minZ = Math.min.apply(null, outcomes);
        
        if (Math.abs(minZ) > Math.abs(maxZ)) {
            maxZ = -minZ;
        } else {
            minZ = -maxZ;
        }
        
//        var scale = chroma.scale("BrBG").domain([maxZ, minZ]).out("hex");
        var scale = chroma.scale([
                chartStyles.color.tertiaryLight, 'white', chartStyles.color.secondaryLight
            ]).domain([maxZ, minZ]).out("hex");
        
        var legend = document.getElementById("legend-svg-1");
        var cells = legend.rows[0].cells;
        for (var idx=0; idx<cells.length; idx++) {
            var td = cells[idx];
            td.style.backgroundColor = scale(maxZ - ((idx + 0.5) / cells.length) * (maxZ - minZ));
        };
        
        legend = document.getElementById("legend-svg-2");
        cells = legend.rows[0].cells;
        for (var idx=0; idx<cells.length; idx++) {
            var td = cells[idx];
            td.style.backgroundColor = scale(maxZ - ((idx + 0.5) / cells.length) * (maxZ - minZ));
        };
        
        $("#map-svg-1").load("img/ga.svg", function() {
            counties.forEach(function(county) {
                document.getElementById(county.code).setAttribute("fill", scale(county.outcomes_z));
            })
        })
        
        var zToText = function(z) {
            z = +z;
            if (z > 0.25) return "Far below Average";
            if (z > 0.1) return "Below Average";
            if (z > -0.1)  return "Average";
            if (z > -0.5)  return "Above Average";
            return "Far above Average";
        }
        
        $("#map-svg-2").load("img/ga2.svg", function() {
            counties.forEach(function(county) {
                document.getElementById(county.code+"-2").setAttribute("fill", scale(county.outcomes_z));
            });
            
            [].slice.call(document.querySelectorAll('#map-svg-2 path')).forEach(function(path){
                path.addEventListener('mouseenter', function(){
                    var table = document.getElementById("details-svg-2");
                    var id = this.id.substr(0,2);
                    var county = null;
                    counties.some(function(c) {
                        if (c.code === id) {
                            county = c;
                            return true;
                        }
                        return false;
                    });
                    if (county) {
                        table.rows[0].cells[1].textContent = county.name;
                        table.rows[1].cells[1].textContent = county.outcomes_rank + " out of " + counties.length;
                        table.rows[2].cells[1].textContent = zToText(county.health_behaviors_z);
                        table.rows[3].cells[1].textContent = zToText(county.clinical_care_z);
                        table.rows[4].cells[1].textContent = zToText(county.social_and_economic_factors_z);
                        table.rows[5].cells[1].textContent = zToText(county.physical_environment_z);
                        table.style.display = "table";
                    }
                    this.setAttribute("stroke", "#444444");
                });
                path.addEventListener('mouseleave', function(){
                    document.getElementById("details-svg-2").style.display = "none";
                    this.setAttribute("stroke", "none");
                });
            })
        })
    };
    
    if (typeof contentLoaded != "undefined") {
        contentLoaded.done(draw);
    } else {
        window.addEventListener('load', draw);
    }

}());
</script>
<h2 id="including-maps-for-context">Including Maps for Context</h2>
<p>So far in this chapter we’ve looked at map visualizations where the main subjects are geographic regions—countries in Europe or counties in Georgia. In those cases, choropleth maps were effective in showing the differences between regions. Not all map visualizations have the same focus, however. In some cases we want to include a map more as context or background for the visualization data.</p>
<p>When we want to include a map as a visualization background, we’re likely to find that traditional mapping libraries will serve us better than custom choropleth maps. The most well-known mapping library is probably <a href="http://maps.google.com">Google Maps</a>, and you’ve almost certainly seen many examples of embedded Google maps on web pages. There are, however, several free and open source alternatives to Google Maps. For this example we’ll use the <a href="https://github.com/modestmaps/modestmaps-js/">Modest Maps</a> library from Stamen Design. To show off this library, we’ll visualize the major <a href="http://en.wikipedia.org/wiki/UFO_sightings_in_the_United_States"><span class="smcp">UFO</span> sightings in the United States</a>, or at least those important enough to merit a Wikipedia entry.</p>
<h3 id="step-1-set-up-the-web-page">Step 1: Set Up the Web Page</h3>
<p>For our visualization we’ll rely on a couple of components from the Modest Maps library: the core library itself and the spotlight extension that can be found in the library’s examples folder. In production you would likely combine these and minify the result to optimize performance, but for our example we’ll include them separately.</p>
<table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;head&gt;</span>
    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;title&gt;&lt;/title&gt;</span>
  <span class="kw">&lt;/head&gt;</span>
  <span class="kw">&lt;body&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;map&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
    <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;js/modestmaps.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
    <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;js/spotlight.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
  <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre></td></tr></table>
<p>We’ve also set aside a <code>&lt;div&gt;</code> in line 8 to hold the map. Not surprisingly, it has the <code>id</code> of <code>&quot;map&quot;</code>.</p>
<h3 id="step-2-prepare-the-data">Step 2: Prepare the Data</h3>
<p>The Wikipedia data can be formatted as an array of JavaScript objects. We can include whatever information we wish in the objects, but we’ll definitely need the latitude and longitude of the sighting in order to place it on the map. Here’s how you might structure the data.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> ufos = [
{
    <span class="st">&quot;date&quot;</span>: <span class="st">&quot;April, 1941&quot;</span>,
    <span class="st">&quot;city&quot;</span>: <span class="st">&quot;Cape Girardeau&quot;</span>,
    <span class="st">&quot;state&quot;</span>: <span class="st">&quot;Missouri&quot;</span>,
    <span class="st">&quot;location&quot;</span>: [<span class="fl">37.309167</span>, -<span class="fl">89.546389</span>],
    <span class="st">&quot;url&quot;</span>: <span class="st">&quot;http://en.wikipedia.org/wiki/Cape_Girardeau_UFO_crash&quot;</span>
},{
    <span class="st">&quot;date&quot;</span>: <span class="st">&quot;February 24, 1942&quot;</span>,
    <span class="st">&quot;city&quot;</span>: <span class="st">&quot;Los Angeles&quot;</span>,
    <span class="st">&quot;state&quot;</span>: <span class="st">&quot;California&quot;</span>,
    <span class="st">&quot;location&quot;</span>: [<span class="fl">34.05</span>, -<span class="fl">118.25</span>],
    <span class="st">&quot;url&quot;</span>: <span class="st">&quot;http://en.wikipedia.org/wiki/Battle_of_Los_Angeles&quot;</span>
},{
<span class="co">// Data set continues...</span></code></pre></td></tr></table>
<p>The <code>location</code> property holds the latitude and longitude (where negative values indicate west) as a two-element array.</p>
<h3 id="step-3-choose-a-map-style">Step 3: Choose a Map Style</h3>
<p>As with most mapping libraries, Modest Maps builds its maps using layers. The layering process works much like it does in a graphics application such as Photoshop or Sketch. Subsequent layers add further visual information to the map. In most cases the base layer for a map consists of image tiles. Additional layers such as markers or routes can be included on top of the image tiles.</p>
<p>When we tell Modest Maps to create a map, it calculates which tiles (both size and location) are needed and then it requests those tiles asynchronously over the internet. The tiles define the visual style of the map. Stamen Design has published several tile sets itself; you can see them on the <a href="http://maps.stamen.com">maps.stamen.com</a> web site.</p>
<p>To use the Stamen tiles we’ll add none more, small JavaScript library to our page. That library is available directly from <a href="http://maps.stamen.com/js/tile.stamen.js">Stamen Design</a>. It should be included <em>after</em> the Modest Maps library.</p>
<table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;head&gt;</span>
    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;title&gt;&lt;/title&gt;</span>
  <span class="kw">&lt;/head&gt;</span>
  <span class="kw">&lt;body&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;map&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
    <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;js/modestmaps.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
    <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;js/spotlight.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
    <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;http://maps.stamen.com/js/tile.stamen.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
  <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre></td></tr></table>
<p>For our example the “toner” style is a good match, so we’ll use those tiles. To use those tiles, we create a <em>tile layer</em> for the map.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> tiles = <span class="kw">new</span> <span class="ot">MM</span>.<span class="fu">StamenTileLayer</span>(<span class="st">&quot;toner&quot;</span>);</code></pre></td></tr></table>
<blockquote>
<p>When you consider a source for image tiles, be aware of any copyright restrictions. Some image tiles must be licensed, and even those that are freely available often require that any user identify the provider as the source.</p>
</blockquote>
<h3 id="step-4-draw-the-map">Step 4: Draw the Map</h3>
<p>Now we’re ready to draw the map itself. That takes two JavaScript statements. First we create a new <code>MM.Map</code> object, giving it the <code>id</code> of the element containing the map and the tiles we just initialized. Then we provide the latitude and longitude for the map’s center as well as an initial zoom level. For your own maps you may need to experiment a bit to get the right values, but for this example we’ll center and zoom the map so that it comfortably shows the continental United States.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> map = <span class="kw">new</span> <span class="ot">MM</span>.<span class="fu">Map</span>(<span class="st">&quot;map&quot;</span>, tiles);
<span class="ot">map</span>.<span class="fu">setCenterZoom</span>(<span class="kw">new</span> <span class="ot">MM</span>.<span class="fu">Location</span>(<span class="fl">38.840278</span>, -<span class="fl">96.611389</span>), <span class="dv">4</span>);</code></pre></td></tr></table>
<p>The resulting map, shown in figure <span class="nextfigure"/>, forms a base for showing the sightings.</p>
<figure>
<div id="map-context-1" style="width:640px;height:370px;">

</div>
<div style="font-size:0.8em">
Map tiles by <a href="http://stamen.com">Stamen Design</a></a>, under <a href="http://creativecommons.org/licenses/by/3.0"><span class="smcp">CC</span> <span class="smcp">BY</span> 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://creativecommons.org/licenses/by-sa/3.0"><span class="smcp">CC</span> <span class="smcp">BY</span> <span class="smcp">SA</span></a>.
</div>
<figcaption>
Map libraries can show maps based on geographic coordinates.
</figcaption>
</figure>
<p>Notice both Stamen Design and OpenStreetMap are credited. That attribution is required by the terms of the Stamen Design license.</p>
<h3 id="step-5-add-the-sightings">Step 5: Add the Sightings</h3>
<p>With our map in place it’s time to add the individual <span class="smcp">UFO</span> sightings. We’re using the spotlight extension to highlight these locations, so we first create a spotlight layer for the map. We’ll also want to set the radius of the spotlight effect. As with the center and zoom parameters, a bit of trial and error helps here.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> layer = <span class="kw">new</span> <span class="fu">SpotlightLayer</span>();
<span class="ot">layer</span>.<span class="ot">spotlight</span>.<span class="fu">radius</span> = <span class="dv">15</span>;
<span class="ot">map</span>.<span class="fu">addLayer</span>(layer);</code></pre></td></tr></table>
<p>Now we can iterate through the array of sightings that make up our data. For each sighting, we extract the latitude and longitude of the location and add that location to the spotlight layer.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">ufos</span>.<span class="fu">forEach</span>(<span class="kw">function</span>(ufo) {
    <span class="ot">layer</span>.<span class="fu">addLocation</span>(<span class="kw">new</span> <span class="ot">MM</span>.<span class="fu">Location</span>(<span class="ot">ufo</span>.<span class="fu">location</span>[<span class="dv">0</span>], <span class="ot">ufo</span>.<span class="fu">location</span>[<span class="dv">1</span>]));
});</code></pre></td></tr></table>
<p>At this point our visualization is complete. Figure <span class="nextfigure"/> shows where <span class="smcp">UFO</span>s have allegedly appeared over the United States in a suitably mysterious context.</p>
<figure>
<div style="font-weight: bold; font-size: 1.1em; padding-bottom: 0.2em;">
Major <span class="lgcp">UFO</span> Sightings in the Continental United States
</div>
<div id="map-context-2" style="width:640px;height:370px">

</div>
<div style="font-size:0.8em">
Map tiles by <a href="http://stamen.com">Stamen Design</a></a>, under <a href="http://creativecommons.org/licenses/by/3.0"><span class="smcp">CC</span> <span class="smcp">BY</span> 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://creativecommons.org/licenses/by-sa/3.0"><span class="smcp">CC</span> <span class="smcp">BY</span> <span class="smcp">SA</span></a>.</span>
<figcaption>
Adding layers in a map library can emphasize regions of a map.
</figcaption>
</figure>
<script>
;(function(){

    draw = function() {

        var ufos = [
        {
            "date": "April, 1941",
            "city": "Cape Girardeau",
            "state": "Missouri",
            "location": [37.309167, -89.546389],
            "url": "http://en.wikipedia.org/wiki/Cape_Girardeau_UFO_crash"
        },{
            "date": "February 24, 1942",
            "city": "Los Angeles",
            "state": "California",
            "location": [34.05, -118.25],
            "url": "http://en.wikipedia.org/wiki/Battle_of_Los_Angeles"
        },{
            "date": "June 21, 1947",
            "city": "Maury Island",
            "state": "Washington",
            "location": [47.376944, -122.429722],
            "url": "http://en.wikipedia.org/wiki/Maury_Island_incident"
        },{
            "date": "June 24, 1947",
            "city": "Maury Island",
            "state": "Washington",
            "location": [47.376944, -122.429722],
            "url": "http://en.wikipedia.org/wiki/Kenneth_Arnold_UFO_sighting"
        },{
            "date": "July 7, 1947",
            "city": "Helena",
            "state": "Montana",
            "location": [46.595806, -112.027031],
            "url": ""
        },{
            "date": "July 7, 1947",
            "city": "Roswell",
            "state": "New Mexico",
            "location": [33.387222, -104.528056],
            "url": "http://en.wikipedia.org/wiki/Roswell_UFO_incident"
        },{
            "date": "January 7, 1948",
            "city": "Maysville",
            "state": "Kentucky",
            "location": [38.643889, -83.775833],
            "url": "http://en.wikipedia.org/wiki/Mantell_UFO_Incident"
        },{
            "date": "July 24, 1948",
            "city": "Montgomery",
            "state": "Alabama",
            "location": [32.361667, -86.279167],
            "url": "http://en.wikipedia.org/wiki/Chiles-Whitted_UFO_Encounter"
        },{
            "date": "October 1, 1948",
            "city": "Fargo",
            "state": "North Dakota",
            "location": [46.877222, -96.789444],
            "url": "http://en.wikipedia.org/wiki/Gorman_Dogfight"
        },{
            "date": "May 11, 1950",
            "city": "McMinnville",
            "state": "Oregon",
            "location": [45.211667, -123.197222],
            "url": "http://en.wikipedia.org/wiki/McMinnville_UFO_photographs"
        },{
            "date": "August 15, 1950",
            "city": "Great Falls",
            "state": "Montana",
            "location": [47.503611, -111.286389],
            "url": "http://en.wikipedia.org/wiki/Mariana_UFO_incident"
        },{
            "date": "August 25, 1951",
            "city": "Lubbock",
            "state": "Texas",
            "location": [33.566667, -101.883333],
            "url": "http://en.wikipedia.org/wiki/Lubbock_Lights"
        },{
            "date": "July 24, 1952",
            "city": "Carson Sink",
            "state": "Nevada",
            "location": [39.877778, -118.347222],
            "url": "http://en.wikipedia.org/wiki/Carson_Sink_UFO_incident"
        },{
            "date": "May 24, 1952",
            "city": "Burbank",
            "state": "California",
            "location": [34.180278, -118.328333],
            "url": "http://en.wikipedia.org/wiki/Orfeo_Angelucci"
        },{
            "date": "July 13, 1952",
            "city": "Washington",
            "state": "District of Columbia",
            "location": [38.895111, -77.036667],
            "url": "http://en.wikipedia.org/wiki/1952_Washington_D.C._UFO_incident"
        },{
            "date": "September 12, 1952",
            "city": "Flatwoods",
            "state": "West Virginia",
            "location": [38.721389, -80.653056],
            "url": "http://en.wikipedia.org/wiki/Flatwoods_monster"
        },{
            "date": "August 5, 1953",
            "city": "Bismarck",
            "state": "North Dakota",
            "location": [46.813333, -100.778889],
            "url": "http://en.wikipedia.org/wiki/Ellsworth_UFO_sighting"
        },{
            "date": "November 23, 1953",
            "city": "Sault Ste. Marie",
            "state": "Michigan",
            "location": [46.496944, -84.345556],
            "url": "http://en.wikipedia.org/wiki/Felix_Moncla"
        },{
            "date": "November 2, 1957",
            "city": "Levelland",
            "state": "Texas",
            "location": [33.587222, -102.378056],
            "url": "http://en.wikipedia.org/wiki/Levelland_UFO_Case"
        },{
            "date": "September 19, 1961",
            "city": "Lancaster",
            "state": "New Hampshire",
            "location": [44.488889, -71.569167],
            "url": "http://en.wikipedia.org/wiki/Betty_and_Barney_Hill_abduction"
        },{
            "date": "April 24, 1964",
            "city": "Socorro",
            "state": "New Mexico",
            "location": [34.061667, -106.899444],
            "url": "http://en.wikipedia.org/wiki/Lonnie_Zamora_incident"
        },{
            "date": "September 3, 1965",
            "city": "Exeter",
            "state": "New Hampshire",
            "location": [42.981389, -70.947778],
            "url": "http://en.wikipedia.org/wiki/Exeter_incident"
        },{
            "date": "December 9, 1965",
            "city": "Kecksburg",
            "state": "Pennsylvania",
            "location": [40.184722, -79.461389],
            "url": "http://en.wikipedia.org/wiki/Kecksburg_UFO_incident"
        },{
            "date": "April 17, 1966",
            "city": "Akron",
            "state": "Ohio",
            "location": [41.073056, -81.517778],
            "url": "http://en.wikipedia.org/wiki/Portage_County_UFO_chase"
        },{
            "date": "December 3, 1967",
            "city": "Ashland",
            "state": "Nebraska",
            "location": [41.040556, -96.3725],
            "url": "http://en.wikipedia.org/wiki/Schirmer_Abduction"
        },{
            "date": "1969",
            "city": "Leary",
            "state": "Georgia",
            "location": [31.485556, -84.513333],
            "url": "http://en.wikipedia.org/wiki/Jimmy_Carter_UFO_incident"
        },{
            "date": "October 11, 1973",
            "city": "Pascagoula",
            "state": "Mississippi",
            "location": [30.363611, -88.541944],
            "url": "http://en.wikipedia.org/wiki/Pascagoula_Abduction"
        },{
            "date": "November 5, 1975",
            "city": "Snowflake",
            "state": "Arizona",
            "location": [34.511111, -110.083056],
            "url": "http://en.wikipedia.org/wiki/Travis_Walton"
        },{
            "date": "August 20, 1976",
            "city": "Allagash",
            "state": "Maine",
            "location": [47.093056, -69.058333],
            "url": "http://en.wikipedia.org/wiki/Allagash_Abductions"
        },{
            "date": "August 27, 1979",
            "city": "Stephen",
            "state": "Minnesota",
            "location": [48.450556, -96.875278],
            "url": "http://en.wikipedia.org/wiki/Val_Johnson_Incident"
        },{
            "date": "December 29, 1980",
            "city": "Dayton",
            "state": "Texas",
            "location": [30.056389, -94.895556],
            "url": "http://en.wikipedia.org/wiki/Cash-Landrum_incident"
        },{
            "date": "November 11, 1987",
            "city": "Gulf Breeze",
            "state": "Florida",
            "location": [30.443333, -87.211389],
            "url": "http://en.wikipedia.org/wiki/Gulf_Breeze_UFO_incident"
        },{
            "date": "March 13, 1997",
            "city": "Phoenix",
            "state": "Arizona",
            "location": [33.45, -112.066667],
            "url": "http://en.wikipedia.org/wiki/Phoenix_Lights"
        },{
            "date": "January 5, 2000",
            "city": "Highland",
            "state": "Illinois",
            "location": [38.743889, -89.677222],
            "url": "http://en.wikipedia.org/wiki/Black_Triangle_(UFO)"
        },{
            "date": "August 21, 2004",
            "city": "Chicago",
            "state": "Illinois",
            "location": [41.881944, -87.627778],
            "url": "http://en.wikipedia.org/wiki/Tinley_Park_Lights"
        },{
            "date": "November 7, 2006",
            "city": "Chicago",
            "state": "Illinois",
            "location": [41.881944, -87.627778],
            "url": "http://en.wikipedia.org/wiki/Chicago_O%27Hare_UFO_sighting_2006"
        },{
            "date": "January 19, 2007",
            "city": "Van Buren",
            "state": "Arkansas",
            "location": [35.444444, -94.346667],
            "url": "http://en.wikinews.org/wiki/US_air_force_colonel_claims_he_spotted_UFOs_over_Arkansas"
        },{
            "date": "January 26, 2007",
            "city": "Charlotte",
            "state": "North Carolina",
            "location": [35.226944, -80.843333],
            "url": "http://en.wikinews.org/wiki/Locals_and_officer_claim_to_have_seen_a_UFO_in_Charlotte,_North_Carolina"
        },{
            "date": "January 8, 2008",
            "city": "Stephenville",
            "state": "Texas",
            "location": [32.220278, -98.213611],
            "url": "http://en.wikinews.org/wiki/UFO_sightings_reported_in_Texas_town"
        },{
            "date": "January 5, 2009",
            "city": "Morristown",
            "state": "New Jersey",
            "location": [40.796562, -74.477318],
            "url": "http://en.wikipedia.org/wiki/Morristown_UFO"
        }
        ];
        
        
        var tiles1 = new MM.StamenTileLayer("toner");
        var map1 = new MM.Map("map-context-1", tiles1);
        map1.setCenterZoom(new MM.Location(37.840278, -96.611389), 4);
        
        var tiles2 = new MM.StamenTileLayer("toner");
        var map2 = new MM.Map("map-context-2", tiles2);
        map2.setCenterZoom(new MM.Location(37.840278, -96.611389), 4);
         
        var layer = new SpotlightLayer();
        layer.spotlight.radius = 15;
        map2.addLayer(layer);
        
        ufos.forEach(function(ufo) {
            layer.addLocation(new MM.Location(ufo.location[0], ufo.location[1]));
        });
    };
    
    if (typeof contentLoaded != "undefined") {
        contentLoaded.done(draw);
    } else {
        window.addEventListener('load', draw);
    }

}());
</script>
<h2 id="integrating-a-full-featured-mapping-library">Integrating a Full-Featured Mapping Library</h2>
<p>The Modest Maps library of the previous example is a fine library for simple map visualizations, but it doesn’t have all of the features and support of a full-featured service such as Google Maps. There is, however, an open source library that does provide those features: <a href="http://leafletjs.com">Leaflet</a>. In this example we’ll build a more complex visualization that features a Leaflet-based map.</p>
<p>In the 1940s, two private railroads were in competition for passenger traffic in the southeastern United States. Two routes that competed most directly were the <em>Silver Comet</em> ()run by Seaboard Air Lines, and the <em>Southerner</em> ()operated by Southern Railways. Both served passengers traveling between New York and Birmingham, Alabama. One factor cited in the Southerner’s ultimate success was the shorter distance of its route. Trips on the Southerner were quicker, giving Southern Railways a competitive advantage. Let’s create a visualization to demonstrate that advantage.</p>
<h3 id="step-1-prepare-the-data">Step 1: Prepare the Data</h3>
<p>The data for our visualization is readily available as timetables for the two routes. A more precise comparison might consider timetables from the same year, but for this example we’ll use the <a href="http://www.streamlinerschedules.com/concourse/track1/southerner194112.html">Southerner’s timetable from 1941</a> and the <a href="http://www.streamlinerschedules.com/concourse/track1/silvercomet194706.html">Silver Comet’s timetable from 1947</a> as they are readily available on the internet. The timetables only include station names, so we will have to look up latitude and longitude values (using, for example, Google Maps) for all of the stations in order to place them on a map. We can also calculate the time difference between stops, in minutes. Those calculations result in two arrays, one for each train.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> seaboard = [
    { <span class="st">&quot;stop&quot;</span>: <span class="st">&quot;Washington&quot;</span>, 
      <span class="st">&quot;latitude&quot;</span>: <span class="fl">38.895111</span>, <span class="st">&quot;longitude&quot;</span>: -<span class="fl">77.036667</span>, 
      <span class="st">&quot;duration&quot;</span>: <span class="dv">77</span> },
    { <span class="st">&quot;stop&quot;</span>: <span class="st">&quot;Fredericksburg&quot;</span>, 
      <span class="st">&quot;latitude&quot;</span>: <span class="fl">38.301806</span>, <span class="st">&quot;longitude&quot;</span>: -<span class="fl">77.470833</span>, 
      <span class="st">&quot;duration&quot;</span>: <span class="dv">89</span> },
    { <span class="st">&quot;stop&quot;</span>: <span class="st">&quot;Richmond&quot;</span>, 
      <span class="st">&quot;latitude&quot;</span>: <span class="fl">37.533333</span>, <span class="st">&quot;longitude&quot;</span>: -<span class="fl">77.466667</span>, 
      <span class="st">&quot;duration&quot;</span>: <span class="dv">29</span> },
    <span class="co">// Data set continues...</span>
];
<span class="kw">var</span> southern = [
    { <span class="st">&quot;stop&quot;</span>: <span class="st">&quot;Washington&quot;</span>, 
      <span class="st">&quot;latitude&quot;</span>: <span class="fl">38.895111</span>, <span class="st">&quot;longitude&quot;</span>: -<span class="fl">77.036667</span>, 
      <span class="st">&quot;duration&quot;</span>: <span class="dv">14</span> },
    { <span class="st">&quot;stop&quot;</span>: <span class="st">&quot;Alexandria&quot;</span>, 
      <span class="st">&quot;latitude&quot;</span>: <span class="fl">38.804722</span>, <span class="st">&quot;longitude&quot;</span>: -<span class="fl">77.047222</span>, 
      <span class="st">&quot;duration&quot;</span>: <span class="dv">116</span> },
    { <span class="st">&quot;stop&quot;</span>: <span class="st">&quot;Charlottesville&quot;</span>, 
      <span class="st">&quot;latitude&quot;</span>: <span class="fl">38.0299</span>, <span class="st">&quot;longitude&quot;</span>: -<span class="fl">78.479</span>, 
      <span class="st">&quot;duration&quot;</span>: <span class="dv">77</span> },
    <span class="co">// Data set continues...</span>
];</code></pre></td></tr></table>
<h3 id="step-2-set-up-the-web-page-and-libraries">Step 2: Set Up the Web Page and Libraries</h3>
<p>To add Leaflet maps to our web page we’ll need to include the library and its companion stylesheet. Both are available from a content distribution network, so there’s no need to host them on our own servers. When we create our page we also define a <code>&lt;div&gt;</code> container for the map in line 10.</p>
<table class="sourceCode html numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="sourceCode"><pre><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;head&gt;</span>
    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;title&gt;&lt;/title&gt;</span>
    <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span> 
<span class="ot">     href=</span><span class="st">&quot;http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css&quot;</span> <span class="kw">/&gt;</span>
  <span class="kw">&lt;/head&gt;</span>
  <span class="kw">&lt;body&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;map&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
    <span class="kw">&lt;script</span> 
<span class="ot">      src=</span><span class="st">&quot;http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;/script&gt;</span>
  <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre></td></tr></table>
<h3 id="step-3-draw-the-base-map">Step 3: Draw the Base Map</h3>
<p>The <em>Silver Comet</em> and <em>The Southerner</em> traveled between New York and Birmingham (and, in the case of The Southerner, all the way to New Orleans). But the region that’s relevant for our visualization lies between Washington, <span class="smcp">DC</span> and Atlanta, Georgia, because that’s the only region where the train routes differed: for the rest of their journeys, the routes were essentially the same. Our map, therefore, will extend from Atlanta in the southwest to Washington, <span class="smcp">DC</span> in the northeast. Using a bit of trial and error, we can determine the best center point and zoom level for the map. The center point defines the latitude and longitude for the map’s center, and the zoom level determines the area covered by the map on its initial display. When we create the map object, we give it the <code>id</code> of the containing element as well as those parameters.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> map = <span class="ot">L</span>.<span class="fu">map</span>(<span class="st">&#39;map&#39;</span>,{
    <span class="dt">center</span>: [<span class="fl">36.3</span>, -<span class="fl">80.2</span>],
    <span class="dt">zoom</span>: <span class="dv">6</span>
});</code></pre></td></tr></table>
<p>For this particular visualization, there is little point in zooming or panning the map, so we can include additional options to disable those interactions. Setting both the minimum zoom level (line 6) and the maximum zoom level (line 7) to be equal to the initial zoom level disables zooming. We’ll also disable the on-screen map controls for zooming in line 9. The other zoom controls are likewise disabled (lines 10 through 13). For panning, we disable dragging the map (line 8) and keyboard arrow keys (line 14). We also specify the latitude/longitude bounds for the map (lines 3 and 4).</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> map = <span class="ot">L</span>.<span class="fu">map</span>(<span class="st">&#39;map&#39;</span>,{
    <span class="dt">center</span>: [<span class="fl">36.3</span>, -<span class="fl">80.2</span>],
    <span class="dt">maxBounds</span>: [ [<span class="fl">33.32134852669881</span>, -<span class="fl">85.20996093749999</span>], 
                 [<span class="fl">39.16414104768742</span>, -<span class="fl">75.9814453125</span>] ],
    <span class="dt">zoom</span>: <span class="dv">6</span>,
    <span class="dt">minZoom</span>: <span class="dv">6</span>,
    <span class="dt">maxZoom</span>: <span class="dv">6</span>,
    <span class="dt">dragging</span>: <span class="kw">false</span>,
    <span class="dt">zoomControl</span>: <span class="kw">false</span>,
    <span class="dt">touchZoom</span>: <span class="kw">false</span>,
    <span class="dt">scrollWheelZoom</span>: <span class="kw">false</span>,
    <span class="dt">doubleClickZoom</span>: <span class="kw">false</span>,
    <span class="dt">boxZoom</span>: <span class="kw">false</span>,
    <span class="dt">keyboard</span>: <span class="kw">false</span>
});</code></pre></td></tr></table>
<p>Because we’ve disabled the user’s ability to pan or zoom the map, we should also make sure the mouse cursor doesn’t mislead the user when it’s hovering over the map. The <code>leaflet.css</code> style sheet expects zooming and panning to be enabled, so it sets the cursor to a “grabbing” hand icon. We can override that value with a style rule of our own. We have to define this rule <strong>after</strong> including the <code>leaflet.css</code>.</p>
<table class="sourceCode css numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode css"><span class="fl">.leaflet-container</span> <span class="kw">{</span>
    <span class="kw">cursor:</span> <span class="dt">default</span><span class="kw">;</span>
<span class="kw">}</span></code></pre></td></tr></table>
<p>As with the Modest Maps example, we base our map on a set of tiles. There are many tile providers that support Leaflet; some are open source, while others are commercial. Leaflet has a <a href="http://leaflet-extras.github.io/leaflet-providers/preview/">demo page</a> you can use to compare some of the open source tile providers. For our example we want to avoid tiles with roads, as the highway network looked very different in the 1940s. Esri has a neutral <em>WorldGrayCanvas</em> set that works well for our visualization. It does include current county boundaries, and some counties may have changed their borders since the 1940s. For our example we won’t worry about that detail, though you might consider it in any production visualization. Leaflet’s <span class="smcp">API</span> lets us create the tile layer and add it to the map in a single statement. Note that Leaflet includes a built-in option to handle attribution so we can be sure to credit the tile source appropriately.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">L</span>.<span class="fu">tileLayer</span>(<span class="st">&#39;http://server.arcgisonline.com/ArcGIS/rest/services/&#39;</span>+
            <span class="st">&#39;Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}&#39;</span>, {
     <span class="dt">attribution</span>: <span class="st">&#39;Tiles &amp;copy; Esri &amp;mdash; Esri, DeLorme, NAVTEQ&#39;</span>,
     <span class="dt">maxZoom</span>: <span class="dv">16</span>
}).<span class="fu">addTo</span>(map);</code></pre></td></tr></table>
<p>Note that the <code>maxZoom</code> option in line 3 indicates the maximum zoom layer available for that particular tile set. That value is independent of the zoom level we’re permitting for our map.</p>
<p>With a map and a base tile layer, we have a good starting point for our visualization in figure <span class="nextfigure"/>.</p>
<style>
.leaflet-container { cursor: default; }
</style>
<figure style="margin-left:0;margin-right:0;">
<div id="map-library-1" style="width:640px;height:500px;">

</div>
<figcaption>
A base layer map provides the canvas for a visualization.
</figcaption>
</figure>
<h3 id="step-4-add-the-routes-to-the-map">Step 4: Add the Routes to the Map</h3>
<p>For the next step in our visualization, we want to show the two routes on our map. First, we’ll simply draw each route on the map. Then, we’ll add an animation that traces both routes at the same time to show which one is faster.</p>
<p>The Leaflet library includes a function that does exactly what we need to draw each route: <code>polyline()</code> connects a series of lines defined by the latitude and longitude of their endpoints and prepares them for a map. Our data set includes the geographic coordinates of each route’s stops, so we can use the JavaScript <code>map()</code> method to format those values for Leaflet. For the Silver Comet example, the following statement extracts its stops.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">seaboard</span>.<span class="fu">map</span>(<span class="kw">function</span>(stop) {
    <span class="kw">return</span> [<span class="ot">stop</span>.<span class="fu">latitude</span>, <span class="ot">stop</span>.<span class="fu">longitude</span>]
})</code></pre></td></tr></table>
<p>This statement returns an array of latitude/longitude pairs:</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">[ 
  [<span class="fl">38.895111</span>,-<span class="fl">77.036667</span>], 
  [<span class="fl">38.301806</span>,-<span class="fl">77.470833</span>],
  [<span class="fl">37.533333</span>,-<span class="fl">77.466667</span>], 
  [<span class="fl">37.21295</span>,-<span class="fl">77.400417</span>],
  <span class="co">/* Data set continues... */</span>
]</code></pre></td></tr></table>
<p>That result is the perfect input to the <code>polyline()</code> function. We’ll use it for each of the routes. The options let us specify a color for the lines which we’ll match with the associated railroad’s official color from the era. We also indicate that the lines have no function when clicked by setting the <code>clickable</code> option to <code>false</code>.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">L</span>.<span class="fu">polyline</span>(
    <span class="ot">seaboard</span>.<span class="fu">map</span>(<span class="kw">function</span>(stop) {<span class="kw">return</span> [<span class="ot">stop</span>.<span class="fu">latitude</span>, <span class="ot">stop</span>.<span class="fu">longitude</span>]}),
    {<span class="dt">color</span>: <span class="st">&quot;#88020B&quot;</span>, <span class="dt">weight</span>: <span class="dv">1</span>, <span class="dt">clickable</span>: <span class="kw">false</span>}
).<span class="fu">addTo</span>(map);

<span class="ot">L</span>.<span class="fu">polyline</span>(
    <span class="ot">southern</span>.<span class="fu">map</span>(<span class="kw">function</span>(stop) {<span class="kw">return</span> [<span class="ot">stop</span>.<span class="fu">latitude</span>, <span class="ot">stop</span>.<span class="fu">longitude</span>]}),
    {<span class="dt">color</span>: <span class="st">&quot;#106634&quot;</span>, <span class="dt">weight</span>: <span class="dv">1</span>, <span class="dt">clickable</span>: <span class="kw">false</span>}
).<span class="fu">addTo</span>(map);</code></pre></td></tr></table>
<p>With this addition the visualization shown in figure <span class="nextfigure"/> is starting to convey the relative distances of the two routes.</p>
<figure style="margin-left:0;margin-right:0;">
<div id="map-library-2" style="width:640px;height:500px;">

</div>
<figcaption>
Additional map layers add data to the canvas.
</figcaption>
</figure>
<h3 id="step-5-add-an-animation-control">Step 5: Add an Animation Control</h3>
<p>Next, we’ll animate the two routes. Not only will this emphasize the competitive advantage of the shorter route, it will also make the visualization more interesting and engaging. We’ll definitely want to let our users start and stop the animation, so our map will need a control button. The Leaflet library doesn’t have its own animation control, but the library does have a lot of support for customizations. Part of that support is a generic <code>Control</code> object. We can create an animation control by starting with that object and extending it.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">L</span>.<span class="ot">Control</span>.<span class="fu">Animate</span> = <span class="ot">L</span>.<span class="ot">Control</span>.<span class="fu">extend</span>({
    <span class="co">// custom code goes here</span>
});</code></pre></td></tr></table>
<p>Next we define the options for our custom control. Those options include its position on the map, the text and tooltip (title) for its states, and functions to call when the animation starts or stops. We define these within an <code>options</code> object as follows, which lets Leaflet integrate them within its normal functionality.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">L</span>.<span class="ot">Control</span>.<span class="fu">Animate</span> = <span class="ot">L</span>.<span class="ot">Control</span>.<span class="fu">extend</span>({
    <span class="dt">options</span>: {
        <span class="dt">position</span>: <span class="st">&#39;topleft&#39;</span>,
        <span class="dt">animateStartText</span>: <span class="st">&#39;▶︎&#39;</span>,
        <span class="dt">animateStartTitle</span>: <span class="st">&#39;Start animation&#39;</span>,
        <span class="dt">animatePauseText</span>: <span class="st">&#39;◼︎&#39;</span>,
        <span class="dt">animatePauseTitle</span>: <span class="st">&#39;Pause animation&#39;</span>,
        <span class="dt">animateResumeText</span>: <span class="st">&#39;▶︎&#39;</span>,
        <span class="dt">animateResumeTitle</span>: <span class="st">&#39;Resume animation&#39;</span>,
        <span class="dt">animateStartFn</span>: <span class="kw">null</span>,
        <span class="dt">animateStopFn</span>: <span class="kw">null</span>
    },</code></pre></td></tr></table>
<p>For our example we’re using <span class="smcp">UTF</span>-8 characters for the play and pause control. In a production visualization, you might consider using icon fonts or images to have maximum control over the appearance.</p>
<p>Our animation control also needs an <code>onAdd()</code> method for Leaflet to call when it adds a control to a map. This method constructs the <span class="smcp">HTML</span> markup for the control and returns that to the caller.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    onAdd: <span class="kw">function</span> () {
        <span class="kw">var</span> animateName = <span class="st">&#39;leaflet-control-animate&#39;</span>,
            container = <span class="ot">L</span>.<span class="ot">DomUtil</span>.<span class="fu">create</span>(
                <span class="st">&#39;div&#39;</span>, animateName + <span class="st">&#39; leaflet-bar&#39;</span>),
            options = <span class="kw">this</span>.<span class="fu">options</span>;

        <span class="kw">this</span>.<span class="fu">_button</span>  = <span class="kw">this</span>.<span class="fu">_createButton</span>(
            <span class="kw">this</span>.<span class="ot">options</span>.<span class="fu">animateStartText</span>, 
            <span class="kw">this</span>.<span class="ot">options</span>.<span class="fu">animateStartTitle</span>,
            animateName,  
            container,
            <span class="kw">this</span>.<span class="fu">_clicked</span>);

        <span class="kw">return</span> container;
    },</code></pre></td></tr></table>
<p>Our implementation of <code>onAdd()</code> constructs the markup in two stages. First, starting at line 3, it creates a <code>&lt;div&gt;</code> element and gives that element two classes: <code>leaflet-control-animate</code> and <code>leaflet-bar</code>. The first class is unique to our animation control, and we can use it to apply <span class="smcp">CSS</span> rules uniquely to our control. The second class is a general Leaflet class for all toolbars. By adding it to the animation control, we’re making that control consistent with other Leaflet controls. Note that Leaflet includes the <code>L.DomUtil.create()</code> method in line 3 to handle the details of creating the element.</p>
<p>The second part of <code>onAdd()</code> creates a button element within this <code>&lt;div&gt;</code> container. Most of the work takes place in the <code>_createButton()</code> function at line 6 which we’ll examine shortly. The parameters to the function include:</p>
<ul>
<li>the text for the button,</li>
<li>the tooltip (title) to display when the mouse hovers over the button,</li>
<li>the <span class="smcp">CSS</span> class to apply to the button,</li>
<li>the container in which to insert the button, and</li>
<li>a function to call when the button is clicked.</li>
</ul>
<p>If you’re wondering why the name of this function begins with an underscore (_), that’s the convention that Leaflet uses for private methods (and attributes). There’s no requirement to follow it, but doing so will make it easier for someone familiar with Leaflet to understand our code.</p>
<p>The <code>_createButton()</code> method itself relies on Leaflet utility functions. It creates the button as an <code>&lt;a&gt;</code> element with the specified text, title, and class, and it creates that element within the appropriate container (lines 2-5). It then binds several events to this <code>&lt;a&gt;</code> element. First it ignores initial <code>mousedown</code> and double-click events (line 8). It also prevents single-click events from propagating up the document tree and from implementing their default behavior (line 9). Finally, it executes the callback function on <code>click</code> events (line 10).</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    _createButton: <span class="kw">function</span> (html, title, className, container, callback) {
        <span class="kw">var</span> link = <span class="ot">L</span>.<span class="ot">DomUtil</span>.<span class="fu">create</span>(<span class="st">&#39;a&#39;</span>, className, container);
        <span class="ot">link</span>.<span class="fu">innerHTML</span> = html;
        <span class="ot">link</span>.<span class="fu">href</span> = <span class="st">&#39;#&#39;</span>;
        <span class="ot">link</span>.<span class="fu">title</span> = title;

        <span class="ot">L</span>.<span class="fu">DomEvent</span>
            .<span class="fu">on</span>(link, <span class="st">&#39;mousedown dblclick&#39;</span>, <span class="ot">L</span>.<span class="ot">DomEvent</span>.<span class="fu">stopPropagation</span>)
            .<span class="fu">on</span>(link, <span class="st">&#39;click&#39;</span>, <span class="ot">L</span>.<span class="ot">DomEvent</span>.<span class="fu">stop</span>)
            .<span class="fu">on</span>(link, <span class="st">&#39;click&#39;</span>, callback, <span class="kw">this</span>);

        <span class="kw">return</span> link;
    },</code></pre></td></tr></table>
<p>The callback function itself is our next task. Before we get into the function, we add a single state variable (<code>_running</code>) to keep track of whether the animation is currently running. It starts out stopped (line 1). Then our callback function starts by checking this variable in line 4. If _running is true, that means the animation was running and has just been paused by the current click, so it changes the control to indicate that clicking will now resume the animation. If the animation isn’t running, the callback function does the opposite: it changes the control to indicate that a subsequent click will pause it. In both cases, the callback function executes the appropriate control function if one exists. Finally, it sets the state of the <code>_running</code> state variable to its complement.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    _running: <span class="kw">false</span>,
    
    _clicked: <span class="kw">function</span>() {
        <span class="kw">if</span> (<span class="kw">this</span>.<span class="fu">_running</span>) {
            <span class="kw">if</span> (<span class="kw">this</span>.<span class="ot">options</span>.<span class="fu">animateStopFn</span>) {
                <span class="kw">this</span>.<span class="ot">options</span>.<span class="fu">animateStopFn</span>();
            }
            <span class="kw">this</span>.<span class="ot">_button</span>.<span class="fu">innerHTML</span> = <span class="kw">this</span>.<span class="ot">options</span>.<span class="fu">animateResumeText</span>;
            <span class="kw">this</span>.<span class="ot">_button</span>.<span class="fu">title</span> = <span class="kw">this</span>.<span class="ot">options</span>.<span class="fu">animateResumeTitle</span>;
        } <span class="kw">else</span> {
            <span class="kw">if</span> (<span class="kw">this</span>.<span class="ot">options</span>.<span class="fu">animateStartFn</span>) {
                <span class="kw">this</span>.<span class="ot">options</span>.<span class="fu">animateStartFn</span>();
            }
            <span class="kw">this</span>.<span class="ot">_button</span>.<span class="fu">innerHTML</span> = <span class="kw">this</span>.<span class="ot">options</span>.<span class="fu">animatePauseText</span>;
            <span class="kw">this</span>.<span class="ot">_button</span>.<span class="fu">title</span> = <span class="kw">this</span>.<span class="ot">options</span>.<span class="fu">animatePauseTitle</span>;
        }
        <span class="kw">this</span>.<span class="fu">_running</span> = !<span class="kw">this</span>.<span class="fu">_running</span>;
    },</code></pre></td></tr></table>
<p>The last part of our custom control adds a <code>reset()</code> method to clear the animation. This function sets the control back to its initial state.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    reset: <span class="kw">function</span>() {
        <span class="kw">this</span>.<span class="fu">_running</span> = <span class="kw">false</span>;
        <span class="kw">this</span>.<span class="ot">_button</span>.<span class="fu">innerHTML</span> = <span class="kw">this</span>.<span class="ot">options</span>.<span class="fu">animateStartText</span>;
        <span class="kw">this</span>.<span class="ot">_button</span>.<span class="fu">title</span> = <span class="kw">this</span>.<span class="ot">options</span>.<span class="fu">animateStartTitle</span>;
    }
});</code></pre></td></tr></table>
<p>To completely integrate our custom control into the Leaflet architecture, we add a function to the <code>L.control</code> object. Following the Leaflet convention, this function’s name begins with a lowercase letter but is otherwise identical to the name of our control.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">L</span>.<span class="ot">control</span>.<span class="fu">animate</span> = <span class="kw">function</span> (options) {
    <span class="kw">return</span> <span class="kw">new</span> <span class="ot">L</span>.<span class="ot">Control</span>.<span class="fu">Animate</span>(options);
};</code></pre></td></tr></table>
<p>Defining this last function lets us create the control using a common Leaflet syntax, in particular:</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">L</span>.<span class="ot">control</span>.<span class="fu">animate</span>().<span class="fu">addTo</span>(map);</code></pre></td></tr></table>
<p>This is the same syntax we’ve seen before with layers and polylines.</p>
<h3 id="step-6-prepare-the-animation">Step 6: Prepare the Animation</h3>
<p>With a convenient user control in place, we can now begin work on the animation itself. Although this particular animation isn’t especially taxing, we can still follow best practices and compute as much as possible in advance. Since we’re animating two routes, we’ll define a function that will build an animation for any input route. A second parameter will specify polyline options. This function will return an array of polyline paths, indexed by minutes. You can see the basic structure of this function next. The first element in the array will be the polyline for the first minute of the route. We’ll build the entire array in the <code>animation</code> variable.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> buildAnimation = <span class="kw">function</span>(route, options) {
    <span class="kw">var</span> animation = [];
    
    <span class="co">// Code to build the polylines</span>

    <span class="kw">return</span> animation;
}</code></pre></td></tr></table>
<p>To build the paths we iterate through the stops on the route. We want to keep track of all the stops we’ve already passed, so we define the <code>prevStops</code> array and initialize it as empty in line 1 below. Each iteration calculates the animation steps for the current stop up to the next stop. There’s no need to go beyond the final stop on the route, so we terminate the loop at the next-to-last stop (<code>stopIdx &lt; route.length-1;</code>).</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    <span class="kw">for</span> (<span class="kw">var</span> stopIdx=<span class="dv">0</span>, prevStops=[]; 
             stopIdx &lt; <span class="ot">route</span>.<span class="fu">length</span><span class="dv">-1</span>; stopIdx++) {
        <span class="co">// Code to calculate steps between current stop and next stop</span>
    }</code></pre></td></tr></table>
<p>As we start to calculate the paths beginning at the current stop, we’ll store that stop and the next one in local variables, and we add the current stop to the <code>prevStops</code> array that’s keeping track of previous stops.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">        <span class="kw">var</span> stop = route[stopIdx];
        <span class="kw">var</span> nextStop = route[stopIdx<span class="dv">+1</span>]
        <span class="ot">prevStops</span>.<span class="fu">push</span>([<span class="ot">stop</span>.<span class="fu">latitude</span>, <span class="ot">stop</span>.<span class="fu">longitude</span>]);</code></pre></td></tr></table>
<p>For each stop in our data sets, the <code>duration</code> property stores the number of minutes until the next stop. We’ll use an inner loop, shown next, to count from <code>1</code> up to that value. Within the loop we use a simple linear interpolation to calculate the position at the corresponding time. That position, when appended to the <code>prevStops</code> array, is the polyline path for that time. The following code creates a polyline based on the path and adds it to the animation array.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">        <span class="kw">for</span> (<span class="kw">var</span> minutes = <span class="dv">1</span>; minutes &lt;= <span class="ot">stop</span>.<span class="fu">duration</span>; minutes++) {
            <span class="kw">var</span> position = [
                <span class="ot">stop</span>.<span class="fu">latitude</span> +  
                  (<span class="ot">nextStop</span>.<span class="fu">latitude</span> - <span class="ot">stop</span>.<span class="fu">latitude</span>) *
                  (minutes/<span class="ot">stop</span>.<span class="fu">duration</span>),
                <span class="ot">stop</span>.<span class="fu">longitude</span> + 
                  (<span class="ot">nextStop</span>.<span class="fu">longitude</span> - <span class="ot">stop</span>.<span class="fu">longitude</span>) * 
                  (minutes/<span class="ot">stop</span>.<span class="fu">duration</span>)
            ];
            <span class="ot">animation</span>.<span class="fu">push</span>(
                <span class="ot">L</span>.<span class="fu">polyline</span>(<span class="ot">prevStops</span>.<span class="fu">concat</span>([position]), options)
            );
        }</code></pre></td></tr></table>
<p>When we use the array <code>concat()</code> method we embed the position array within another array object. That keeps <code>concat()</code> from flattening the position array before appending it. You can see the difference in the following examples. It’s the latter outcome that we want.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">[[<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">3</span>,<span class="dv">4</span>]].<span class="fu">concat</span>([<span class="dv">5</span>,<span class="dv">6</span>]);   <span class="co">// =&gt; [[1,2], [3,4], 5, 6]</span>
[[<span class="dv">1</span>,<span class="dv">2</span>], [<span class="dv">3</span>,<span class="dv">4</span>]].<span class="fu">concat</span>([[<span class="dv">5</span>,<span class="dv">6</span>]]); <span class="co">// =&gt; [[1,2], [3,4], [5,6]]</span></code></pre></td></tr></table>
<h3 id="step-7-animate-the-routes">Step 7: Animate the Routes</h3>
<p>Now it’s finally time to execute the animation. To initialize it we create an array to hold the two routes.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> routeAnimations = [
    <span class="fu">buildAnimation</span>(seaboard, 
      {<span class="dt">clickable</span>: <span class="kw">false</span>, <span class="dt">color</span>: <span class="st">&quot;#88020B&quot;</span>, <span class="dt">weight</span>: <span class="dv">8</span>, <span class="dt">opacity</span>: <span class="fl">1.0</span>}
    ),
    <span class="fu">buildAnimation</span>(southern, 
      {<span class="dt">clickable</span>: <span class="kw">false</span>, <span class="dt">color</span>: <span class="st">&quot;#106634&quot;</span>, <span class="dt">weight</span>: <span class="dv">8</span>, <span class="dt">opacity</span>: <span class="fl">1.0</span>}
    )
];</code></pre></td></tr></table>
<p>Next we calculate the maximum number of animation steps. That’s the minimum of the length of the two animation arrays.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> maxSteps = <span class="ot">Math</span>.<span class="ot">min</span>.<span class="fu">apply</span>(<span class="kw">null</span>, 
    <span class="ot">routeAnimations</span>.<span class="fu">map</span>(<span class="kw">function</span>(animation) {
        <span class="kw">return</span> <span class="ot">animation</span>.<span class="fu">length</span>
    })
);</code></pre></td></tr></table>
<p>That statement might seem overly complex for finding the minimum length, but it works with an arbitrary number of routes. If, in the future, we decided to animate a third route on our map, we wouldn’t have to change the code. The best way to understand the statement is to start in the middle and work outward. The fragment:</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">routeAnimations</span>.<span class="fu">map</span>(<span class="kw">function</span>(animation) {<span class="kw">return</span> <span class="ot">animation</span>.<span class="fu">length</span>})</code></pre></td></tr></table>
<p>converts the array of route animations into an array of lengths, specifically <code>[870,775]</code>.</p>
<p>To find the minimum value in an array we can use the <code>Math.min()</code> function, except that function expects its parameters as a comma-separated list of arguments rather than an array. The <code>apply()</code> method (which is available for any JavaScript function) converts an array into a comma-separated list. Its first parameter is a context for the function which in our case is irrelevant, so we pass <code>null</code> for that parameter.</p>
<p>The animation keeps track of its current state with the <code>step</code> variable, which we initialize to <code>0</code>.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> step = <span class="dv">0</span>;</code></pre></td></tr></table>
<p>The <code>animateStep()</code> function processes each step in the animation. There are four parts to this function.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> animateStep = <span class="kw">function</span>() {
    <span class="co">// Draw the next step in the animation</span>
}</code></pre></td></tr></table>
<p>First we check to see whether this is the very first step in the animation. If it isn’t, <code>step</code> will be greater than 0 and we can remove the previous step’s polylines from the map in line 3.</p>
<table class="sourceCode javascript numberLines line-3"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    <span class="kw">if</span> (step &gt; <span class="dv">0</span>) {
        <span class="ot">routeAnimations</span>.<span class="fu">forEach</span>(<span class="kw">function</span>(animation) {
            <span class="ot">map</span>.<span class="fu">removeLayer</span>(animation[step<span class="dv">-1</span>]);
        });
    }</code></pre></td></tr></table>
<p>Next we check to see if we’re already at the end of the animation. If so, then we restart the animation back at step 0.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    <span class="kw">if</span> (step === maxSteps) {
        step = <span class="dv">0</span>;
    }</code></pre></td></tr></table>
<p>For the third part we add the current step’s polylines to the map.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    <span class="ot">routeAnimations</span>.<span class="fu">forEach</span>(<span class="kw">function</span>(animation) {
        <span class="ot">map</span>.<span class="fu">addLayer</span>(animation[step]);
    });</code></pre></td></tr></table>
<p>Finally, we return <code>true</code> if we’ve reached the end of the animation.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    <span class="kw">return</span> ++step === maxSteps;</code></pre></td></tr></table>
<p>We’ll execute this step function repeatedly in a JavaScript interval. We use a variable to keep a reference to that interval and add functions to start and stop it. In the <code>animate()</code> function we check the return value from <code>animateStep()</code> in line 4. When it returns <code>true</code> the animation is complete so we clear the interval and reset our control. (We’ll see where that control is defined shortly.) The <code>pause()</code> function shown in line 10 stops the interval.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> interval = <span class="kw">null</span>;
<span class="kw">var</span> animate = <span class="kw">function</span>() {
    interval = <span class="ot">window</span>.<span class="fu">setInterval</span>(<span class="kw">function</span>() {
        <span class="kw">if</span> (<span class="fu">animateStep</span>()) {
            <span class="ot">window</span>.<span class="fu">clearInterval</span>(interval);
            <span class="ot">control</span>.<span class="fu">reset</span>();
        }
    }, <span class="dv">30</span>);
}
<span class="kw">var</span> pause = <span class="kw">function</span>() {
    <span class="ot">window</span>.<span class="fu">clearInterval</span>(interval);
}</code></pre></td></tr></table>
<p>Now all we need to do is define the animation control using the object we created in step 5. Once we add it to the map, the user will be able to activate the animation.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> control = <span class="ot">L</span>.<span class="ot">control</span>.<span class="fu">animate</span>({
    <span class="dt">animateStartFn</span>: animate,
    <span class="dt">animateStopFn</span>:  pause
});
<span class="ot">control</span>.<span class="fu">addTo</span>(map);</code></pre></td></tr></table>
<h3 id="step-8-create-labels-for-the-stops">Step 8: Create Labels for the Stops</h3>
<p>Before we wrap up the animation we’ll add some labels for each train stop. To emphasize the passage of time, we’ll reveal each label as the animation reaches the corresponding stop. To do that, we’ll create the labels using a special object; then we’ll create a method to add labels to the map; and, to finish the label object, we’ll create methods that the animation control can call to get or set a label’s status.</p>
<p>Since Leaflet doesn’t have a predefined object for labels, we can once again create our own custom object. We start with the basic Leaflet <code>Class</code>.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">L</span>.<span class="fu">Label</span> = <span class="ot">L</span>.<span class="ot">Class</span>.<span class="fu">extend</span>({
    <span class="co">// Implement the Label object</span>
});</code></pre></td></tr></table>
<p>Our <code>Label</code> object accepts parameters for its position on the map, its label text, and any options. Next, we extend the <code>initialize()</code> method of the Leaflet <code>Class</code> to handle those parameters. For position and text we simply save their values for later use. For the options we use a Leaflet utility in line 4 to easily support default values. The object includes one variable to keep track of its status. Initially all labels are hidden, so <code>this._status</code> is initialized appropriately in line 5.</p>
<table class="sourceCode javascript numberLines line-5"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    initialize: <span class="kw">function</span>(latLng, label, options) {
        <span class="kw">this</span>.<span class="fu">_latlng</span> = latLng;
        <span class="kw">this</span>.<span class="fu">_label</span> = label;
        <span class="ot">L</span>.<span class="ot">Util</span>.<span class="fu">setOptions</span>(<span class="kw">this</span>, options);
        <span class="kw">this</span>.<span class="fu">_status</span> = <span class="st">&quot;hidden&quot;</span>;
    },</code></pre></td></tr></table>
<p>Next we define the default option values with the <code>options</code> attribute. The only option we need for our label is an offset for the standard position. By default, that offset will be 0 in both the x- and y-coordinates.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    options: {
        <span class="dt">offset</span>: <span class="kw">new</span> <span class="ot">L</span>.<span class="fu">Point</span>(<span class="dv">0</span>, <span class="dv">0</span>)
    },
});</code></pre></td></tr></table>
<p>This <code>options</code> attribute, combined with the call to <code>L.Util.setOptions</code> in the <code>initialize</code> method, establishes a default value (<code>0,0</code>) for the offset that can be easily overridden when a <code>Label</code> object is created.</p>
<p>Next we write the method that adds a label to a map. This method</p>
<ol type="1">
<li>creates a new <code>&lt;div&gt;</code> element with the <span class="smcp">CSS</span> class <code>leaflet-label</code> (line 2),</li>
<li>sets the <code>line-height</code> of that element to <code>0</code> to work around a quirk in the way Leaflet calculates position (line 3),</li>
<li>sets the <code>opacity</code> of the element to <code>0</code> to match its initial <code>hidden</code> status (line 4),</li>
<li>adds the new element to the <code>markerPane</code> layer in the map (line 5),</li>
<li>sets the contents of the element to the label text (line 6),</li>
<li>calculates a position for the label using its defined latitude/longitude (line 7) and then adjusts for any offset (lines 8-11), and</li>
<li>positions the element on the map (line 12).</li>
</ol>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    onAdd: <span class="kw">function</span>(map) {
        <span class="kw">this</span>.<span class="fu">_container</span> = <span class="ot">L</span>.<span class="ot">DomUtil</span>.<span class="fu">create</span>(<span class="st">&quot;div&quot;</span>, <span class="st">&quot;leaflet-label&quot;</span>);
        <span class="kw">this</span>.<span class="ot">_container</span>.<span class="ot">style</span>.<span class="fu">lineHeight</span> = <span class="st">&quot;0&quot;</span>;
        <span class="kw">this</span>.<span class="ot">_container</span>.<span class="ot">style</span>.<span class="fu">opacity</span> = <span class="st">&quot;0&quot;</span>;
        <span class="ot">map</span>.<span class="fu">getPanes</span>().<span class="ot">markerPane</span>.<span class="fu">appendChild</span>(<span class="kw">this</span>.<span class="fu">_container</span>);
        <span class="kw">this</span>.<span class="ot">_container</span>.<span class="fu">innerHTML</span> = <span class="kw">this</span>.<span class="fu">_label</span>;
        <span class="kw">var</span> position = <span class="ot">map</span>.<span class="fu">latLngToLayerPoint</span>(<span class="kw">this</span>.<span class="fu">_latlng</span>);
        position = <span class="kw">new</span> <span class="ot">L</span>.<span class="fu">Point</span>(
            <span class="ot">position</span>.<span class="fu">x</span> + <span class="kw">this</span>.<span class="ot">options</span>.<span class="ot">offset</span>.<span class="fu">x</span>, 
            <span class="ot">position</span>.<span class="fu">y</span> + <span class="kw">this</span>.<span class="ot">options</span>.<span class="ot">offset</span>.<span class="fu">y</span>
        );
        <span class="ot">L</span>.<span class="ot">DomUtil</span>.<span class="fu">setPosition</span>(<span class="kw">this</span>.<span class="fu">_container</span>, position);
    },</code></pre></td></tr></table>
<blockquote>
<p>Step 2 above—setting the <code>line-height</code> to <code>0</code>—addresses a problem in the method Leaflet uses to position elements on the map. In particular, Leaflet does not account for other elements in the same parent container. By setting all elements to have no line height, we nullify this effect so that the calculated position is correct.</p>
</blockquote>
<p>Finally we add methods to get and set the label’s status. As the following code indicates, our labels can have three different status values, and those values determine the opacity of the label.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    getStatus: <span class="kw">function</span>() {
        <span class="kw">return</span> <span class="kw">this</span>.<span class="fu">_status</span>;
    },
    setStatus: <span class="kw">function</span>(status) {
        <span class="kw">switch</span> (status) {
            <span class="kw">case</span> <span class="st">&quot;hidden&quot;</span>:
                <span class="kw">this</span>.<span class="fu">_status</span> = <span class="st">&quot;hidden&quot;</span>;
                <span class="kw">this</span>.<span class="ot">_container</span>.<span class="ot">style</span>.<span class="fu">opacity</span> = <span class="st">&quot;0&quot;</span>;
                <span class="kw">break</span>;
            <span class="kw">case</span> <span class="st">&quot;shown&quot;</span>:
                <span class="kw">this</span>.<span class="fu">_status</span> = <span class="st">&quot;shown&quot;</span>;
                <span class="kw">this</span>.<span class="ot">_container</span>.<span class="ot">style</span>.<span class="fu">opacity</span> = <span class="st">&quot;1&quot;</span>;
                <span class="kw">break</span>;
            <span class="kw">case</span> <span class="st">&quot;dimmed&quot;</span>:
                <span class="kw">this</span>.<span class="fu">_status</span> = <span class="st">&quot;dimmed&quot;</span>;
                <span class="kw">this</span>.<span class="ot">_container</span>.<span class="ot">style</span>.<span class="fu">opacity</span> = <span class="st">&quot;0.5&quot;</span>;
                <span class="kw">break</span>;
        }
    }</code></pre></td></tr></table>
<p>We included the option to adjust the label’s position because not all labels will look good positioned exactly on the latitude and longitude of the station. Most will benefit from slight shifts to avoid interference with the route polylines, text on the base map tiles, or other labels. For a custom visualization such as this example, there’s no substitute for trial-and-error adjustments. We’ll capture those adjustments for each label by adding another <code>offset</code> field to our data set. The augmented data set might begin like this:</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> seaboard = [
{ <span class="st">&quot;stop&quot;</span>: <span class="st">&quot;Washington&quot;</span>,     <span class="st">&quot;offset&quot;</span>: [-<span class="dv">30</span>,-<span class="dv">10</span>], <span class="co">/* Data continues... */</span> },
{ <span class="st">&quot;stop&quot;</span>: <span class="st">&quot;Fredericksburg&quot;</span>, <span class="st">&quot;offset&quot;</span>: [  <span class="dv">6</span>,  <span class="dv">4</span>], <span class="co">/* Data continues... */</span> },
{ <span class="st">&quot;stop&quot;</span>: <span class="st">&quot;Richmond&quot;</span>,       <span class="st">&quot;offset&quot;</span>: [  <span class="dv">6</span>,  <span class="dv">4</span>], <span class="co">/* Data continues... */</span> },
<span class="co">// Data set continues...</span></code></pre></td></tr></table>
<h3 id="step-9-build-the-label-animation">Step 9: Build the Label Animation</h3>
<p>To create the label animation we can once again iterate through the trains’ routes. Because we have more than one route, a general-purpose function will let us avoid duplicating code. As you can see from the following code, we’re not using a fixed number of arguments to our function. Instead we let the caller pass in as many individual routes as desired. All of those input parameters will be stored in the <code>arguments</code> object.</p>
<p>The <code>arguments</code> object looks a lot like a JavaScript array. It has a <code>length</code> property, and we can access individual elements using, for example, <code>arguments[0]</code>. Unfortunately, the object isn’t a true array, so we can’t use the convenient array methods (such as <code>forEach</code>) on it. As a workaround, the very first statement in our <code>buildLabelAnimation</code> function shown next relies on a simple trick to convert the <code>arguments</code> object into the true <code>args</code> array. It’s a bit long-winded, but the statement in line 2 effectively executes the <code>slice</code> method on <code>arguments</code>. That operation clones <code>arguments</code> into a true array.</p>
<blockquote>
<p>This same trick works for nearly all of JavaScript’s “array-like” objects. You can often use it to convert them into true arrays.</p>
</blockquote>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> buildLabelAnimation = <span class="kw">function</span>() {
    <span class="kw">var</span> args = <span class="ot">Array</span>.<span class="ot">prototype</span>.<span class="ot">slice</span>.<span class="fu">call</span>(arguments),
        labels = [];

    <span class="co">// Calculate label animation values</span>

    <span class="kw">return</span> labels;
}</code></pre></td></tr></table>
<p>With the routes converted into an array, we can use <code>forEach</code> to iterate through all of them, regardless of their number. As we begin processing each route we set the <code>minutes</code> value to <code>0</code>. Then we can use <code>forEach</code> again to iterate through all the stops on the route.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    <span class="ot">args</span>.<span class="fu">forEach</span>(<span class="kw">function</span>(route) {
        <span class="kw">var</span> minutes = <span class="dv">0</span>;
        <span class="ot">route</span>.<span class="fu">forEach</span>(<span class="kw">function</span>(stop,idx) {
            <span class="co">// process each stop on the route</span>
        });
    });</code></pre></td></tr></table>
<p>For each stop in the route, we first check to see whether that stop is the first or last one. If so, we don’t want to animate a label for that stop. Otherwise we create a new <code>Label</code> object in line 3 below, and add it to the map. Then we append that Label object to the <code>labels</code> array that’s accumulating the label animation data. Notice that we add each label to this array twice. The first time we add it in line 9 is at the time the animation reaches the stop; in this case we add it with a status of <code>shown</code>. We also add the label to the array 50 minutes later in line 12, this time with a status of <code>dimmed</code>. When we execute the animation, it will show the label when the route first reaches the station and then dim it a bit later.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">        <span class="ot">route</span>.<span class="fu">forEach</span>(<span class="kw">function</span>(stop,idx) {
            <span class="kw">if</span> (idx !== <span class="dv">0</span> &amp;&amp; idx &lt; <span class="ot">route</span>.<span class="fu">length</span><span class="dv">-1</span>) {
                <span class="kw">var</span> label = <span class="kw">new</span> <span class="ot">L</span>.<span class="fu">Label</span>(
                    [<span class="ot">stop</span>.<span class="fu">latitude</span>, <span class="ot">stop</span>.<span class="fu">longitude</span>], 
                    <span class="ot">stop</span>.<span class="fu">stop</span>, 
                    {<span class="dt">offset</span>: <span class="kw">new</span> <span class="ot">L</span>.<span class="fu">Point</span>(<span class="ot">stop</span>.<span class="fu">offset</span>[<span class="dv">0</span>], <span class="ot">stop</span>.<span class="fu">offset</span>[<span class="dv">1</span>])}
                );
                <span class="ot">map</span>.<span class="fu">addLayer</span>(label);
                <span class="ot">labels</span>.<span class="fu">push</span>(
                    {<span class="dt">minutes</span>: minutes, <span class="dt">label</span>: label, <span class="dt">status</span>: <span class="st">&quot;shown&quot;</span>}
                );
                <span class="ot">labels</span>.<span class="fu">push</span>(
                    {<span class="dt">minutes</span>: minutes<span class="dv">+50</span>, <span class="dt">label</span>: label, <span class="dt">status</span>: <span class="st">&quot;dimmed&quot;</span>}
                );
            }
            minutes += <span class="ot">stop</span>.<span class="fu">duration</span>;
        });</code></pre></td></tr></table>
<p>Once we’ve iterated through all the routes, our <code>labels</code> array will indicate when each label should change status. At this point, though, the labels aren’t listed in the order of their animation state changes. To fix that, we sort the array in order of increasing time.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    <span class="ot">labels</span>.<span class="fu">sort</span>(<span class="kw">function</span>(a,b) {<span class="kw">return</span> <span class="ot">a</span>.<span class="fu">minutes</span> - <span class="ot">b</span>.<span class="fu">minutes</span>;})</code></pre></td></tr></table>
<p>To use our new function, we call and pass in all the routes to animate.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> labels = <span class="fu">buildLabelAnimation</span>(seaboard, southern);</code></pre></td></tr></table>
<p>Because we’re not animating the start (Washington, <span class="smcp">DC</span>) or end (Atlanta) of any routes, we can go ahead and display those on the map from the start. We can get the coordinates from any route; the following example uses the <code>seaboard</code> data set.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> start = seaboard[<span class="dv">0</span>];
<span class="kw">var</span> label = <span class="kw">new</span> <span class="ot">L</span>.<span class="fu">Label</span>(
    [<span class="ot">start</span>.<span class="fu">latitude</span>, <span class="ot">start</span>.<span class="fu">longitude</span>], 
    <span class="ot">start</span>.<span class="fu">stop</span>, 
    {<span class="dt">offset</span>: <span class="kw">new</span> <span class="ot">L</span>.<span class="fu">Point</span>(<span class="ot">start</span>.<span class="fu">offset</span>[<span class="dv">0</span>], <span class="ot">start</span>.<span class="fu">offset</span>[<span class="dv">1</span>])}
);
<span class="ot">map</span>.<span class="fu">addLayer</span>(label);
<span class="ot">label</span>.<span class="fu">setStatus</span>(<span class="st">&quot;shown&quot;</span>);

<span class="kw">var</span> finish = seaboard[<span class="ot">seaboard</span>.<span class="fu">length</span><span class="dv">-1</span>];
label = <span class="kw">new</span> <span class="ot">L</span>.<span class="fu">Label</span>(
    [<span class="ot">finish</span>.<span class="fu">latitude</span>, <span class="ot">finish</span>.<span class="fu">longitude</span>], 
    <span class="ot">finish</span>.<span class="fu">stop</span>, 
    {<span class="dt">offset</span>: <span class="kw">new</span> <span class="ot">L</span>.<span class="fu">Point</span>(<span class="ot">finish</span>.<span class="fu">offset</span>[<span class="dv">0</span>], <span class="ot">finish</span>.<span class="fu">offset</span>[<span class="dv">1</span>])}
);
<span class="ot">map</span>.<span class="fu">addLayer</span>(label);
<span class="ot">label</span>.<span class="fu">setStatus</span>(<span class="st">&quot;shown&quot;</span>);</code></pre></td></tr></table>
<h3 id="step-10-incorporate-label-animation-in-the-animation-step">Step 10: Incorporate Label Animation in the Animation Step</h3>
<p>Now that the label animation data is available, we can make some adjustments to our animation function to incorporate the labels as well as the polyline paths. The first change is deciding when to conclude the animation. Because we’re dimming the labels some time after the route passes their stops, we can’t simply stop when all the paths are drawn. That might leave some labels undimmed. We’ll need separate variables to store the number of steps for each animation, and the total number of animation steps will be whichever is greater.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> maxPathSteps = <span class="ot">Math</span>.<span class="ot">min</span>.<span class="fu">apply</span>(<span class="kw">null</span>,
    <span class="ot">routeAnimations</span>.<span class="fu">map</span>(<span class="kw">function</span>(animation) {
        <span class="kw">return</span> <span class="ot">animation</span>.<span class="fu">length</span>
    })
);
<span class="kw">var</span> maxLabelSteps = labels[<span class="ot">labels</span>.<span class="fu">length</span><span class="dv">-1</span>].<span class="fu">minutes</span>;
<span class="kw">var</span> maxSteps = <span class="ot">Math</span>.<span class="fu">max</span>(maxPathSteps, maxLabelSteps);</code></pre></td></tr></table>
<p>We also need a copy of the label animation data that we can destroy during the animation, while keeping the original data intact. We don’t want to destroy the original so that users can replay the animation if they wish. The easiest way to copy a JavaScript array is by calling its <code>slice(0)</code> method.</p>
<blockquote>
<p>We can’t simply copy the array using an assignment statement (<code>var labelAnimation = labels</code>). In JavaScript this statement would simply set <code>labelAnimation</code> to reference the same actual array as <code>labels</code>. Any changes made to the first would also affect the latter.</p>
</blockquote>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="kw">var</span> labelAnimation = <span class="ot">labels</span>.<span class="fu">slice</span>(<span class="dv">0</span>);</code></pre></td></tr></table>
<p>The animation step function itself needs some additional code to handle labels. It will now have five major parts; we’ll walk through each of them in the code that follows. Our first adjustment is to make sure the code removes previous polyline paths only as long as we’re still adding paths to the map. That’s true only when <code>step</code> is less than <code>maxPathSteps</code>.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    <span class="kw">if</span> (step &gt; <span class="dv">0</span> &amp;&amp; step &lt; maxPathSteps) {
        <span class="ot">routeAnimations</span>.<span class="fu">forEach</span>(<span class="kw">function</span>(animation) {
            <span class="ot">map</span>.<span class="fu">removeLayer</span>(animation[step<span class="dv">-1</span>]);
        });
    }</code></pre></td></tr></table>
<p>The next block handles the case in which the user replays the animation. When that happens, the <code>step</code> value will still be set to <code>maxSteps</code> from the prior animation. To reset the animation we remove the last polyline paths for each route (lines 2-4), make a new copy of the label animation data (line 5), and hide all the labels (lines 6-8). We also reset the <code>step</code> variable to <code>0</code> (line 9).</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    <span class="kw">if</span> (step === maxSteps) {
        <span class="ot">routeAnimations</span>.<span class="fu">forEach</span>(<span class="kw">function</span>(animation) {
            <span class="ot">map</span>.<span class="fu">removeLayer</span>(animation[maxPathSteps<span class="dv">-1</span>]);
        });
        labelAnimation = <span class="ot">labels</span>.<span class="fu">slice</span>(<span class="dv">0</span>);
        <span class="ot">labelAnimation</span>.<span class="fu">forEach</span>(<span class="kw">function</span>(label) {
            <span class="ot">label</span>.<span class="ot">label</span>.<span class="fu">setStatus</span>(<span class="st">&quot;hidden&quot;</span>);
        });
        step = <span class="dv">0</span>;
    }</code></pre></td></tr></table>
<p>The third block is a completely new block that animates the labels. It looks at the first element in the <code>labelAnimation</code> array, if one exists. If the time value for that element (its <code>minutes</code> property) is the same as the animation step, then we check to see if we need to process it. We always process label animations when we’re still adding the paths. If the paths are complete, though, we process animations only for labels that are already shown. Once we’re finished with the first element in <code>labelAnimation</code>, we remove it from the array (using the <code>shift()</code> method) and check again. We must keep checking in case multiple label animation actions are scheduled at the same time.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    <span class="kw">while</span> (<span class="ot">labelAnimation</span>.<span class="fu">length</span> &amp;&amp; step === labelAnimation[<span class="dv">0</span>].<span class="fu">minutes</span>) {
        <span class="kw">var</span> label = labelAnimation[<span class="dv">0</span>].<span class="fu">label</span>;
        <span class="kw">if</span> (step &lt; maxPathSteps || <span class="ot">label</span>.<span class="fu">getStatus</span>() === <span class="st">&quot;shown&quot;</span>) {
            <span class="ot">label</span>.<span class="fu">setStatus</span>(labelAnimation[<span class="dv">0</span>].<span class="fu">status</span>);
        }
        <span class="ot">labelAnimation</span>.<span class="fu">shift</span>();       
    }</code></pre></td></tr></table>
<p>The preceding code explains a couple of things about our label animation preparation. First, because we sorted the label animation, we only need to look at the first element in that array. That’s much more efficient than searching through the entire array. Secondly, because we’re working with a copy of the label animation array instead of the original, it’s safe to remove elements once we finish processing them.</p>
<p>Now that we’ve handled all the label animations we can return to the polyline paths. As long as there are still paths to animate, we add them to the map as before.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    <span class="kw">if</span> (step &lt; maxPathSteps) {
        <span class="ot">routeAnimations</span>.<span class="fu">forEach</span>(<span class="kw">function</span>(animation) {
            <span class="ot">map</span>.<span class="fu">addLayer</span>(animation[step]);
        });
    }</code></pre></td></tr></table>
<p>The final code block in our animation step function is the same as before. We return an indication of whether the animation is complete.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript">    <span class="kw">return</span> ++step === maxSteps;</code></pre></td></tr></table>
<p>There’s one more improvement we can make to the animation, in this case with a judicious bit of <span class="smcp">CSS</span>. Because we use the <code>opacity</code> property to change the status of the labels, we can define a <span class="smcp">CSS</span> transition for that property that will make any changes less abrupt. To accommodate all popular browsers we use appropriate vendor prefixes, but the effect of the rule is consistent. Whenever the browser changes the opacity of elements within a <code>leaflet-label</code> class, it will ease the transition in and out over a 500-millisecond period. This transition prevents the label animations from distracting users too much from the path animation that is the visualization’s main effect.</p>
<table class="sourceCode css numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="sourceCode"><pre><code class="sourceCode css"><span class="fl">.leaflet-label</span> <span class="kw">{</span>
   <span class="kw">-webkit-transition:</span> opacity <span class="dt">.5s</span> ease-in-out<span class="kw">;</span>
      <span class="kw">-moz-transition:</span> opacity <span class="dt">.5s</span> ease-in-out<span class="kw">;</span>
       <span class="kw">-ms-transition:</span> opacity <span class="dt">.5s</span> ease-in-out<span class="kw">;</span>
        <span class="kw">-o-transition:</span> opacity <span class="dt">.5s</span> ease-in-out<span class="kw">;</span>
           <span class="kw">transition:</span> opacity <span class="dt">.5s</span> ease-in-out<span class="kw">;</span>
<span class="kw">}</span></code></pre></td></tr></table>
<h3 id="step-11-add-a-title">Step 11: Add a Title</h3>
<p>To complete the visualization, all we need is a title and a bit of explanation. We can build the title as a Leaflet Control, much as we did for the animation control. The code to do this is quite straightforward. We provide a default position in the top left of the map in line 3 and accept a title string as an initialization parameter in line 6. In line 13, we make it so that title string becomes the <code>innerHTML</code> of the control when we add it to the map.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">L</span>.<span class="ot">Control</span>.<span class="fu">Title</span> = <span class="ot">L</span>.<span class="ot">Control</span>.<span class="fu">extend</span>({
    <span class="dt">options</span>: {
        <span class="dt">position</span>: <span class="st">&quot;topleft&quot;</span>
    },

    <span class="dt">initialize</span>: <span class="kw">function</span> (title, options) {
        <span class="ot">L</span>.<span class="fu">setOptions</span>(<span class="kw">this</span>, options);
        <span class="kw">this</span>.<span class="fu">_title</span> = title;
    },

    <span class="dt">onAdd</span>: <span class="kw">function</span> (map) {
        <span class="kw">var</span> container = <span class="ot">L</span>.<span class="ot">DomUtil</span>.<span class="fu">create</span>(<span class="st">&#39;div&#39;</span>, <span class="st">&#39;leaflet-control-title&#39;</span>);
        <span class="ot">container</span>.<span class="fu">innerHTML</span> = <span class="kw">this</span>.<span class="fu">_title</span>;
        <span class="kw">return</span> container;
    }
});

<span class="ot">L</span>.<span class="ot">control</span>.<span class="fu">title</span> = <span class="kw">function</span>(title, options) {
    <span class="kw">return</span> <span class="kw">new</span> <span class="ot">L</span>.<span class="ot">Control</span>.<span class="fu">Title</span>(title, options);
};</code></pre></td></tr></table>
<p>Now we can use the following code to create a title object with our desired content and immediately add it to the map. Here’s a simple implementation; figure <span class="nextfigure"/> includes some extra information.</p>
<table class="sourceCode javascript numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode javascript"><span class="ot">L</span>.<span class="ot">control</span>.<span class="fu">title</span>(<span class="st">&quot;Geography as a Competitive Advantage&quot;</span>).<span class="fu">addTo</span>(map);</code></pre></td></tr></table>
<p>To set the title’s appearance, we can define <span class="smcp">CSS</span> rules for children of the <code>leaflet-control-title</code> class.</p>
<p>At this point we have the interactive visualization of the two train routes in figure <span class="nextfigure"/>. Our users can clearly see that the Southerner has a quicker route from Washington to Atlanta.</p>
<style>
.leaflet-label {
   -webkit-transition: opacity .5s ease-in-out;
      -moz-transition: opacity .5s ease-in-out;
       -ms-transition: opacity .5s ease-in-out;
        -o-transition: opacity .5s ease-in-out;
           transition: opacity .5s ease-in-out;
}
.leaflet-top .leaflet-control-title,
.leaflet-left .leaflet-control-title {
    margin: 0;
    padding-left: 10px;
    padding-top: 0;
    width: 340px;
    background-color: white;
    background-color: rgba(255,255,255,0.8);
    border: 1px solid #CECDD2;
}
.leaflet-control-title div {
    font-family: 'Varela', sans-serif;
    font-weight: bold;
    font-size: 1.3em;
    padding-top: 0.2em;
    margin: 0;
}
.leaflet-control-title p {
    font-family: 'Varela', sans-serif;
    font-size: 1.1em;
    padding-right: 15px;
    -webkit-hyphens: auto;
    hyphens: auto;
}
.leaflet-label, .leaflet-control-attribution.leaflet-control {
    font-family: 'Varela', sans-serif;
}
.localfile .leaflet-control-title div {
    font-family: 'Avenir';
}
.localfile .leaflet-control-title p {
    font-family: 'Avenir';
}
.localfile .leaflet-label, .localfile .leaflet-control-attribution.leaflet-control {
    font-family: 'Avenir';
}
.seaboard {color: #88020B;}
.southern {color: #106634;}
.seaboard, .southern {
    position: relative;
    top: 1px;
}
.leaflet-container a {
    text-shadow: none;
    background-image: none;
    color: rgb(51, 51, 51);
}
</style>
<figure style="margin-left:0;margin-right:0;">
<div id="map-library-3" style="width:640px;height:500px;">

</div>
<figcaption>
Maps built in the browser with a map library can use interactivity to build interest.
</figcaption>
</figure>
<script>
;(function(){

    draw = function() {

        var seaboard = [
            { "stop": "Washington",     "latitude": 38.895111, "longitude": -77.036667, "duration":  77, "offset": [-30,-10] },
            { "stop": "Fredericksburg", "latitude": 38.301806, "longitude": -77.470833, "duration":  89, "offset": [  6,  4] },
            { "stop": "Richmond",       "latitude": 37.533333, "longitude": -77.466667, "duration":  29, "offset": [  6,  4] },
            { "stop": "Petersburg",     "latitude": 37.21295,  "longitude": -77.400417, "duration":  93, "offset": [  6,  4] },
            { "stop": "Henderson",      "latitude": 36.324722, "longitude": -78.408611, "duration":  44, "offset": [  6,  4] },
            { "stop": "Raleigh",        "latitude": 35.818889, "longitude": -78.644722, "duration": 116, "offset": [  6,  4] },
            { "stop": "Hamlet",         "latitude": 34.888056, "longitude": -79.706111, "duration":  74, "offset": [  6,  6] },
            { "stop": "Monroe",         "latitude": 34.988889, "longitude": -80.549722, "duration":  58, "offset": [  6, -8] },
            { "stop": "Chester",        "latitude": 34.705556, "longitude": -81.211667, "duration":  54, "offset": [  6,  6] },
            { "stop": "Clinton",        "latitude": 34.471389, "longitude": -81.875,    "duration":  34, "offset": [  6,  6] },
            { "stop": "Greenwood",      "latitude": 34.189722, "longitude": -82.154722, "duration":  22, "offset": [ 10, -2] },
            { "stop": "Abbeville",      "latitude": 34.178611, "longitude": -82.379167, "duration":  39, "offset": [  4, 10] },
            { "stop": "Elberton",       "latitude": 34.109722, "longitude": -82.865556, "duration":  41, "offset": [  6, 10] },
            { "stop": "Athens",         "latitude": 33.95,     "longitude": -83.383333, "duration":  75, "offset": [  6,  6] },
            { "stop": "Emory",          "latitude": 33.791111, "longitude": -84.323333, "duration":  25, "offset": [ 10,  4] },
            { "stop": "Atlanta",        "latitude": 33.755,    "longitude": -84.39,     "duration":   0, "offset": [-21, 10] }
        ];
        
        var southern = [
            { "stop": "Washington",      "latitude": 38.895111, "longitude": -77.036667, "duration":  14, "offset": [-30,-10] },
            { "stop": "Alexandria",      "latitude": 38.804722, "longitude": -77.047222, "duration": 116, "offset": [  4,  4] },
            { "stop": "Charlottesville", "latitude": 38.0299,   "longitude": -78.479,    "duration":  77, "offset": [-85,  0] },
            { "stop": "Lynchburg",       "latitude": 37.403672, "longitude": -79.170205, "duration":  71, "offset": [-62,  0] },
            { "stop": "Danville",        "latitude": 36.587238, "longitude": -79.404404, "duration":  64, "offset": [-48, -1] },
            { "stop": "Greensboro",      "latitude": 36.08,     "longitude": -79.819444, "duration":  18, "offset": [-69, -4] },
            { "stop": "High Point",      "latitude": 35.970556, "longitude": -79.9975,   "duration":  47, "offset": [  5,  7] },
            { "stop": "Salisbury",       "latitude": 35.668333, "longitude": -80.478611, "duration":  50, "offset": [-57,  0] },
            { "stop": "Charlotte",       "latitude": 35.226944, "longitude": -80.843333, "duration":  25, "offset": [  8,  0] },
            { "stop": "Gastonia",        "latitude": 35.255278, "longitude": -81.180278, "duration":  63, "offset": [-26,-10] },
            { "stop": "Spartanburg",     "latitude": 34.946667, "longitude": -81.9275,   "duration":  43, "offset": [-80, -7] },
            { "stop": "Greenville",      "latitude": 34.844444, "longitude": -82.385556, "duration": 187, "offset": [-70,  2] },
            { "stop": "Atlanta",         "latitude": 33.755,    "longitude": -84.39,     "duration":   0, "offset": [-21, 10] }
        ];
        
        var map1 = L.map('map-library-1',{
            center: [36.3, -80.6],
            maxBounds: [ [33.32134852669881, -85.20996093749999], [39.16414104768742, -75.9814453125] ],
            zoom: 6,
            minZoom: 6,
            maxZoom: 6,
            dragging: false,
            zoomControl: false,
            touchZoom: false,
            scrollWheelZoom: false,
            doubleClickZoom: false,
            boxZoom: false,
            keyboard: false
        });
        
        L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
             attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
             maxZoom: 16
        }).addTo(map1);
        
        var map2 = L.map('map-library-2',{
            center: [36.3, -80.6],
            maxBounds: [ [33.32134852669881, -85.20996093749999], [39.16414104768742, -75.9814453125] ],
            zoom: 6,
            minZoom: 6,
            maxZoom: 6,
            dragging: false,
            zoomControl: false,
            touchZoom: false,
            scrollWheelZoom: false,
            doubleClickZoom: false,
            boxZoom: false,
            keyboard: false
        });
        
        L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
             attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
             maxZoom: 16
        }).addTo(map2);
         
        L.polyline(
            seaboard.map(function(stop) {return [stop.latitude, stop.longitude]}),
            {clickable: false, color: "#88020B", weight: 1}
        ).addTo(map2);
        
        L.polyline(
            southern.map(function(stop) {return [stop.latitude, stop.longitude]}),
            {clickable: false, color: "#106634", weight: 1}
        ).addTo(map2);
        
        
        
        var map3 = L.map('map-library-3',{
            center: [36.3, -80.6],
            maxBounds: [ [33.32134852669881, -85.20996093749999], [39.16414104768742, -75.9814453125] ],
            zoom: 6,
            minZoom: 6,
            maxZoom: 6,
            dragging: false,
            zoomControl: false,
            touchZoom: false,
            scrollWheelZoom: false,
            doubleClickZoom: false,
            boxZoom: false,
            keyboard: false
        });
        
        L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
             attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
             maxZoom: 16
        }).addTo(map3);
        
        L.polyline(
            seaboard.map(function(stop) {return [stop.latitude, stop.longitude]}),
            {clickable: false, color: "#88020B", weight: 1}
        ).addTo(map3);
        
        L.polyline(
            southern.map(function(stop) {return [stop.latitude, stop.longitude]}),
            {clickable: false, color: "#106634", weight: 1}
        ).addTo(map3);
        
        
        L.Control.Animate = L.Control.extend({
            options: {
                position: 'bottomleft',
                animateStartText: '▶︎',
                animateStartTitle: 'Start animation',
                animatePauseText: '◼︎',
                animatePauseTitle: 'Pause animation',
                animateResumeText: '▶︎',
                animateResumeTitle: 'Resume animation',
                animateStartFn: null,
                animateStopFn: null
            },
            
            onAdd: function () {
                var animateName = 'leaflet-control-animate',
                    container = L.DomUtil.create('div', animateName + ' leaflet-bar'),
                    options = this.options;
        
                this._button  = this._createButton(options.animateStartText, options.animateStartTitle,
                        animateName,  container, this._clicked);
        
                return container;
            },
        
            _createButton: function (html, title, className, container, fn) {
                var link = L.DomUtil.create('a', className, container);
                link.innerHTML = html;
                link.href = '#';
                link.title = title;
        
                L.DomEvent
                    .on(link, 'mousedown dblclick', L.DomEvent.stopPropagation)
                    .on(link, 'click', L.DomEvent.stop)
                    .on(link, 'click', fn, this);
        
                return link;
            },
            
            _running: false,
            
            _clicked: function() {
                if (this._running) {
                    this._button.innerHTML = this.options.animateResumeText;
                    this._button.title = this.options.animateResumeTitle;
                    if (this.options.animateStopFn) {
                        this.options.animateStopFn();
                    }
                } else {
                    this._button.innerHTML = this.options.animatePauseText;
                    this._button.title = this.options.animatePauseTitle;
                    if (this.options.animateStartFn) {
                        this.options.animateStartFn();
                    }
                }
                this._running = !this._running;
            },
            
            reset: function() {
                this._running = false;
                this._button.innerHTML = this.options.animateStartText;
                this._button.title = this.options.animateStartTitle;
            }
        });
        
        L.control.animate = function(options) {
            return new L.Control.Animate(options);
        };
        
        var buildAnimation = function(route, options) {
            var animation = [];
        
            for (var stopIdx=0, prevStops=[]; stopIdx < route.length-1; stopIdx++) {
                var stop = route[stopIdx];
                var nextStop = route[stopIdx+1]
                prevStops.push([stop.latitude, stop.longitude]);
                for (var minutes = 1; minutes <= stop.duration; minutes++) {
                    var position = [
                        stop.latitude +  (nextStop.latitude  - stop.latitude)  * (minutes/stop.duration),
                        stop.longitude + (nextStop.longitude - stop.longitude) * (minutes/stop.duration)
                    ];
                    animation.push(L.polyline(prevStops.concat([position]),options));
                }
            }
            return animation;
        }
        
        
        L.Label = L.Class.extend({
            initialize: function(latLng, label, options) {
                this._latlng = latLng;
                this._label = label;
                L.Util.setOptions(this, options);
                this._status = "hidden";
            },
            options: {
                offset: new L.Point(0, 0)
            },
            onAdd: function(map) {
                this._container = L.DomUtil.create('div', 'leaflet-label');
                this._container.style.lineHeight = "0";
                this._container.style.opacity = "0";
                map.getPanes().markerPane.appendChild(this._container);
                this._container.innerHTML = this._label;
                var pos = map.latLngToLayerPoint(this._latlng);
                var op = new L.Point(pos.x + this.options.offset.x, pos.y + this.options.offset.y);
                L.DomUtil.setPosition(this._container, op);
            },
            getStatus: function() {
                return this._status;
            },
            setStatus: function(status) {
                switch (status) {
                    case "hidden":
                        this._status = "hidden";
                        this._container.style.opacity = "0";
                        break;
                    case "shown":
                        this._status = "shown";
                        this._container.style.opacity = "1";
                        break;
                    case "dimmed":
                        this._status = "dimmed";
                        this._container.style.opacity = "0.5";
                        break;
                }
            }
        });
        
        var start = seaboard[0];
        var label = new L.Label([start.latitude,start.longitude], start.stop, {offset: new L.Point(start.offset[0], start.offset[1])});
        map3.addLayer(label);
        label.setStatus("shown");
        var finish = seaboard[seaboard.length-1];
        label = new L.Label([finish.latitude,finish.longitude], finish.stop, {offset: new L.Point(finish.offset[0], finish.offset[1])});
        map3.addLayer(label);
        label.setStatus("shown");
        
        
        var buildLabelAnimation = function() {
            var args = Array.prototype.slice.call(arguments),
                labels = [];
            
            args.forEach(function(route) {
                var minutes = 0;
                route.forEach(function(stop,idx) {
                    if (idx !== 0 && idx < route.length-1) {
                        var label = new L.Label([stop.latitude,stop.longitude], stop.stop, {offset: new L.Point(stop.offset[0], stop.offset[1])});
                        map3.addLayer(label);
                        labels.push({minutes: minutes, label: label, status: "shown"});
                        labels.push({minutes: minutes+50, label: label, status: "dimmed"});
                    }
                    minutes += stop.duration;
                });
            });
        
            labels.sort(function(a,b) {return a.minutes - b.minutes;})
            
            return labels;
        }
        
        var labels = buildLabelAnimation(seaboard, southern);
        var labelAnimation = labels.slice(0);
        
        var routeAnimations = [
            buildAnimation(seaboard, {clickable: false, color: "#88020B", weight: 6, opacity: 1.0}),
            buildAnimation(southern, {clickable: false, color: "#106634", weight: 6, opacity: 1.0})
        ];
        var maxPathSteps = Math.min.apply(null,routeAnimations.map(function(animation) {return animation.length}));
        var maxLabelSteps = labels[labels.length-1].minutes;
        var maxSteps = Math.max(maxPathSteps, maxLabelSteps);
        var step = 0;
        var animateStep = function() {
            if (step > 0 && step < maxPathSteps) {
                routeAnimations.forEach(function(animation) {
                    map3.removeLayer(animation[step-1]);
                });
            }
            if (step === maxSteps) {
                routeAnimations.forEach(function(animation) {
                    map3.removeLayer(animation[maxPathSteps-1]);
                });
                step = 0;
                labelAnimation = labels.slice(0);
                labelAnimation.forEach(function(label) {
                    label.label.setStatus("hidden");
                });
            }
            while (labelAnimation.length && step === labelAnimation[0].minutes) {
                var label = labelAnimation[0].label;
                if (label.getStatus() === "shown" || step < maxPathSteps) {
                    label.setStatus(labelAnimation[0].status);
                }
                labelAnimation.shift();       
            }
            if (step < maxPathSteps) {
                routeAnimations.forEach(function(animation) {
                    map3.addLayer(animation[step]);
                });
            }
            return ++step === maxSteps;
        }
        
        var interval = null;
        var animate = function() {
            interval = window.setInterval(function() {
                if (animateStep()) {
                    window.clearInterval(interval);
                    control.reset();
                }
            }, 30);
        }
        var pause = function() {
            window.clearInterval(interval);
        }
        
        var control = L.control.animate({
            animateStartFn: animate,
            animateStopFn:  pause
        });
        
        L.Control.Title = L.Control.extend({
            options: {
                position: "topleft"
            },
        
            initialize: function (title, options) {
                L.setOptions(this, options);
                this._title = title;
            },
        
            onAdd: function (map) {
                var container = L.DomUtil.create('div', 'leaflet-control-title');
                container.innerHTML = this._title;
                return container;
            }
        });
        
        L.control.title = function(title, options) {
            return new L.Control.Title(title, options);
        };
        
        L.control.title(
            "<div>Geography as Competitive Advantage</div>" +
            "<p>In the 1940s, the route of Southern Railways' <i>Southerner</i> " +
            "(<span class='southern'>━</span>) " +
            "was shorter than the rival " +
            "<i>Silver Comet</i> of the Seaboard Air Line " +
            "(<span class='seaboard'>━</span>)." +
            "Passengers traveling on the <i>Southerner</i> " +
            "could expect to arrive more than 90 minutes sooner " +
            "than those on the <i>Silver Comet</i>.</p>" +
            "<p>Click the play button to trace the journeys " +
            "of both trains between Washington, DC, and Atlanta, GA.</p>"
        ).addTo(map3);
        
        control.addTo(map3);

    };

    if (typeof contentLoaded != "undefined") {
        contentLoaded.done(draw);
    } else {
        window.addEventListener('load', draw);
    }

}());
</script>
<h2 id="summing-up">Summing Up</h2>
<p>In this chapter, we’ve looked at several visualizations based on maps. In the first two examples, geographic regions were the main subjects of the visualization, and we built choropleth maps to compare and contrast those regions. Map fonts are quick and convenient, but only if they’re available for the regions the visualization needs. Although it usually takes more effort, we have far more control over the map regions if we use Scalable Vector Graphics to create our own custom maps. Unlike other image formats, <span class="smcp">SVG</span> can be easily manipulated in a web page with just <span class="smcp">CSS</span> and JavaScript. This chapter also looked at examples based on traditional mapping libraries. Mapping libraries are especially convenient when your data sets include latitude and longitude values, as the libraries take care of the complicated mathematics required to position those points on a two-dimensional projection. As we saw, some libraries are relatively simple, yet perfectly capable of mapping a data set. Full-featured libraries such as Leaflet offer much more power and customization, and we relied on that extensibility for a custom, animated map.</p>
<p>Continue reading: <a href="chap07.html">Chapter 7: Custom Visualizations with D3.js</a>.</p>
<script src="js/scripts.06.min.js"></script>
        </main>
        <footer>
            <small>Copyright © 2012-2014 by <a href="http://sathomas.me">Stephen A. Thomas</a>. All Rights Reserved.</small>
        </footer>
    <script src="js/scripts.min.js"></script>
   </body>
</html>