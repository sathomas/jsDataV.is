window.setImmediate||(window.setImmediate=function t(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function t(){if(!window.postMessage||!window.addEventListener)return null;var t=[void 0],e="zero-timeout-message",r=function a(r){var a=t.length;return t.push(r),window.postMessage(e+a.toString(36),"*"),a};return window.addEventListener("message",function o(r){if("string"==typeof r.data&&r.data.substr(0,e.length)===e){r.stopImmediatePropagation();var a=parseInt(r.data.substr(e.length),36);t[a]&&(t[a](),t[a]=void 0)}},!0),window.clearImmediate=function i(e){t[e]&&(t[e]=void 0)},r}()||function e(t){window.setTimeout(t,0)}}()),window.clearImmediate||(window.clearImmediate=function e(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function t(e){window.clearTimeout(e)}}()),function(t){var e=function i(){var t=document.createElement("canvas");if(!t||!t.getContext)return!1;var e=t.getContext("2d");return e.getImageData&&e.fillText&&Array.prototype.some&&Array.prototype.push?!0:!1}(),r=function n(){if(e){for(var t=document.createElement("canvas").getContext("2d"),r=20,a,o;r;){if(t.font=r.toString(10)+"px sans-serif",t.measureText("Ｗ").width===a&&t.measureText("m").width===o)return r+1;a=t.measureText("Ｗ").width,o=t.measureText("m").width,r--}return 0}}(),a=function f(t){for(var e,r,a=t.length;a;e=Math.floor(Math.random()*a),r=t[--a],t[a]=t[e],t[e]=r);return t},o=function l(t,o){if(e){Array.isArray(t)||(t=[t]),t.forEach(function(e,r){if("string"==typeof e){if(t[r]=document.getElementById(e),!t[r])throw"The element id specified is not found."}else if(!e.tagName&&!e.appendChild)throw"You must pass valid HTML elements, or ID of the element."});var i={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function A(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,hover:null,click:null};if(o)for(var n in o)n in i&&(i[n]=o[n]);if("function"!=typeof i.weightFactor){var f=i.weightFactor;i.weightFactor=function q(t){return t*f}}if("function"!=typeof i.shape)switch(i.shape){case"circle":default:i.shape="circle";break;case"cardioid":i.shape=function B(t){return 1-Math.sin(t)};break;case"diamond":case"square":i.shape=function H(t){var e=t%(2*Math.PI/4);return 1/(Math.cos(e)+Math.sin(e))};break;case"triangle-forward":i.shape=function X(t){var e=t%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"triangle":case"triangle-upright":i.shape=function Y(t){var e=(t+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"pentagon":i.shape=function G(t){var e=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(e)+.726543*Math.sin(e))};break;case"star":i.shape=function N(t){var e=(t+.955)%(2*Math.PI/10);return(t+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}i.gridSize=Math.max(i.gridSize,4);var l=i.gridSize,d=l-i.maskGapWidth,s=Math.abs(i.maxRotation-i.minRotation),c=Math.min(i.maxRotation,i.minRotation),h,u,m,v,g,w,M;switch(i.color){case"random-dark":M=function U(){return"rgb("+Math.floor(128*Math.random()).toString(10)+","+Math.floor(128*Math.random()).toString(10)+","+Math.floor(128*Math.random()).toString(10)+")"};break;case"random-light":M=function j(){return"rgb("+Math.floor(128*Math.random()+128).toString(10)+","+Math.floor(128*Math.random()+128).toString(10)+","+Math.floor(128*Math.random()+128).toString(10)+")"};break;default:"function"==typeof i.color&&(M=i.color)}var p=!1,x=[],b,C=function J(t){var e=t.target,r=e.getBoundingClientRect(),a=t.clientX-r.left,o=t.clientY-r.top,i=Math.floor(a*(e.width/r.width)/l),n=Math.floor(o*(e.height/r.height)/l);return x[i][n]},I=function K(t){var e=C(t);if(b!==e)return b=e,e?void i.hover(e.item,e.dimension,t):void i.hover(void 0,void 0,t)},T=function Q(t){var e=C(t);e&&i.click(e.item,e.dimension,t)},S=[],k=function V(t){if(S[t])return S[t];var e=8*t,r=e,a=[];for(0===t&&a.push([v[0],v[1],0]);r--;){var o=1;"circle"!==i.shape&&(o=i.shape(r/e*2*Math.PI)),a.push([v[0]+t*o*Math.cos(-r/e*2*Math.PI),v[1]+t*o*Math.sin(-r/e*2*Math.PI)*i.ellipticity,r/e*2*Math.PI])}return S[t]=a,a},y=function Z(){return i.abortThreshold>0&&(new Date).getTime()-w>i.abortThreshold},E=function _(){return 0===i.rotateRatio?0:Math.random()>i.rotateRatio?0:0===s?c:c+Math.random()*s},R=function te(t,e,a){var o=!1,n=i.weightFactor(e);if(n<=i.minSize)return!1;var f=1;r>n&&(f=function F(){for(var t=2;r>t*n;)t+=2;return t}());var d=document.createElement("canvas"),s=d.getContext("2d",{willReadFrequently:!0});s.font=i.fontWeight+" "+(n*f).toString(10)+"px "+i.fontFamily;var c=s.measureText(t).width/f,h=Math.max(n*f,s.measureText("m").width,s.measureText("Ｗ").width)/f,u=c+2*h,m=3*h,v=Math.ceil(u/l),g=Math.ceil(m/l);u=v*l,m=g*l;var w=-c/2,M=.4*-h,p=Math.ceil((u*Math.abs(Math.sin(a))+m*Math.abs(Math.cos(a)))/l),x=Math.ceil((u*Math.abs(Math.cos(a))+m*Math.abs(Math.sin(a)))/l),b=x*l,C=p*l;d.setAttribute("width",b),d.setAttribute("height",C),o&&(document.body.appendChild(d),s.save()),s.scale(1/f,1/f),s.translate(b*f/2,C*f/2),s.rotate(-a),s.font=i.fontWeight+" "+(n*f).toString(10)+"px "+i.fontFamily,s.fillStyle="#000",s.textBaseline="middle",s.fillText(t,w*f,(M+.5*n)*f);var I=s.getImageData(0,0,b,C).data;if(y())return!1;o&&(s.strokeRect(w*f,M,c*f,h*f),s.restore());for(var T=[],S=x,k,E,R,P=[p/2,x/2,p/2,x/2];S--;)for(k=p;k--;){R=l;t:{for(;R--;)for(E=l;E--;)if(I[4*((k*l+R)*b+(S*l+E))+3]){T.push([S,k]),S<P[3]&&(P[3]=S),S>P[1]&&(P[1]=S),k<P[0]&&(P[0]=k),k>P[2]&&(P[2]=k),o&&(s.fillStyle="rgba(255, 0, 0, 0.5)",s.fillRect(S*l,k*l,l-.5,l-.5));break t}o&&(s.fillStyle="rgba(0, 0, 255, 0.5)",s.fillRect(S*l,k*l,l-.5,l-.5))}}return o&&(s.fillStyle="rgba(0, 255, 0, 0.5)",s.fillRect(P[3]*l,P[0]*l,(P[1]-P[3]+1)*l,(P[2]-P[0]+1)*l)),{mu:f,occupied:T,bounds:P,gw:x,gh:p,fillTextOffsetX:w,fillTextOffsetY:M,fillTextWidth:c,fillTextHeight:h,fontSize:n}},P=function ee(t,e,r,a,o){for(var i=o.length;i--;){var n=t+o[i][0],f=e+o[i][1];if(n>=u||f>=m||0>n||0>f||!h[n][f])return!1}return!0},F=function re(e,r,a,o,n,f,d,s){var c=a.fontSize,h;h=M?M(o,n,c,f,d):i.color;var u,m=a.bounds;u={x:(e+m[3])*l,y:(r+m[0])*l,w:(m[1]-m[3]+1)*l,h:(m[2]-m[0]+1)*l},t.forEach(function(t){if(t.getContext){var n=t.getContext("2d"),f=a.mu;n.save(),n.scale(1/f,1/f),n.font=i.fontWeight+" "+(c*f).toString(10)+"px "+i.fontFamily,n.fillStyle=h,n.translate((e+a.gw/2)*l*f,(r+a.gh/2)*l*f),0!==s&&n.rotate(-s),n.textBaseline="middle",n.fillText(o,a.fillTextOffsetX*f,(a.fillTextOffsetY+.5*c)*f),n.restore()}else{var d=document.createElement("span"),u="";u="rotate("+-s/Math.PI*180+"deg) ",1!==a.mu&&(u+="translateX(-"+a.fillTextWidth/4+"px) scale("+1/a.mu+")");var m={position:"absolute",display:"block",font:i.fontWeight+" "+c*a.mu+"px "+i.fontFamily,left:(e+a.gw/2)*l+a.fillTextOffsetX+"px",top:(r+a.gh/2)*l+a.fillTextOffsetY+"px",width:a.fillTextWidth+"px",height:a.fillTextHeight+"px",color:h,lineHeight:c+"px",whiteSpace:"nowrap",transform:u,webkitTransform:u,msTransform:u,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};d.textContent=o;for(var v in m)d.style[v]=m[v];t.appendChild(d)}})},z=function ae(e,r,a,o,i){if(!(e>=u||r>=m||0>e||0>r)){if(h[e][r]=!1,a){var n=t[0].getContext("2d");n.fillRect(e*l,r*l,d,d)}p&&(x[e][r]={item:i,dimension:o})}},L=function oe(e,r,a,o,n,f){var d=n.occupied,s=i.drawMask,c;s&&(c=t[0].getContext("2d"),c.save(),c.fillStyle=i.maskColor);var h;if(p){var u=n.bounds;h={x:(e+u[3])*l,y:(r+u[0])*l,w:(u[1]-u[3]+1)*l,h:(u[2]-u[0]+1)*l}}for(var m=d.length;m--;)z(e+d[m][0],r+d[m][1],s,h,f);s&&c.restore()},W=function ie(t){var e=t[0],r=t[1],o=E(),n=R(e,r,o);if(!n)return!1;if(y())return!1;var f=n.bounds;if(f[1]-f[3]+1>u||f[2]-f[0]+1>m)return!1;for(var l=g+1,d=function(a){var i=Math.floor(a[0]-n.gw/2),f=Math.floor(a[1]-n.gh/2),d=n.gw,s=n.gh;return P(i,f,d,s,n.occupied)?(F(i,f,n,e,r,g-l,a[2],o),L(i,f,d,s,n,t),!0):!1};l--;){var s=k(g-l);i.shuffle&&(s=[].concat(s),a(s));var c=s.some(d);if(c)return!0}return!1},O=function ne(e,r,a){return r?!t.some(function(t){var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,!0,r,a||{}),!t.dispatchEvent(o)},this):void t.forEach(function(t){var o=document.createEvent("CustomEvent");o.initCustomEvent(e,!0,r,a||{}),t.dispatchEvent(o)},this)},D=function fe(){var e=t[0];if(e.getContext)u=Math.floor(e.width/l),m=Math.floor(e.height/l);else{var r=e.getBoundingClientRect();u=Math.floor(r.width/l),m=Math.floor(r.height/l)}if(O("wordcloudstart",!0)){v=i.origin?[i.origin[0]/l,i.origin[1]/l]:[u/2,m/2],g=Math.floor(Math.sqrt(u*u+m*m)),h=[];var a,o,n;if(!e.getContext||i.clearCanvas)for(t.forEach(function(t){if(t.getContext){var e=t.getContext("2d");e.fillStyle=i.backgroundColor,e.clearRect(0,0,u*(l+1),m*(l+1)),e.fillRect(0,0,u*(l+1),m*(l+1))}else t.textContent="",t.style.backgroundColor=i.backgroundColor}),a=u;a--;)for(h[a]=[],o=m;o--;)h[a][o]=!0;else{var f=document.createElement("canvas").getContext("2d");f.fillStyle=i.backgroundColor,f.fillRect(0,0,1,1);var d=f.getImageData(0,0,1,1).data,s=e.getContext("2d").getImageData(0,0,u*l,m*l).data;a=u;for(var c,M;a--;)for(h[a]=[],o=m;o--;){M=l;t:for(;M--;)for(c=l;c--;)for(n=4;n--;)if(s[4*((o*l+M)*u*l+(a*l+c))+n]!==d[n]){h[a][o]=!1;break t}h[a][o]!==!1&&(h[a][o]=!0)}s=f=d=void 0}if(i.hover||i.click){for(p=!0,a=u+1;a--;)x[a]=[];i.hover&&e.addEventListener("mousemove",I),i.click&&e.addEventListener("click",T),e.addEventListener("wordcloudstart",function F(){e.removeEventListener("wordcloudstart",F),e.removeEventListener("mousemove",I),e.removeEventListener("click",T),b=void 0})}n=0;var C,S;0!==i.wait?(C=window.setTimeout,S=window.clearTimeout):(C=window.setImmediate,S=window.clearImmediate);var k=function z(e,r){t.forEach(function(t){t.addEventListener(e,r)},this)},E=function L(e,r){t.forEach(function(t){t.removeEventListener(e,r)},this)},R=function D(){E("wordcloudstart",D),S(P)};k("wordcloudstart",R);var P=C(function A(){if(n>=i.list.length)return S(P),O("wordcloudstop",!1),void E("wordcloudstart",R);w=(new Date).getTime();var t=W(i.list[n]),e=!O("wordclouddrawn",!0,{item:i.list[n],drawn:t});return y()||e?(S(P),i.abort(),O("wordcloudabort",!1),O("wordcloudstop",!1),void E("wordcloudstart",R)):(n++,void(P=C(A,i.wait)))},i.wait)}};D()}};o.isSupported=e,o.miniumFontSize=r,"function"==typeof t.define&&t.define.amd?t.define("wordcloud",[],function(){return o}):t.WordCloud=o}(window);